<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d2/df4/benchmarks_exahype2_ccz4_single_black_hole_performance.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Performance Test (Single Schwarzschild black hole)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Benchmark which solves the static and non-spin single black hole described in a ExaGRyPE simulation. All extensions and fancy features are removed for simplicity. This benchmark is specially compacted to be as close as possible to the corresponding application, so reconstruction and AMR are enabled. This benchmark can be used as a starting point to understand the application and examine its performance under various setup and optimization.</p>
<h1><a class="anchor" id="autotoc_md678"></a>
Run the benchmark</h1>
<p>To run the benchmark, configure and compile the Peano under main directory following</p>
<div class="fragment"><div class="line">libtoolize; aclocal; autoconf; autoheader; cp src/config.h.in .; automake --add-missing</div>
<div class="line">./configure CC=icx CXX=icpx --with-mpi=mpiicpc --with-multithreading=omp CXXFLAGS=<span class="stringliteral">&quot;-Ofast -std=c++20 -fiopenmp -march=native -mtune=native -fma -fomit-frame-pointer -Wno-attributes=clang:: -w&quot;</span> LDFLAGS=<span class="stringliteral">&quot;-fiopenmp&quot;</span> --enable-loadbalancing --enable-exahype --enable-particles --enable-blockstructured --enable-finiteelements</div>
<div class="line">make -j</div>
</div><!-- fragment --><p>then enter this subdirectory and add the python path as</p>
<div class="fragment"><div class="line">cd ./<a class="code hl_namespace" href="../../d3/d22/namespacebenchmarks.html">benchmarks</a>/<a class="code hl_namespace" href="../../dd/d6c/namespaceexahype2.html">exahype2</a>/<a class="code hl_namespace" href="../../dc/db2/namespaceccz4.html">ccz4</a>/performance-testbed/</div>
<div class="line"><span class="keyword">export</span> PYTHONPATH=../../../../python</div>
<div class="line"><span class="keyword">export</span> PYTHONPATH=$PYTHONPATH:../../../../<a class="code hl_namespace" href="../../db/d75/namespaceapplications.html">applications</a>/<a class="code hl_namespace" href="../../dd/d6c/namespaceexahype2.html">exahype2</a>/<a class="code hl_namespace" href="../../dc/db2/namespaceccz4.html">ccz4</a></div>
<div class="ttc" id="anamespaceapplications_html"><div class="ttname"><a href="../../db/d75/namespaceapplications.html">applications</a></div><div class="ttdoc">This code is taken from the original ExaHyPE project written by colleagues from the University of Tre...</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d06/benchmarks_2exahype2_2ccz4_2performance-testbed_2CCZ4Kernels_8h_source.html#l00014">CCZ4Kernels.h:14</a></div></div>
<div class="ttc" id="anamespacebenchmarks_html"><div class="ttname"><a href="../../d3/d22/namespacebenchmarks.html">benchmarks</a></div><div class="ttdef"><b>Definition</b> <a href="../../d5/d80/Poisson_8h_source.html#l00015">Poisson.h:15</a></div></div>
<div class="ttc" id="anamespaceccz4_html"><div class="ttname"><a href="../../dc/db2/namespaceccz4.html">ccz4</a></div><div class="ttdef"><b>Definition</b> <a href="../../dc/db6/ccz4_8py_source.html#l00001">ccz4.py:1</a></div></div>
<div class="ttc" id="anamespaceexahype2_html"><div class="ttname"><a href="../../dd/d6c/namespaceexahype2.html">exahype2</a></div><div class="ttdoc">For the generic kernels that I use here most of the time.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/d65/CellAccess_8h_source.html#l00013">CellAccess.h:13</a></div></div>
</div><!-- fragment --><p>generate the executable and run</p>
<div class="fragment"><div class="line">python3 <a class="code hl_namespace" href="../../d4/ddd/namespaceperformance__testbed.html">performance_testbed</a>.py -et 0.01</div>
<div class="line"><span class="keyword">export</span> OMP_NUM_THREADS=4</div>
<div class="line">./peano_test</div>
<div class="ttc" id="anamespaceperformance__testbed_html"><div class="ttname"><a href="../../d4/ddd/namespaceperformance__testbed.html">performance_testbed</a></div><div class="ttdef"><b>Definition</b> <a href="../../db/d00/performance__testbed_8py_source.html#l00001">performance_testbed.py:1</a></div></div>
</div><!-- fragment --><p>As always, the parameter &ndash;help makes the Python script yield further info, while the sections below enlist characteristic choices of the parameters. There are different scripts in the directory. They serve different purposes and support slightly different parameters.</p>
<p>Depending on your system, you might have to load the GSL module separately before you build the application:</p>
<div class="fragment"><div class="line"><span class="keyword">module</span> load gsl</div>
</div><!-- fragment --><p>and include the installation in the CXX flags in configuration</p>
<div class="fragment"><div class="line">CXXFLAGS=<span class="stringliteral">&quot;...... -Icosma/local/gsl/2.4/include ......&quot;</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md679"></a>
Compiling on COSMA</h2>
<p>the suggest loading module (before compiling the Peano kernel) when you use COSMA or DINE are</p>
<div class="fragment"><div class="line"><span class="keyword">module</span> purge</div>
<div class="line">module load intel_comp/2023.2.0 compiler mpi </div>
<div class="line">module load gnu_comp/13.1.0</div>
<div class="line">export FLAVOUR_NOCONFLICT=1</div>
<div class="line">module load gsl</div>
<div class="line">export I_MPI_CXX=icpx</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md680"></a>
Compiling on Hamilton</h2>
<p>the suggest loading module (before compiling the Peano kernel) when you use Hamilton are</p>
<div class="fragment"><div class="line"><span class="keyword">module</span> purge</div>
<div class="line">module load intel/2023.2 intelmpi/2021.10</div>
<div class="line">module load python/3.10.8</div>
<div class="line">export I_MPI_CXX=icpx</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md681"></a>
SLURM script</h2>
<p>The default setup for this benchmark takes about 5 minutes to finish on 2 nodes on DINE, using the following job script.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#!/bin/bash -l</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#SBATCH -o %A.out</span></div>
<div class="line"><span class="preprocessor">#SBATCH -e %A.err</span></div>
<div class="line"><span class="preprocessor">#SBATCH -p bluefield1</span></div>
<div class="line"><span class="preprocessor">#SBATCH -A durham</span></div>
<div class="line"><span class="preprocessor">#SBATCH -t 24:00:00</span></div>
<div class="line"><span class="preprocessor">#SBATCH --ntasks-per-node=1</span></div>
<div class="line"><span class="preprocessor">#SBATCH --nodes=2</span></div>
<div class="line"><span class="preprocessor">#SBATCH -J ccz4</span></div>
<div class="line"> </div>
<div class="line">echo <span class="stringliteral">&quot;My SLURM_ARRAY_TASK_ID: &quot;</span> $SLURM_ARRAY_TASK_ID</div>
<div class="line"> </div>
<div class="line"><span class="keyword">module</span> purge</div>
<div class="line">module load intel_comp/2023.2.0 compiler mpi </div>
<div class="line">module load gnu_comp/13.1.0</div>
<div class="line">export FLAVOUR_NOCONFLICT=1</div>
<div class="line">module load gsl</div>
<div class="line"> </div>
<div class="line">export UCX_TLS=ud,sm,self</div>
<div class="line"> </div>
<div class="line">export OMP_NUM_THREADS=32</div>
<div class="line"> </div>
<div class="line">mpirun ./peano4_test</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md682"></a>
Clean up old and temporary files</h1>
<p>The following statements remove all the glue code and autogenerated C++ files. There is no risk in deleting them - if you rerun the Python script, they will all be reinstantiated.</p>
<div class="fragment"><div class="line">rm *.o *.cmake</div>
<div class="line">rm README-*.md</div>
<div class="line">rm Makefile CMakeLists.txt</div>
<div class="line">rm Abstract*</div>
<div class="line">rm -rf celldata facedata globaldata observers tasks vertexdata repositories</div>
</div><!-- fragment --><p>To get rid of the output files, type in</p>
<div class="fragment"><div class="line">rm *patch-file *vtu *.pvd *.bak *.csv</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md683"></a>
Visualisation</h1>
<p>The output of ExaHyPE is given in peano patch file and one can use the following commands to convert them into normal vtu files, and inspect them in other tools like paraview.</p>
<div class="fragment"><div class="line"><span class="keyword">module</span> unload python/2.7.15</div>
<div class="line">module load python/3.6.5 paraview/5.8.1</div>
<div class="line">export PYTHONPATH=/path/to/Peano/python/</div>
<div class="line">pvpython /path/to/Peano/python/peano4/visualisation/render.py path/to/solution.peano-patch-file </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d3/d82/page_exahype2_home.html">ExaHyPE 2</a></li><li class="navelem"><a class="el" href="../../d4/dad/page_exahype_benchmarks.html">Benchmarks</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:01 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
