<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d7/d01/peano_main.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">The typical main.cpp in a Peano code</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Though I do not tell users exactly how to write their code, there's some kind of generic structure that is common to all Peano simulations and their mains. We can consider it to be some kind of pattern/best practice.</p>
<h2><a class="anchor" id="autotoc_md1050"></a>
Preparation</h2>
<p>At startup, any Peano application will want to configure its MPI and shared memory environment. For this, Peano provides some routines:</p>
<div class="fragment"><div class="line">peano4::initParallelEnvironment(&amp;argc,&amp;argv);</div>
<div class="line">peano4::fillLookupTables();</div>
</div><!-- fragment --><p>peano4::initParallelEnvironment() calls in return all MPI initialisation and hence ensures that the singleton tarch::Rank is properly configured. There are corresponding shutdown routines as well.</p>
<h2><a class="anchor" id="autotoc_md1051"></a>
Set up the spacetree</h2>
<p>The set of spacetrees in Peano is, atm, unique, i.e. there is only one set. However, the set can host multiple trees, which basically means you apply domain decomposition. To create the spacetree set, you can use</p>
<div class="fragment"><div class="line">peano4::initSingletons(</div>
<div class="line">  {0.0, 0.0, 0.0},</div>
<div class="line">  {1.0, 1.0, 1.0}</div>
<div class="line">);</div>
</div><!-- fragment --><p>where the first argument is the offset of the computational domain and the second argument is the bounding box. The line creates a trivial spacetree, i.e. a degenerated tree spanning a 3x3 (2d) or 3x3x3 (3d) mesh. You can later on refine it, but this is where we start. If you have many ranks, only the first rank will hold a tree initially. All other ranks host an empty spacetree set.</p>
<h2><a class="anchor" id="autotoc_md1052"></a>
Run through a mesh</h2>
<p>Peano realises an SPMD paradigm, i.e. if one rank runs through its spacetrees, all ranks have to traverse their trees. Furthermore, if one rank uses a particular observer for one traversal, all other traversals have to use the same observer, too.</p>
<p>A simple way to ensure this is to let the global master set a counter/id which uniquely identifies which step to run next. It then says `&lsquo;go ahead&rsquo;' and runs this step itself. All the other ranks are noticed (via an internal broadcast in the core) which step to run, do the same thing, and then wait for the next wake-up call. At the end, the global master sets the id of a terminate. As all the ranks loop until they receive this terminate id, they do go down as well in the end. The code for this resembles</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/dfe/classtarch_1_1mpi_1_1Rank.html#a61a8765012b4b650f0c35a8ece0927bd">tarch::mpi::Rank::getInstance</a>().isGlobalMaster() ) {</div>
<div class="line">  <span class="keywordflow">while</span> ( <a class="code hl_function" href="../../d5/db2/MatrixFreeMain_8template_8cpp.html#a832439084ea25145fd3b2894160a520b">selectNextAlgorithmicStep</a>() ) {</div>
<div class="line">    <a class="code hl_function" href="../../d5/db2/MatrixFreeMain_8template_8cpp.html#ac6bf1a12c5c98ddec5b65e07fe74cabe">step</a>();</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span> {</div>
<div class="line">  <span class="keywordflow">while</span> (<a class="code hl_function" href="../../d8/dde/classpeano4_1_1parallel_1_1Node.html#a7bc31c5e9f0f24785ae7e19d7add30c0">peano4::parallel::Node::getInstance</a>().continueToRun()) {</div>
<div class="line">    <a class="code hl_function" href="../../d5/db2/MatrixFreeMain_8template_8cpp.html#ac6bf1a12c5c98ddec5b65e07fe74cabe">step</a>();</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aMatrixFreeMain_8template_8cpp_html_a832439084ea25145fd3b2894160a520b"><div class="ttname"><a href="../../d5/db2/MatrixFreeMain_8template_8cpp.html#a832439084ea25145fd3b2894160a520b">selectNextAlgorithmicStep</a></div><div class="ttdeci">bool selectNextAlgorithmicStep()</div><div class="ttdef"><b>Definition</b> <a href="../../d5/db2/MatrixFreeMain_8template_8cpp_source.html#l00058">MatrixFreeMain.template.cpp:58</a></div></div>
<div class="ttc" id="aMatrixFreeMain_8template_8cpp_html_ac6bf1a12c5c98ddec5b65e07fe74cabe"><div class="ttname"><a href="../../d5/db2/MatrixFreeMain_8template_8cpp.html#ac6bf1a12c5c98ddec5b65e07fe74cabe">step</a></div><div class="ttdeci">void step()</div><div class="ttdef"><b>Definition</b> <a href="../../d5/db2/MatrixFreeMain_8template_8cpp_source.html#l00184">MatrixFreeMain.template.cpp:184</a></div></div>
<div class="ttc" id="aclasspeano4_1_1parallel_1_1Node_html_a7bc31c5e9f0f24785ae7e19d7add30c0"><div class="ttname"><a href="../../d8/dde/classpeano4_1_1parallel_1_1Node.html#a7bc31c5e9f0f24785ae7e19d7add30c0">peano4::parallel::Node::getInstance</a></div><div class="ttdeci">static Node &amp; getInstance()</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d73/Node_8cpp_source.html#l00077">Node.cpp:77</a></div></div>
<div class="ttc" id="aclasstarch_1_1mpi_1_1Rank_html_a61a8765012b4b650f0c35a8ece0927bd"><div class="ttname"><a href="../../d3/dfe/classtarch_1_1mpi_1_1Rank.html#a61a8765012b4b650f0c35a8ece0927bd">tarch::mpi::Rank::getInstance</a></div><div class="ttdeci">static Rank &amp; getInstance()</div><div class="ttdoc">This operation returns the singleton instance.</div><div class="ttdef"><b>Definition</b> <a href="../../d5/dcd/Rank_8cpp_source.html#l00525">Rank.cpp:525</a></div></div>
</div><!-- fragment --><p>where the routine <a class="el" href="../../d5/db2/MatrixFreeMain_8template_8cpp.html#a832439084ea25145fd3b2894160a520b">selectNextAlgorithmicStep()</a>} issues one call of <a class="el" href="../../d8/dde/classpeano4_1_1parallel_1_1Node.html#a7bc31c5e9f0f24785ae7e19d7add30c0">peano4::parallel::Node::getInstance()</a>.setNextProgramStep().</p>
<p>The <code><a class="el" href="../../d5/db2/MatrixFreeMain_8template_8cpp.html#ac6bf1a12c5c98ddec5b65e07fe74cabe">step()</a></code> routine then is usually a big switch statement:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> stepIdentifier = <a class="code hl_function" href="../../d8/dde/classpeano4_1_1parallel_1_1Node.html#a7bc31c5e9f0f24785ae7e19d7add30c0">peano4::parallel::Node::getInstance</a>().<a class="code hl_function" href="../../d8/dde/classpeano4_1_1parallel_1_1Node.html#a47a6f4a7920541f3d68afcc3a8c3c72f">getCurrentProgramStep</a>();</div>
<div class="line"><span class="keywordflow">switch</span> (stepIdentifier) {</div>
<div class="line">  <span class="keywordflow">case</span> 0:</div>
<div class="line">    {</div>
<div class="line">      observers::CreateGrid  observer;</div>
<div class="line">      <a class="code hl_function" href="../../da/d58/classpeano4_1_1parallel_1_1SpacetreeSet.html#aaf5202ec306988b5b7a2226ef01908cc">peano4::parallel::SpacetreeSet::getInstance</a>().<a class="code hl_function" href="../../da/d58/classpeano4_1_1parallel_1_1SpacetreeSet.html#af3302644e7f7848b653167f1502f3554">traverse</a>(observer);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> 1:</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// split up domain</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclasspeano4_1_1parallel_1_1Node_html_a47a6f4a7920541f3d68afcc3a8c3c72f"><div class="ttname"><a href="../../d8/dde/classpeano4_1_1parallel_1_1Node.html#a47a6f4a7920541f3d68afcc3a8c3c72f">peano4::parallel::Node::getCurrentProgramStep</a></div><div class="ttdeci">int getCurrentProgramStep() const</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d73/Node_8cpp_source.html#l00420">Node.cpp:420</a></div></div>
<div class="ttc" id="aclasspeano4_1_1parallel_1_1SpacetreeSet_html_aaf5202ec306988b5b7a2226ef01908cc"><div class="ttname"><a href="../../da/d58/classpeano4_1_1parallel_1_1SpacetreeSet.html#aaf5202ec306988b5b7a2226ef01908cc">peano4::parallel::SpacetreeSet::getInstance</a></div><div class="ttdeci">static SpacetreeSet &amp; getInstance()</div><div class="ttdef"><b>Definition</b> <a href="../../d2/df0/SpacetreeSet_8cpp_source.html#l00029">SpacetreeSet.cpp:29</a></div></div>
<div class="ttc" id="aclasspeano4_1_1parallel_1_1SpacetreeSet_html_af3302644e7f7848b653167f1502f3554"><div class="ttname"><a href="../../da/d58/classpeano4_1_1parallel_1_1SpacetreeSet.html#af3302644e7f7848b653167f1502f3554">peano4::parallel::SpacetreeSet::traverse</a></div><div class="ttdeci">void traverse(peano4::grid::TraversalObserver &amp;observer)</div><div class="ttdoc">Invoke traverse on all spacetrees in parallel.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/df0/SpacetreeSet_8cpp_source.html#l00461">SpacetreeSet.cpp:461</a></div></div>
</div><!-- fragment --><p>Nothing stops you from triggering multiple traversals (or none at all) within a step, as long as all ranks do exactly the same.</p>
<p>The numbers within the case statements are kind of magic constants and you can redefine them. However, I recommend to read the documentation of <a class="el" href="../../d8/dde/classpeano4_1_1parallel_1_1Node.html#a8a2b782cd625b91d5fdfb97b56f18caa" title="The user tells the set which program step to use, i.e.">peano4::parallel::Node::setNextProgramStep()</a>. There are some predefined constants that you should not use.</p>
<h2><a class="anchor" id="autotoc_md1053"></a>
Python API</h2>
<p>If you use the Python API, you specify the individual algorithmic steps of interest. The generator creates one observer per step (hosted in a generated subdirectory observers) and it also generates a subdirectory repositories.</p>
<p>repositories in turn hosts a generated class StepRepository. It defines a big enumeration for all potential steps, i.e. you don't have to write the switch statements over your own integers. You can exchange the enums. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../dd/da2/page_peano4_home.html">Peano 4</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:05 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
