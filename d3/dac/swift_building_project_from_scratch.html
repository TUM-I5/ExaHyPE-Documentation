<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d3/dac/swift_building_project_from_scratch.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Building your project from scratch</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1089"></a>
Introduction</h1>
<p>Our interface for Swift 2 is almost complete realised in Python. We configure the whole simulation in Python, but typically make the key steps of a simulation point to generic C++ routines which are shipped with Peano 4. Alterantively, we can inject C++ code manually into the Python code (which is great for prototyping). Once the Python script is executed, it generates a plain C++ code with a makefile which waves Peano's core and the SPH kernels together.</p>
<p>Before you start, make sure you configured and compiled <a class="el" href="../../df/de6/namespacePeano4.html" title="-core-datatypes This Python script uses/invokes DaStGen2 to generate all the datatypes required by th...">Peano4</a> correctly so that Swift2 can run. See <a class="el" href="../../d6/dba/page_swift2_home.html#section_compile_peano4_for_swift2">the instructions</a>. Once Peano's core libraries are all built, you can start to write a proper Swift application:</p>
<h1><a class="anchor" id="autotoc_md1090"></a>
Generating a swift2.project</h1>
<p>We start with the creation of a Swift 2 project:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> swift2</div>
<div class="line">project = <a class="code hl_class" href="../../d4/dd4/classswift2_1_1Project_1_1Project.html">swift2.Project</a>( namespace=[<span class="stringliteral">&#39;&#39;&#39;benchmarks&#39;&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;&#39;swift2&#39;&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;&#39;planetorbit&#39;&#39;&#39;</span>],</div>
<div class="line">                          project_name=<span class="stringliteral">&#39;&#39;&#39;planetorbit&#39;&#39;&#39;</span>,</div>
<div class="line">                          executable=orbit-exec )</div>
<div class="ttc" id="aclassswift2_1_1Project_1_1Project_html"><div class="ttname"><a href="../../d4/dd4/classswift2_1_1Project_1_1Project.html">swift2.Project.Project</a></div><div class="ttdoc">Swift2 project.</div><div class="ttdef"><b>Definition</b> <a href="../../de/d29/python_2swift2_2Project_8py_source.html#l00024">Project.py:24</a></div></div>
</div><!-- fragment --><p>You can find the source file for the project class in <code><a class="el" href="../../de/d29/python_2swift2_2Project_8py.html">python/swift2/Project.py</a></code>.</p>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000080">Todo</a></b></dt><dd>Document parameters either here or in the py file itself. If you document it there, make sure to write here for users to look there for documentation.</dd></dl>
<h1><a class="anchor" id="autotoc_md1091"></a>
Generating a Particle Species</h1>
<p>Next, we have to add a particle species. We need to define both the data that a particle species holds, as well as its life cycle, i.e. all the (algorithmic) steps it needs to go through over a single simulation step. For a concrete working example, see <code><a class="el" href="../../d6/d2e/SPHLeapfrogFixedSearchRadius_8py.html">SPHLeapfrogFixedSearchRadius.py</a></code>.</p>
<h2><a class="anchor" id="autotoc_md1092"></a>
Generating Particle Data Fields</h2>
<p>The definition of a particle is straightforward. We employ a tool called DaStGen 2 which really just is a set of Python classes which represent the attributes of a C++ class. See <a class="el" href="../../dd/db7/page_dastgen_home.html">DaStGen</a> for more details on DaStGen.</p>
<p>We build up a set of Python objects sketching a C++ struct and Swift 2 and DaStGen eventually dump them into proper C++ code from which it is embedded into the actual simulator. For example, to create a new particle species which has a mass and velocity, we run:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> dastgen2</div>
<div class="line"> </div>
<div class="line">particle = <a class="code hl_class" href="../../d5/d3d/classpeano4_1_1toolbox_1_1particles_1_1Particle_1_1Particle.html">peano4.toolbox.particles.Particle</a>(<span class="stringliteral">&#39;&#39;&#39;Particle&#39;&#39;&#39;</span>)</div>
<div class="line"> </div>
<div class="line">v_attr = <a class="code hl_class" href="../../db/d97/classpeano4_1_1dastgen2_1_1Peano4DoubleArray_1_1Peano4DoubleArray.html">peano4.dastgen2.Peano4DoubleArray</a>(<span class="stringliteral">&#39;&#39;&#39;v&#39;&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;&#39;Dimensions&#39;&#39;&#39;</span>)</div>
<div class="line">mass_attr = <a class="code hl_class" href="../../df/de4/classdastgen2_1_1attributes_1_1Double_1_1Double.html">dastgen2.attributes.Double</a>(<span class="stringliteral">&#39;&#39;&#39;mass&#39;&#39;&#39;</span>)</div>
<div class="line"> </div>
<div class="line">particle.data.add_attribute(v_attr)</div>
<div class="line">particle.data.add_attribute(mass_attr)</div>
<div class="ttc" id="aclassdastgen2_1_1attributes_1_1Double_1_1Double_html"><div class="ttname"><a href="../../df/de4/classdastgen2_1_1attributes_1_1Double_1_1Double.html">dastgen2.attributes.Double.Double</a></div><div class="ttdoc">cardinality is a string (you can thus use symbols as well as long as they will be defined at compile ...</div><div class="ttdef"><b>Definition</b> <a href="../../da/df9/Double_8py_source.html#l00006">Double.py:6</a></div></div>
<div class="ttc" id="aclasspeano4_1_1dastgen2_1_1Peano4DoubleArray_1_1Peano4DoubleArray_html"><div class="ttname"><a href="../../db/d97/classpeano4_1_1dastgen2_1_1Peano4DoubleArray_1_1Peano4DoubleArray.html">peano4.dastgen2.Peano4DoubleArray.Peano4DoubleArray</a></div><div class="ttdoc">Specialisation of array using Peano's tarch.</div><div class="ttdef"><b>Definition</b> <a href="../../da/dfe/Peano4DoubleArray_8py_source.html#l00007">Peano4DoubleArray.py:7</a></div></div>
<div class="ttc" id="aclasspeano4_1_1toolbox_1_1particles_1_1Particle_1_1Particle_html"><div class="ttname"><a href="../../d5/d3d/classpeano4_1_1toolbox_1_1particles_1_1Particle_1_1Particle.html">peano4.toolbox.particles.Particle.Particle</a></div><div class="ttdoc">Single particle.</div><div class="ttdef"><b>Definition</b> <a href="../../da/d23/peano4_2toolbox_2particles_2Particle_8py_source.html#l00010">Particle.py:10</a></div></div>
</div><!-- fragment --><dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000081">Todo</a></b></dt><dd>what are minimal required particle fields? Shall we hardcode them? If hardcoded, document what fields are always present. If not, document what fields need to be present.</dd></dl>
<h2><a class="anchor" id="autotoc_md1093"></a>
Generating Particle Parameters</h2>
<p>It may be useful to introduce parameters which are valid for your entire particle species. For example, you want need a particle independent CFL factor, or maximal smoothing length, or resolution, etc. This can easily be achieved through use of <code>static</code> (or even <code>const static</code>) class variables, which you can also generate using DaStGen2. See the corresponding documentation on <a class="el" href="../../dd/db7/page_dastgen_home.html">DaStGen</a>.</p>
<h2><a class="anchor" id="autotoc_md1094"></a>
Generating the Particle Life Cycle</h2>
<p>With the particle data defined, we can now set up what equations are being solved, and in which order, for each particle for each simulation step. This is documented in detail on the <a class="el" href="../../d2/daf/swift_particle_new_solver.html">Creating new particle types (solvers) with new algorithmic steps</a> page.</p>
<p>If you are planning on using a new solver, you will need to write new solver kernels. Consult the documentation on that given on the <a class="el" href="../../d2/daf/swift_particle_new_solver.html">create your own solver</a> page.</p>
<h1><a class="anchor" id="autotoc_md1095"></a>
Setting Global Simulation Parameters</h1>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000082">Todo</a></b></dt><dd>all of this, once it converges. I want to move the majority of parameters away from users and from individual project .py files. No point in users specifying KERNEL_GAMMAs etc.</dd></dl>
<p>To set the global simulation parameters, you need to call the corresponding method:</p>
<div class="fragment"><div class="line">domain_size = [ 2, 2, 2 ]</div>
<div class="line">offset      = [ 0, 0, 0 ]</div>
<div class="line"> </div>
<div class="line">project.set_global_simulation_parameters(</div>
<div class="line">  dimensions            = dimensions,</div>
<div class="line">  offset                = offset,</div>
<div class="line">  domain_size           = domain_size,</div>
<div class="line">  min_end_time          = args.end_time,</div>
<div class="line">  max_end_time          = 0.0,</div>
<div class="line">  first_plot_time_stamp = 0.0,</div>
<div class="line">  time_in_between_plots = args.plot_delta,</div>
<div class="line">  periodic_BC           = periodic_boundary_conditions,</div>
<div class="line">  plotter_precision     = 8</div>
<div class="line">)</div>
</div><!-- fragment --><dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000083">Todo</a></b></dt><dd>document units here: time and spatial.</dd></dl>
<p>The <code>domain_size</code> parameter determines how big your simulation box is, while <code>offset</code> allows you to translate the lower left corner of the box by the specified amount. Note that the code will not check whether the particles you specify in the initial conditions are also inside the simulation domain. If they aren't, they'll simply be discarded, and the code will continue to do its thing unbothered by it.</p>
<h1><a class="anchor" id="autotoc_md1096"></a>
Special Steps</h1>
<p>Aside from the algorithmic steps particles go through each simulation step, there are some special steps to be taken care of.</p>
<h2><a class="anchor" id="autotoc_md1097"></a>
Initial Setup</h2>
<h3><a class="anchor" id="autotoc_md1098"></a>
Reading Initial Conditions</h3>
<p>See <a class="el" href="../../d4/d9b/swift_initial_conditions.html">Initial conditions, particle insertion and initial mesh construction</a> for options (hdf5/inserting)</p>
<p>Then use</p>
<div class="fragment"><div class="line">project.algorithm_step_initial_conditions.add_action_set(...)</div>
</div><!-- fragment --><dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000084">Todo</a></b></dt><dd>elaborate</dd></dl>
<p>Note that it is your responsibility to make sure that the <code>domain_offset</code> and the <code>domain_size</code> parameters match the particle coordinates you specify in the initial conditions. Particles outside the domain will be discarded.</p>
<h3><a class="anchor" id="autotoc_md1099"></a>
Inital Step</h3>
<p>After the particles have been read in, some further set-up is needed. For example, we need to compute the smoothing lengths and densities of the particles in order to compute their time step size before the first step can begin.</p>
<p>For details on how to implement the sequence of initialization steps, consult <a class="el" href="../../d2/daf/swift_particle_new_solver.html">Creating new particle types (solvers) with new algorithmic steps</a>.</p>
<h2><a class="anchor" id="autotoc_md1100"></a>
Writing Output</h2>
<p>You need to specify a plotter, and which particle quantities to write.</p>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000085">Todo</a></b></dt><dd>Go into plotter details. Maybe wait for swift-like hdf5 output.</dd></dl>
<h1><a class="anchor" id="autotoc_md1101"></a>
Building the Project</h1>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000086">Todo</a></b></dt><dd>this</dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d6/dba/page_swift2_home.html">Swift 2</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:06 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
