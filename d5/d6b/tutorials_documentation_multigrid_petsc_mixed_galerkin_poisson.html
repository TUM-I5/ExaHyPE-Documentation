<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d5/d6b/tutorials_documentation_multigrid_petsc_mixed_galerkin_poisson.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Mixed Galerkin for the Poisson equation with PETSc</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><ul><li class="level3"><a href="#autotoc_md649">Remarks on DG vs CG</a></li>
</ul>
</ul>
<li class="level1"><a href="#autotoc_md650">Mapping onto Peano&#39;s PETSc multigrid extension</a></li>
</ul>
</div>
<div class="textblock"><p>A brief, informal discussion how to implement mixed Galerkin methods with PETSc within Peano.</p>
<p>This is a brief discussion of key ideas behind Mixed Galerkin (DG) methods. While we discuss some of the mathematics behind mixed formulations, the text is informal (from a maths point of view) but puts special emphasis on how numerical concepts are mapped onto Peano's data structures and mesh traversal. We focus notably on the combination of mixed methods with <a class="el" href="../../d3/d42/tutorials_documentation_multigrid_petsc_discontinuous_galerkin_poisson.html">Discontinous Galerkin</a> methods. One can use mixed continuous Galerkin methods, but they are not particular widespread due to multiple numerical issues. The script code resulting from this tutorial can be found in benchmarks/multigrid/petsc/mixed.py.</p>
<h3><a class="anchor" id="autotoc_md649"></a>
Remarks on DG vs CG</h3>
<p>If we use a mixed formulation within globally continuous shape functions, the boundary integrals over \( u \) disappear as they form a telescope sum. The fact that \( u \) is continuous however does not imply that the gradients are continuous, too. Unless we enforce this, we have to use a DG method for the "mixed" part of the equations even though we kicked off with a CG model for the primary unknown.</p>
<p>In general, having a continuous space for both types of quantities implies that the spaces are not compatible with each other: A continuous \( \phi \) space is too restrictive to represent the derivatives. If we try to "approximate" them therein, we will end up with some inconsistent representations.</p>
<p>Therefore DG is a natural choice for mixed formulations. As we need DG for the helper PDEs anyway, it is reasonably to start with DG from the first place. It makes no sense to change your working horse.</p>
<p>With DG in place, we note that we will need a <a class="el" href="../../d5/d0e/namespaceRusanov.html">Rusanov</a> solver for the arising terms along the faces, which are, once again, not analytically defined. Different to the introductory DG discussion, we now have multiple jumps to take into account. For the Poisson equation, e.g.,</p>
<ul>
<li>\( (n, \phi ) \) does not exist on the faces of a cell. It jumps. The term \( \int_{\partial \text{cell}_{v _\phi }} (n \cdot \phi) v _\phi dS(x) \) in the first weak formulation therefore does not make sense.</li>
<li>\( u \) does not exist on the faces of a cell. It jumps. The term \( \int _{\partial \text{cell}_{v _u}}  u \cdot (n, v _u) dS(x) \) in the second weak formulation therefore does not make sense.</li>
</ul>
<p>These terms that make no sense require special attention, and this is the fundamental "plug-in" point for hybrid DG. We however stick to details on mixed Galerkin on this page.</p>
<h1><a class="anchor" id="autotoc_md650"></a>
Mapping onto Peano's PETSc multigrid extension</h1>
<p>Once we commit to the formulation</p>
<p class="formulaDsp">
\begin{eqnarray*}
  - \text{div} \ \phi &amp; = &amp; f, \\
  \nabla u &amp; = &amp; \phi. 
\end{eqnarray*}
</p>
<p>and omit, for the time being, the right-hand side, as see that this system of PDEs translates 1:1 onto two <a class="el" href="../../d3/d42/tutorials_documentation_multigrid_petsc_discontinuous_galerkin_poisson.html">Discontinuous Galerkin</a> solvers:</p>
<div class="fragment"><div class="line">primary_solver = multigrid.petsc.solvers.DiscontinuousGalerkinDiscretisation(name                 = <span class="stringliteral">&quot;Poisson_PrimaryVariable&quot;</span>,</div>
<div class="line">                                                                     polynomial_degree    = args.degree,</div>
<div class="line">                                                                     cell_unknowns        = 1,                      # unknowns_per_cell_dof,</div>
<div class="line">                                                                     face_unknowns        = 1,                      # unknowns_per_face_dof,</div>
<div class="line">                                                                     dimensions           = args.dimensions,</div>
<div class="line">                                                                     cell_cell_rhs_matrix   = [...],     </div>
<div class="line">                                                                     cell_cell_lhs_matrix   = [...],</div>
<div class="line">                                                                     cell_cell_lhs_matrix_scaling = args.dimensions-1,</div>
<div class="line">                                                                     cell_cell_rhs_matrix_scaling = args.dimensions,</div>
<div class="line">                                                                     [...]</div>
<div class="line">                                                                     )</div>
<div class="line">gradient_solver = multigrid.petsc.solvers.DiscontinuousGalerkinDiscretisation(name                 = <span class="stringliteral">&quot;Poisson_Gradients&quot;</span>,</div>
<div class="line">                                                                     polynomial_degree    = args.degree,</div>
<div class="line">                                                                     cell_unknowns        = args.dimensions,        # unknowns_per_cell_dof,</div>
<div class="line">                                                                     face_unknowns        = 1,                      # unknowns_per_face_dof,</div>
<div class="line">                                                                     dimensions           = args.dimensions,</div>
<div class="line">                                                                     cell_cell_rhs_matrix   = [...],     </div>
<div class="line">                                                                     cell_cell_lhs_matrix   = [...],</div>
<div class="line">                                                                     cell_cell_lhs_matrix_scaling = args.dimensions-1,</div>
<div class="line">                                                                     cell_cell_rhs_matrix_scaling = [...],</div>
<div class="line">                                                                     [...]</div>
<div class="line">                                                                     )</div>
</div><!-- fragment --><p>The primary solver is a scalar <a class="el" href="../../da/db8/namespacePDE.html">PDE</a>, where we have a derivative on the left-hand side. As we integrate over the domain left and right, we get a scaling of \( h^{d-1} \) on the left-hand and a scaling of \( h^{d} \) on the right-hand side. These scalings are encoded within cell_cell_lhs_matrix_scaling and cell_cell_rhs_matrix_scaling.</p>
<p>The gradient solver represents a system of PDEs with \( d \) unknowns/equations. Again we have one derivative on the left-hand side and therefore a scaling of \( h^{d-1} \). Different to the primary solver, we do not project the "whole" approximation onto the face (which is only a scalar anyway, so the term "whole" makes limited sense"), but we only 
the normal component. Therefore, this solver uses

@icode 
face_unknowns        = 1
@endicode 

two even though the cells' hold vector unknowns.

The other ingredients, i.e. the Riemann solver and the cell-to-face projections
all follow 1:1 the discussion for the 
@ref tutorials_documentation_multigrid_petsc_discontinuous_galerkin_poisson "Discontinuous Galerkin" solver. We have to set them per <a class="el" href="../../da/db8/namespacePDE.html">PDE</a> system, but they are totally analogous.</p>
<p>The coupling between the two solvers is realised through the right-hand side of the gradient_solver. This part requires some work (it is actually the only part that requires additional work compared to the discontinuous Galerkin), as the solvers, so far, know nothing of each other:</p>
<div class="fragment"><div class="line">gradient_solver.right_hand_size_assembly = xxxxx</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d3/da3/page_multigrid_home.html">MGHyPE</a></li><li class="navelem"><a class="el" href="../../d4/d49/page_mghype_tutorials.html">Tutorials</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:00 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
