<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d7/dbe/page_exahype_amr.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Adaptive mesh refinement</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3><a class="anchor" id="autotoc_md852"></a>
Adding adaptive mesh refinement (AMR)</h3>
<p>AMR is application- and numerics-specific. Therefore, the signatures of the routines discussed below might change if you switch from Finite Volumes to ADER-DG, e.g. The discussed principles however always are the same.</p>
<p>By default,  solvers operate on a regular grid. To facilitate an adaptive mesh, you have to ensure that your solver is aware that you operate with different $h_{\text{max}}&gt;h_{\text{min}}$. So you have to alter these two flags of your solver instantiation. As  operates with three-partitioning, you have to pick $h_{\text{min}} \leq \frac{1}{3} h_{\text{max}}$ to switch on adaptivity.</p>
<p>Once AMR is, in principle enabled, you still have to supplement a refinement and/or coarsening criterion:</p>
<p><a class="anchor" id="autotoc_md853"></a> </p><h5>Supplementing the refinement criterion</h5>
<p>On the Python side, dynamic adaptivity is added via a one-liner:</p>
<p>Once you did rerun your Python script, you have to add your solver a new routine:</p>
<p>If this is the first time you create your solver,  adds this routine into the solver blueprint. If you add AMR to an existing solver, you have to add the routine manually, as 's code generator never overwrites a user solver. A simple default implementation of this routine resembles</p>
<p>This version does not (yet) any adaptivity. Your solver returns <code>Keep</code> all the time, so  will create a mesh that just matches $h_{\text{max}}$ as specified via the solver and then keep this match. Once you return <code>Refine</code>, it will however refine. If your mesh however becomes finer than your solver's $h_{\text{min}}$,  will ignore the refinement request of your  solver.</p>
<p><code>Keep</code> keeps the mesh as it is. That is, if you return <code>Keep</code> for an adaptive grid part, this part will not change. You have to invoke <code>Erase</code>[^1]. Both erase and keep are only recommendations to &mdash; will try to meet these requests, but will always make the mesh slightly finer or not refine if the minimum mesh size would be violated too harshly. That is, if some parts of the mesh ask for a refinement and direct neighbours want to coarsen, the refinement gets higher priority. Along the same lines, erase instructions will simply be ignored if the resulting mesh would be coarser than $h_{\text{max}}$.</p>
<p>It is important to keep in mind that refinement requests are not immediately realised by . Refinements are requested in one time step, and then realised in the subsequent one. Also,  will try to accommodate coarsening requests, but if there are any issues (with mesh partitioning or balancing, e.g.), then these considerations willl have higher priority and  might decide to continue with a finer mesh than requested.</p>
<p>Different solvers come along with different interpolation and restriction seems. The discussion around Finite Volume solvers for example can be found on page .</p>
<h2><a class="anchor" id="autotoc_md854"></a>
Interpolation and restriction schemes for Finite Volumes {#section:exahype:finite-volumes:interpolation-schemes}</h2>
<p>If you employ adaptive mesh refinement, you have to project coarser resolutions onto finer resolutions (interpolation), and you have to couple back fine grid solutions to coarser regions of the mesh (restriction). By default, all  Finite Volume solvers employ a piece-wise constant interpolation and simple averaging as restriction. If you require a better inter-grid transfer scheme or if you want to introduce your own one, you have to do the following steps:</p>
<ul>
<li>Make your solver (in Python) use another interpolation scheme. I present a variant here where you want to use linear interpolation:</li>
<li>For a different restriction scheme use the routine <code>switch_interpolation_scheme()</code>.</li>
<li>Call the solver's <code>create_action_sets()</code>. If you omit this call, your switch of the scheme is not "committed", i.e. taken into account (though subsequent changes of the solver state might in turn call <code>create_action_sets()</code> and thus implicitly make your switch known to the class).</li>
<li>Depending on your Finite Volume scheme, you might have to change the size of the halo layer. The <a class="el" href="../../d5/d0e/namespaceRusanov.html">Rusanov</a> solvers for example all work with a halo layer of 1. They don't need larger overlaps between neighbouring volumes, as the <a class="el" href="../../d5/d0e/namespaceRusanov.html">Rusanov</a> Riemann solver only needs the solution left and right of a face. If you want to use a higher-order interpolation however, you need larger overlaps. In this case, you have to extend the halo layer used:</li>
</ul>
<p><a class="anchor" id="autotoc_md855"></a> </p><h5>Realisation and available schemes</h5>
<p>All the interpolation and restriction schemes that we offer can be found in the file <code><a class="el" href="../../df/d2a/Interpolation_8h.html">toolbox/blockstructured/Interpolation.h</a></code>. The documentation within this file[^3] explains how the actual realisations work. 's philosophy is that you implement the inter-grid transfer operators within this header, and the Python API then helps you to pick from the routines therein.</p>
<p>At the moment, we have only implemented <code>averaging</code> for the restriction. For the interpolation, we offer the following routines: </p><pre class="fragment">scheme**                                                             description
</pre> <hr  />
<p> <code>piecewise_constant</code> Interpolate piece-wise constant (default) <code>linear_with_constant_extrapolation</code> Interpolate linear (2d) or bi-linear (3d) along faces and use constant extrapolation along diagonals and patch boundaries. <code>linear_with_linear_extrapolation</code> Interpolate linear (2d) or bi-linear (3d) along faces and use constant extrapolation along diagonals and patch boundaries. <code>linear_with_constant_extrapolation_and_linear_normal_interpolation</code> Variation of <code>constant_with_constant_extrapolation</code> where we interplate linearly between restricted (coarsened) voxel data and the adjacent real coarse grid values. <code>linear_with_linear_extrapolation_and_linear_normal_interpolation</code> Variation of <code>linear_with_constant_extrapolation</code> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d3/d82/page_exahype2_home.html">ExaHyPE 2</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:04 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
