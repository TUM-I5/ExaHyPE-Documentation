<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('de/d40/page_toolbox_particles_realisation_particle_lift_flavours.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Particle list flavours</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are different flavours (implementations) how to administer and store particle sets.</p>
<p>The particle set flavours can be controlled via the generator object within <a class="el" href="../../d7/d5c/namespacepeano4_1_1toolbox_1_1particles_1_1ParticleSet.html">peano4.toolbox.particles.ParticleSet</a>. Consult the documentation there. Each particle set, from the outside, is a collection of pointers to the real particles. However the actual realisation of the sets internally can differ.</p>
<p>The signature design of the set flavours is guided by a few simple principles. They are the same for each flavour. Internally, we have to major realisations:</p>
<ul>
<li><a class="el" href="../../d4/d4d/ParticleSet__ScatteredOnHeap__IndexedByStdContainer_8template_8h.html">peano4/toolbox/particles/ParticleSet_ScatteredOnHeap_IndexedByStdContainer.template.h</a> gives you a realisation which stores pointers to particles on the heap. The container for these pointers can be chosen by the user, i.e. can be either std::vector or std::array or std::set or whatever you like.</li>
<li>peano4/toolbox/particles/ParticleSet_MemoryPool.h is a realisation which internally uses the <a class="el" href="../../db/d9c/toolbox_particles_memorypool.html">memory pool</a> to hold the particles. It then will construct sets of particle pointers over the pool, exploiting the knowledge that the underlying chunks of data are contiguous.</li>
</ul>
<p>Both of these inherit from <a class="el" href="../../d5/ddd/classtoolbox_1_1particles_1_1ParticleSet.html" title="Abstract base class for all flavours of particle sets.">toolbox::particles::ParticleSet</a>. As the exact types per application result from an instantiation of these jinja templates, they cannot be parsed by doxygen. However, you can browse any application code spitting them out for docu (the doxygen template holds info), and we summarise their common interface here:</p>
<h1><a class="anchor" id="autotoc_md1241"></a>
Set traversal operations</h1>
<p>Analogous to a C++ standard container, they offer</p>
<ul>
<li>begin(),</li>
<li>end(),</li>
<li>size()</li>
</ul>
<h1><a class="anchor" id="autotoc_md1242"></a>
clear(), deleteParticle() and deleteParticles()</h1>
<p>The operation clear() on a particle set becomes a shallow clear, as the set administers pointers to particles. The indices are destroyed, the particles themselves remain there. If another stack references the same particles, you neither have a leak nor will you induce an invalid memory access.</p>
<p>The routine deleteParticle() allows you to actually delete a particle (and to remove it from the list). This routine has to be handled with care. If someone else holds a pointer to the underlying particle, this pointer all at a sudden becomes invalid without any further notification.</p>
<p>deleteParticles() is a shortcut to delete all particles associated with a vertex/stack entry.</p>
<h1><a class="anchor" id="autotoc_md1243"></a>
Utility functions</h1>
<p>Routines such as <a class="el" href="../../d1/da7/RefinementControl_8cpp.html#a10fbfa607702e35cf41b838edab3f814">toString()</a> are offered to faciliate <a class="el" href="../../d1/d9e/tarch_logging.html">Logging, tracing, statistics, profiling and assertions</a>.</p>
<h1><a class="anchor" id="autotoc_md1244"></a>
Communication and storage routines</h1>
<ul>
<li>send(const peano4::datamanagement::VertexMarker&amp; marker)</li>
<li>receiveAndMerge(const peano4::datamanagement::VertexMarker&amp; marker)</li>
<li>storePersistently(const peano4::datamanagement::VertexMarker&amp; marker)</li>
<li>loadPersistently(const peano4::datamanagement::VertexMarker&amp; marker)</li>
</ul>
<p>control if particles are to be sent/received or held in-between iterations.</p>
<p>Further to that, the routine mergeWithParticle() defines how to particles held on different subdomains are merged into each other. We receive particle sets from other trees, as well as from sieve sets. These are sent out after particles have been touched for the last time from their previous "owner". mergeWithParticle() merges an incoming particle set from neighbour into the local set, i.e. we run through neighbour and assess what to do with the particles therein. Basically, we look at its state and then decide whether to enqueue the particle here, too. Furthermore, we do some state switches. If a particle is local on another rank for example, it has to be virtual here.</p>
<p>The merge works with shallow copies. We assume that all necessary real copying has been done before. See <a class="el" href="../../da/d58/classpeano4_1_1parallel_1_1SpacetreeSet.html#ae28cbf8f697bc66a1380da56df81b98e" title="Realise domain boundary exchange (over multiple scales)">peano4::parallel::SpacetreeSet::exchangeAllHorizontalDataExchangeStacks()</a> for a discussion of deep copying in this context. If we decide not to insert an incoming particle into our local data structure, we have to destroy it, as the containers for boundary data exchange perform deep copies.</p>
<p>I started with an implementation which first inserts all the particles into the vertex and then eliminates those guys which are redundant. This turns out to be a slow version. It is way faster to find those guys which are to be added and then to check prior to the insert if they really should be added or not.</p>
<h1><a class="anchor" id="autotoc_md1245"></a>
Multiscale transitions</h1>
<p>The particles type is associated with <a class="el" href="../../d5/ddd/classtoolbox_1_1particles_1_1ParticleSet.html" title="Abstract base class for all flavours of particle sets.">toolbox::particles::ParticleSet</a>. The latter holds routines how to manage multiscale transitions along the lines of <a class="el" href="../../db/d91/page_toolbox_particles_mesh_consistency.html">Sorting: Preserving the mesh-particle data consistency</a>.</p>
<h1><a class="anchor" id="autotoc_md1246"></a>
Eliminate spatial duplicates</h1>
<p>The routine eliminateSpatialDuplicates() has to be offered by each vertex set. Run over set and removes one of the two particles that reside at same location.</p>
<p>Such an eliminate of duplicates can be motivated through the merger, where it can happen that multiple ranks tell us about a particle (some of them have virtual copies, some have local ones), as the association of particles to trees is not unique. After all, we work with floating point arithmetics. Those are the bad guys. Keeping redundant particles will introduce wrong physics (doubled forces for example) in many cases, or even lead to crashes (division by zero).</p>
<p>This elimination means that I actually delete the particle held by particleSet. Data is actually freed.</p>
<p>Please consult the discussion on the merger below for some more explanations where and why we need this elimination routine.</p>
<h1><a class="anchor" id="autotoc_md1247"></a>
Clone</h1>
<p>The operation clone() is a deep clone. We get data from somewhere else and create our own version with which we can work from hereon. Besides the particles, we also copy (aka clone) the debug x and h values. The clone itself is mechanical. The actual logic how to keep different cloned stacks consistent is all buried within merge().</p>
<h2><a class="anchor" id="autotoc_md1248"></a>
Constructors</h2>
<p>The copy constructor is a shallow copy constructor. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d7/d66/page_toolbox_home.html">Toolbox</a></li><li class="navelem"><a class="el" href="../../d0/d9e/toolbox_particles.html">Particles</a></li><li class="navelem"><a class="el" href="../../db/dba/page_toolbox_particles_realisation.html">Realisation details</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:07 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
