<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d7/d48/classexahype2_1_1RefinementControl.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle"><div class="title">exahype2::RefinementControl Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Manage refine/erase requests within ExaHyPE 2.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../dc/d99/RefinementControl_8h_source.html">RefinementControl.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for exahype2::RefinementControl:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d31/classexahype2_1_1RefinementControl__coll__graph.png" border="0" usemap="#aexahype2_1_1RefinementControl_coll__map" alt="Collaboration graph"/></div>
<map name="aexahype2_1_1RefinementControl_coll__map" id="aexahype2_1_1RefinementControl_coll__map">
<area shape="rect" title="Manage refine/erase requests within ExaHyPE 2." alt="" coords="1204,70,1420,95"/>
<area shape="rect" href="../../da/d79/classtarch_1_1logging_1_1Log.html" title="Log Device." alt="" coords="899,13,1042,38"/>
<area shape="poly" title=" " alt="" coords="1056,37,1236,67,1235,73,1055,42"/>
<area shape="rect" title=" " alt="" coords="610,13,697,38"/>
<area shape="poly" title=" " alt="" coords="711,23,899,23,899,28,711,28"/>
<area shape="rect" title=" " alt="" coords="293,5,431,45"/>
<area shape="poly" title=" " alt="" coords="445,23,610,23,610,28,445,28"/>
<area shape="rect" href="../../da/d3f/classtarch_1_1multicore_1_1BooleanSemaphore.html" title=" " alt="" coords="877,63,1064,103"/>
<area shape="poly" title=" " alt="" coords="1077,80,1204,80,1204,85,1077,85"/>
<area shape="rect" title=" " alt="" coords="871,127,1071,182"/>
<area shape="poly" title=" " alt="" coords="1084,128,1250,93,1252,98,1085,133"/>
<area shape="rect" title=" " alt="" coords="568,127,739,182"/>
<area shape="poly" title=" " alt="" coords="753,152,870,152,870,157,753,157"/>
<area shape="rect" href="../../dd/de7/structpeano4_1_1grid_1_1GridControlEvent.html" title=" " alt="" coords="269,135,455,175"/>
<area shape="poly" title=" " alt="" coords="468,152,568,152,568,157,468,157"/>
<area shape="rect" href="../../d7/d26/structtarch_1_1la_1_1Vector.html" title=" " alt="" coords="5,135,176,175"/>
<area shape="poly" title=" " alt="" coords="190,152,269,152,269,157,190,157"/>
</map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a5c0973687e496d6cdb435f13e68566da" id="r_a5c0973687e496d6cdb435f13e68566da"><td class="memItemLeft" align="right" valign="top">typedef std::list&lt; std::pair&lt; <a class="el" href="../../dd/de7/structpeano4_1_1grid_1_1GridControlEvent.html">peano4::grid::GridControlEvent</a>, <a class="el" href="../../d1/d99/Prediction_8EnclaveTask_8template_8cpp.html#a61569f2965b7a369eb10b6d75d410d11">int</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5c0973687e496d6cdb435f13e68566da">NewEvents</a></td></tr>
<tr class="separator:a5c0973687e496d6cdb435f13e68566da"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a51cb92feaaaf6f8bb5a8d4a8fa8de67d" id="r_a51cb92feaaaf6f8bb5a8d4a8fa8de67d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a51cb92feaaaf6f8bb5a8d4a8fa8de67d">RefinementControl</a> (<a class="el" href="../../db/d20/DiscontinuousGalerkinDiscretisation_8Abstract_8template_8cpp.html#a962c06c0fea2c76dd28c454654a79417">double</a> tolerance=0.01)</td></tr>
<tr class="separator:a51cb92feaaaf6f8bb5a8d4a8fa8de67d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a054a01c675d0d7d8647a6a194386d274" id="r_a054a01c675d0d7d8647a6a194386d274"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a054a01c675d0d7d8647a6a194386d274">~RefinementControl</a> ()=default</td></tr>
<tr class="separator:a054a01c675d0d7d8647a6a194386d274"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14297687abb70331d28d567522737c66" id="r_a14297687abb70331d28d567522737c66"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d4d/FaceIntegral_8template_8cpp.html#a7ce6528e12d0effe4d57054974659f90">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a14297687abb70331d28d567522737c66">clear</a> ()</td></tr>
<tr class="memdesc:a14297687abb70331d28d567522737c66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears the new events.  <br /></td></tr>
<tr class="separator:a14297687abb70331d28d567522737c66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5762b4640e1a3a9a3ae5baaf9d72c6e9" id="r_a5762b4640e1a3a9a3ae5baaf9d72c6e9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d4d/FaceIntegral_8template_8cpp.html#a7ce6528e12d0effe4d57054974659f90">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5762b4640e1a3a9a3ae5baaf9d72c6e9">addCommand</a> (<a class="el" href="../../de/df3/CustomRiemann_8template_8h.html#a92b303b76a3f942ea819498907d5e83c">const</a> <a class="el" href="../../d7/d26/structtarch_1_1la_1_1Vector.html">tarch::la::Vector</a>&lt; Dimensions, <a class="el" href="../../db/d20/DiscontinuousGalerkinDiscretisation_8Abstract_8template_8cpp.html#a962c06c0fea2c76dd28c454654a79417">double</a> &gt; &amp;x, <a class="el" href="../../de/df3/CustomRiemann_8template_8h.html#a92b303b76a3f942ea819498907d5e83c">const</a> <a class="el" href="../../d7/d26/structtarch_1_1la_1_1Vector.html">tarch::la::Vector</a>&lt; Dimensions, <a class="el" href="../../db/d20/DiscontinuousGalerkinDiscretisation_8Abstract_8template_8cpp.html#a962c06c0fea2c76dd28c454654a79417">double</a> &gt; &amp;h, <a class="el" href="../../dd/d6c/namespaceexahype2.html#afe1fdc194836a25ea6e3954a6cb8f998">exahype2::RefinementCommand</a> command, <a class="el" href="../../d1/d99/Prediction_8EnclaveTask_8template_8cpp.html#a61569f2965b7a369eb10b6d75d410d11">int</a> lifetime)</td></tr>
<tr class="memdesc:a5762b4640e1a3a9a3ae5baaf9d72c6e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a new command.  <br /></td></tr>
<tr class="separator:a5762b4640e1a3a9a3ae5baaf9d72c6e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abeac51ba72010fe3bdd2323abb6a0ef1" id="r_abeac51ba72010fe3bdd2323abb6a0ef1"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abeac51ba72010fe3bdd2323abb6a0ef1">toString</a> () <a class="el" href="../../de/df3/CustomRiemann_8template_8h.html#a92b303b76a3f942ea819498907d5e83c">const</a></td></tr>
<tr class="separator:abeac51ba72010fe3bdd2323abb6a0ef1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a1d7fb56fd53991f054b147449bd2c457" id="r_a1d7fb56fd53991f054b147449bd2c457"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/df3/CustomRiemann_8template_8h.html#a92b303b76a3f942ea819498907d5e83c">const</a> <a class="el" href="../../db/d20/DiscontinuousGalerkinDiscretisation_8Abstract_8template_8cpp.html#a962c06c0fea2c76dd28c454654a79417">double</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1d7fb56fd53991f054b147449bd2c457">_tolerance</a></td></tr>
<tr class="memdesc:a1d7fb56fd53991f054b147449bd2c457"><td class="mdescLeft">&#160;</td><td class="mdescRight">We blow up the region around refinement criterion slightly.  <br /></td></tr>
<tr class="separator:a1d7fb56fd53991f054b147449bd2c457"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fc1d3f179cea03d54c5eae20bedd33d" id="r_a0fc1d3f179cea03d54c5eae20bedd33d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="#a5c0973687e496d6cdb435f13e68566da">NewEvents</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0fc1d3f179cea03d54c5eae20bedd33d">_newEvents</a></td></tr>
<tr class="memdesc:a0fc1d3f179cea03d54c5eae20bedd33d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Container to accumulate new events.  <br /></td></tr>
<tr class="separator:a0fc1d3f179cea03d54c5eae20bedd33d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-static-attribs" name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a4ad60ec97428a63d97cc43b417574d48" id="r_a4ad60ec97428a63d97cc43b417574d48"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../da/d79/classtarch_1_1logging_1_1Log.html">tarch::logging::Log</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4ad60ec97428a63d97cc43b417574d48">_log</a></td></tr>
<tr class="separator:a4ad60ec97428a63d97cc43b417574d48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71f124e21a2b2ac0022f15ee594703de" id="r_a71f124e21a2b2ac0022f15ee594703de"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../da/d3f/classtarch_1_1multicore_1_1BooleanSemaphore.html">tarch::multicore::BooleanSemaphore</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a71f124e21a2b2ac0022f15ee594703de">_semaphore</a></td></tr>
<tr class="separator:a71f124e21a2b2ac0022f15ee594703de"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="friends" name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:ad707c4ab4422193a4286f908c74cb0d6" id="r_ad707c4ab4422193a4286f908c74cb0d6"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad707c4ab4422193a4286f908c74cb0d6">RefinementControlService</a></td></tr>
<tr class="separator:ad707c4ab4422193a4286f908c74cb0d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Manage refine/erase requests within ExaHyPE 2. </p>
<p>This class is a very simple container which collects a point set of refinement and coarsening commands. It then constructs bounding boxes for each command and returns the bounding boxes to Peano 4.</p>
<p>Note: Peano will internally decide to merge many many bounding boxes into fewer, larger ones.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d7/d7c/namespacepeano4_1_1grid.html#abbcd0020ab00eb8d8679323040a08962" title="Merge set of refinement/coarsening commands.">peano4::grid::merge()</a></dd></dl>
<h2><a class="anchor" id="autotoc_md49"></a>
Refinement process</h2>
<p>We have a two stage refinement process in ExaHyPE. These are ExaHyPE-specific stages and they have nothing to do with the fact that we always trigger the refinement and then refine in the subsequent grid sweep, i.e. it has nothing do do with the fact that ExaHyPE needs two grid sweeps to realise (commit) adaptive mesh refinement:</p>
<p>ExaHyPE first collects all refinement requests within this class. These events are called new events. After the sweep, we roll over the refinement requests. We commit them. These committed events then are delivered to the grid traversal automaton. finishStep() does the roll-over, the delivery happens once you call getGridControlEvents() through the AMR observer.</p>
<p>Hence, the overall refinement spawns three grid traversals:</p>
<ul>
<li>The container collects the refinement requests in the first sweep. Towards the end of the sweep, the requests are rolled over (committed).</li>
<li>The second sweep grabs the refinement requests from the container and runs through the mesh. It triggers the refinement for all affected vertices. Nothing is changed yet.</li>
<li>In the third grid sweep, the mesh is refined actually.</li>
</ul>
<p>Due to the overall three-step mechanism, we make the bookkeeping of the events persistent. Each event can potentially survive a couple of sets within the new events. It is rolled over multiple times until it "expires" within the new events.</p>
<dl class="section see"><dt>See also</dt><dd>_committedEvents</dd></dl>
<h2><a class="anchor" id="autotoc_md50"></a>
Multithreading</h2>
<p>As we use the class within a multithreaded environment, Peano 4 creates an observer object per spacetree through a clone from observer no -1 (per rank, so this observer is not really an observer. It is rather an observer prototype) and then asks this observer how to refine. So we design the following pattern:</p>
<ul>
<li>When an observer is created, it creates its own local refinement control.</li>
<li>We hand out refine/erase commands from the global one as this is our globally valid repository.</li>
<li>We accumulate the refine/erase instructions locally. So we <a class="el" href="#a14297687abb70331d28d567522737c66" title="Clears the new events.">clear()</a> our local copy when we start to run through the grid and then pipe all commands into this local object.</li>
<li>When we are done, we merge the local copy back. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="../../dc/d99/RefinementControl_8h_source.html#l00091">91</a> of file <a class="el" href="../../dc/d99/RefinementControl_8h_source.html">RefinementControl.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="a5c0973687e496d6cdb435f13e68566da" name="a5c0973687e496d6cdb435f13e68566da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c0973687e496d6cdb435f13e68566da">&#9670;&#160;</a></span>NewEvents</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::list&lt;std::pair&lt;<a class="el" href="../../dd/de7/structpeano4_1_1grid_1_1GridControlEvent.html">peano4::grid::GridControlEvent</a>, <a class="el" href="../../d1/d99/Prediction_8EnclaveTask_8template_8cpp.html#a61569f2965b7a369eb10b6d75d410d11">int</a>&gt; &gt; <a class="el" href="#a5c0973687e496d6cdb435f13e68566da">exahype2::RefinementControl::NewEvents</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d99/RefinementControl_8h_source.html#l00093">93</a> of file <a class="el" href="../../dc/d99/RefinementControl_8h_source.html">RefinementControl.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a51cb92feaaaf6f8bb5a8d4a8fa8de67d" name="a51cb92feaaaf6f8bb5a8d4a8fa8de67d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51cb92feaaaf6f8bb5a8d4a8fa8de67d">&#9670;&#160;</a></span>RefinementControl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">exahype2::RefinementControl::RefinementControl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/d20/DiscontinuousGalerkinDiscretisation_8Abstract_8template_8cpp.html#a962c06c0fea2c76dd28c454654a79417">double</a></td>          <td class="paramname"><span class="paramname"><em>tolerance</em><span class="paramdefsep"> = </span><span class="paramdefval">0.01</span></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tolerance</td><td>How much should the code add around each grid control. By default we use one percent additional tolerance. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/da7/RefinementControl_8cpp_source.html#l00037">37</a> of file <a class="el" href="../../d1/da7/RefinementControl_8cpp_source.html">RefinementControl.cpp</a>.</p>

</div>
</div>
<a id="a054a01c675d0d7d8647a6a194386d274" name="a054a01c675d0d7d8647a6a194386d274"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a054a01c675d0d7d8647a6a194386d274">&#9670;&#160;</a></span>~RefinementControl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual exahype2::RefinementControl::~RefinementControl </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a5762b4640e1a3a9a3ae5baaf9d72c6e9" name="a5762b4640e1a3a9a3ae5baaf9d72c6e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5762b4640e1a3a9a3ae5baaf9d72c6e9">&#9670;&#160;</a></span>addCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d4d/FaceIntegral_8template_8cpp.html#a7ce6528e12d0effe4d57054974659f90">void</a> exahype2::RefinementControl::addCommand </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/df3/CustomRiemann_8template_8h.html#a92b303b76a3f942ea819498907d5e83c">const</a> <a class="el" href="../../d7/d26/structtarch_1_1la_1_1Vector.html">tarch::la::Vector</a>&lt; Dimensions, <a class="el" href="../../db/d20/DiscontinuousGalerkinDiscretisation_8Abstract_8template_8cpp.html#a962c06c0fea2c76dd28c454654a79417">double</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>x</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/df3/CustomRiemann_8template_8h.html#a92b303b76a3f942ea819498907d5e83c">const</a> <a class="el" href="../../d7/d26/structtarch_1_1la_1_1Vector.html">tarch::la::Vector</a>&lt; Dimensions, <a class="el" href="../../db/d20/DiscontinuousGalerkinDiscretisation_8Abstract_8template_8cpp.html#a962c06c0fea2c76dd28c454654a79417">double</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>h</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d6c/namespaceexahype2.html#afe1fdc194836a25ea6e3954a6cb8f998">exahype2::RefinementCommand</a></td>          <td class="paramname"><span class="paramname"><em>command</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/d99/Prediction_8EnclaveTask_8template_8cpp.html#a61569f2965b7a369eb10b6d75d410d11">int</a></td>          <td class="paramname"><span class="paramname"><em>lifetime</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a new command. </p>
<p>Depending on the context, we add a new refinement instruction interpreting x and h. If you refine, I divide h by three.</p>
<h2><a class="anchor" id="autotoc_md51"></a>
Lifetime of a refinement event</h2>
<p>If a refinement event is triggered, we keep it alive for a while. This avoids oscillations (refinement events always overwrite coarsening) and it helps ranks to catch up - a code might not be able to refine immediately as it implements a Runge-Kutta scheme, e.g. In this case, we keep the event alive and then realise it once the code is ready to do so.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">x</td><td>Centre of the cell for which this command is triggered. This is typically marker.x(). </td></tr>
    <tr><td class="paramname">h</td><td>Size of this cell. Typically marker.h(). </td></tr>
    <tr><td class="paramname">lifetime</td><td>Has to be greater equal 1. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/da7/RefinementControl_8cpp_source.html#l00042">42</a> of file <a class="el" href="../../d1/da7/RefinementControl_8cpp_source.html">RefinementControl.cpp</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d46/Assertions_8h_source.html#l01017">assertion</a>, <a class="el" href="../../dc/d46/Assertions_8h_source.html#l01018">assertion1</a>, <a class="el" href="../../dd/d6c/namespaceexahype2.html#afe1fdc194836a25ea6e3954a6cb8f998aedc187bdea52d6e32b9c0f84e0849ec5">exahype2::Erase</a>, <a class="el" href="../../dd/de7/structpeano4_1_1grid_1_1GridControlEvent.html#a794903045a986f95769e8b5ffda790f5aedc187bdea52d6e32b9c0f84e0849ec5">peano4::grid::GridControlEvent::Erase</a>, <a class="el" href="../../dc/d58/GridControlEvent_8h_source.html#l00051">peano4::grid::GridControlEvent::getH()</a>, <a class="el" href="../../dc/d58/GridControlEvent_8h_source.html#l00046">peano4::grid::GridControlEvent::getWidth()</a>, <a class="el" href="../../dd/d6c/namespaceexahype2.html#afe1fdc194836a25ea6e3954a6cb8f998a02bce93bff905887ad2233110bf9c49e">exahype2::Keep</a>, <a class="el" href="../../d1/d45/Log_8h_source.html#l00050">logDebug</a>, <a class="el" href="../../d1/d45/Log_8h_source.html#l00372">logTraceInWith3Arguments</a>, <a class="el" href="../../d1/d45/Log_8h_source.html#l00380">logTraceOutWith1Argument</a>, <a class="el" href="../../dd/d6c/namespaceexahype2.html#afe1fdc194836a25ea6e3954a6cb8f998a9f79b65055f2201292e5f79666bf2579">exahype2::Refine</a>, <a class="el" href="../../dd/de7/structpeano4_1_1grid_1_1GridControlEvent.html#a794903045a986f95769e8b5ffda790f5a9f79b65055f2201292e5f79666bf2579">peano4::grid::GridControlEvent::Refine</a>, <a class="el" href="../../d0/d1c/GridControlEvent_8cpp_source.html#l00020">peano4::grid::GridControlEvent::toString()</a>, and <a class="el" href="../../d1/da7/RefinementControl_8cpp_source.html#l00021">toString()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d48/classexahype2_1_1RefinementControl_a5762b4640e1a3a9a3ae5baaf9d72c6e9_cgraph.png" border="0" usemap="#ad7/d48/classexahype2_1_1RefinementControl_a5762b4640e1a3a9a3ae5baaf9d72c6e9_cgraph" alt=""/></div>
<map name="ad7/d48/classexahype2_1_1RefinementControl_a5762b4640e1a3a9a3ae5baaf9d72c6e9_cgraph" id="ad7/d48/classexahype2_1_1RefinementControl_a5762b4640e1a3a9a3ae5baaf9d72c6e9_cgraph">
<area shape="rect" title="Add a new command." alt="" coords="5,101,221,141"/>
<area shape="rect" href="../../dd/de7/structpeano4_1_1grid_1_1GridControlEvent.html#aeff6e57d234a462c198644644011a4c4" title=" " alt="" coords="269,5,455,45"/>
<area shape="poly" title=" " alt="" coords="160,99,268,55,288,47,290,52,270,60,162,104"/>
<area shape="rect" href="../../dd/de7/structpeano4_1_1grid_1_1GridControlEvent.html#a8b3ab058e0a891a4f4be0569a14ff606" title=" " alt="" coords="269,69,455,109"/>
<area shape="poly" title=" " alt="" coords="221,105,255,100,256,106,222,110"/>
<area shape="rect" href="../../dd/de7/structpeano4_1_1grid_1_1GridControlEvent.html#aeb9f4a4ef77fd364b6f9bc7f23fa8072" title=" " alt="" coords="269,133,455,173"/>
<area shape="poly" title=" " alt="" coords="222,133,256,137,255,142,221,138"/>
<area shape="rect" href="../../d1/da7/RefinementControl_8cpp.html#a10fbfa607702e35cf41b838edab3f814" title=" " alt="" coords="325,198,399,223"/>
<area shape="poly" title=" " alt="" coords="160,139,270,183,313,196,312,201,268,188,158,144"/>
</map>
</div>

</div>
</div>
<a id="a14297687abb70331d28d567522737c66" name="a14297687abb70331d28d567522737c66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14297687abb70331d28d567522737c66">&#9670;&#160;</a></span>clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d4d/FaceIntegral_8template_8cpp.html#a7ce6528e12d0effe4d57054974659f90">void</a> exahype2::RefinementControl::clear </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clears the new events. </p>
<p>Has no affect for the committed events. This routine should only ever be called by the action sets on their local refinement control assembly. The global one is persistent and should not be cleared by the user, as you would loose all those events that should remain alive. Thererfore, there's no clear for the service. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/da7/RefinementControl_8cpp_source.html#l00040">40</a> of file <a class="el" href="../../d1/da7/RefinementControl_8cpp_source.html">RefinementControl.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/de9/Makefile_8py_source.html#l00020">peano4.output.Makefile.Makefile::__init__()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d48/classexahype2_1_1RefinementControl_a14297687abb70331d28d567522737c66_icgraph.png" border="0" usemap="#ad7/d48/classexahype2_1_1RefinementControl_a14297687abb70331d28d567522737c66_icgraph" alt=""/></div>
<map name="ad7/d48/classexahype2_1_1RefinementControl_a14297687abb70331d28d567522737c66_icgraph" id="ad7/d48/classexahype2_1_1RefinementControl_a14297687abb70331d28d567522737c66_icgraph">
<area shape="rect" title="Clears the new events." alt="" coords="292,5,508,45"/>
<area shape="rect" href="../../dd/d31/classpeano4_1_1output_1_1Makefile_1_1Makefile.html#adf4fc3e8937afe3404f4d2a685147942" title=" " alt="" coords="5,5,244,45"/>
<area shape="poly" title=" " alt="" coords="278,28,244,28,244,23,278,23"/>
</map>
</div>

</div>
</div>
<a id="abeac51ba72010fe3bdd2323abb6a0ef1" name="abeac51ba72010fe3bdd2323abb6a0ef1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abeac51ba72010fe3bdd2323abb6a0ef1">&#9670;&#160;</a></span>toString()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string exahype2::RefinementControl::toString </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/da7/RefinementControl_8cpp_source.html#l00102">102</a> of file <a class="el" href="../../d1/da7/RefinementControl_8cpp_source.html">RefinementControl.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Friends And Related Symbol Documentation</h2>
<a id="ad707c4ab4422193a4286f908c74cb0d6" name="ad707c4ab4422193a4286f908c74cb0d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad707c4ab4422193a4286f908c74cb0d6">&#9670;&#160;</a></span>RefinementControlService</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="../../d4/df3/classexahype2_1_1RefinementControlService.html">RefinementControlService</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d99/RefinementControl_8h_source.html#l00095">95</a> of file <a class="el" href="../../dc/d99/RefinementControl_8h_source.html">RefinementControl.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a id="a4ad60ec97428a63d97cc43b417574d48" name="a4ad60ec97428a63d97cc43b417574d48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ad60ec97428a63d97cc43b417574d48">&#9670;&#160;</a></span>_log</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d79/classtarch_1_1logging_1_1Log.html">tarch::logging::Log</a> exahype2::RefinementControl::_log</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d99/RefinementControl_8h_source.html#l00146">146</a> of file <a class="el" href="../../dc/d99/RefinementControl_8h_source.html">RefinementControl.h</a>.</p>

</div>
</div>
<a id="a0fc1d3f179cea03d54c5eae20bedd33d" name="a0fc1d3f179cea03d54c5eae20bedd33d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fc1d3f179cea03d54c5eae20bedd33d">&#9670;&#160;</a></span>_newEvents</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="#a5c0973687e496d6cdb435f13e68566da">NewEvents</a> exahype2::RefinementControl::_newEvents</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Container to accumulate new events. </p>
<p>This is a list as we may assume that a lot of inserts are done per iteration. </p>

<p class="definition">Definition at line <a class="el" href="../../dc/d99/RefinementControl_8h_source.html#l00159">159</a> of file <a class="el" href="../../dc/d99/RefinementControl_8h_source.html">RefinementControl.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/db6/RefinementControlService_8cpp_source.html#l00086">exahype2::RefinementControlService::merge()</a>.</p>

</div>
</div>
<a id="a71f124e21a2b2ac0022f15ee594703de" name="a71f124e21a2b2ac0022f15ee594703de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71f124e21a2b2ac0022f15ee594703de">&#9670;&#160;</a></span>_semaphore</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d3f/classtarch_1_1multicore_1_1BooleanSemaphore.html">tarch::multicore::BooleanSemaphore</a> exahype2::RefinementControl::_semaphore</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d99/RefinementControl_8h_source.html#l00148">148</a> of file <a class="el" href="../../dc/d99/RefinementControl_8h_source.html">RefinementControl.h</a>.</p>

</div>
</div>
<a id="a1d7fb56fd53991f054b147449bd2c457" name="a1d7fb56fd53991f054b147449bd2c457"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d7fb56fd53991f054b147449bd2c457">&#9670;&#160;</a></span>_tolerance</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/df3/CustomRiemann_8template_8h.html#a92b303b76a3f942ea819498907d5e83c">const</a> <a class="el" href="../../db/d20/DiscontinuousGalerkinDiscretisation_8Abstract_8template_8cpp.html#a962c06c0fea2c76dd28c454654a79417">double</a> exahype2::RefinementControl::_tolerance</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>We blow up the region around refinement criterion slightly. </p>

<p class="definition">Definition at line <a class="el" href="../../dc/d99/RefinementControl_8h_source.html#l00153">153</a> of file <a class="el" href="../../dc/d99/RefinementControl_8h_source.html">RefinementControl.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/exahype2/<a class="el" href="../../dc/d99/RefinementControl_8h_source.html">RefinementControl.h</a></li>
<li>src/exahype2/<a class="el" href="../../d1/da7/RefinementControl_8cpp_source.html">RefinementControl.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dd/d6c/namespaceexahype2.html">exahype2</a></li><li class="navelem"><a class="el" href="../../d7/d48/classexahype2_1_1RefinementControl.html">RefinementControl</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:28 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
