<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dd/d17/page_peano4_tutorials_finite_volumes.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Peano 4 Finite Volumes Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="fragment"><div class="line"><span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"> A very simple example which demonstrates how to configure a patch-based</span></div>
<div class="line"><span class="stringliteral"> Finite Volume solver in Peano4. The code relies on snippets from ExaHyPE2.</span></div>
<div class="line"><span class="stringliteral"> However, it relies only on ExaHyPE&#39;s C/FORTRAN compute kernels, i.e. the </span></div>
<div class="line"><span class="stringliteral"> sophisticated build environment of this H2020 project is not used. The </span></div>
<div class="line"><span class="stringliteral"> solver simulates the simple Euler equations.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># We import Peano4 as project. If this step fails, ensure that your environment</span></div>
<div class="line"><span class="comment"># variable PYTHONPATH points to Peano4&#39;s python directory.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="keyword">import</span> os</div>
<div class="line"><span class="keyword">import</span> peano4</div>
<div class="line"><span class="keyword">import</span> peano4.datamodel</div>
<div class="line"><span class="keyword">import</span> peano4.solversteps</div>
<div class="line"><span class="keyword">import</span> peano4.output</div>
<div class="line"><span class="keyword">import</span> peano4.visualisation</div>
<div class="line"><span class="keyword">import</span> <a class="code hl_namespace" href="../../d7/dfc/namespacepeano4_1_1toolbox_1_1blockstructured.html">peano4.toolbox.blockstructured</a></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># Lets first clean up all plot files, so we don&#39;t get a mismatch</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line">output_files = [ f <span class="keywordflow">for</span> f <span class="keywordflow">in</span> os.listdir(<span class="stringliteral">&quot;.&quot;</span>) <span class="keywordflow">if</span> f.endswith(<span class="stringliteral">&quot;.peano-patch-file&quot;</span>) ]</div>
<div class="line"><span class="keywordflow">for</span> f <span class="keywordflow">in</span> output_files:</div>
<div class="line">  os.remove(f)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># Create a project and configure it to end up in a subnamespace (and thus</span></div>
<div class="line"><span class="comment"># subdirectory). </span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line">project = <a class="code hl_class" href="../../dd/de1/classpeano4_1_1Project_1_1Project.html">peano4.Project</a>( [<span class="stringliteral">&quot;examples&quot;</span>, <span class="stringliteral">&quot;finitevolumes&quot;</span>], <span class="stringliteral">&quot;finitevolumes&quot;</span>, <span class="stringliteral">&quot;.&quot;</span> )</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># The solver will be patch-based, i.e. we will have one patch per cell.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line">patch_size = 13</div>
<div class="line">unknowns   = 5</div>
<div class="line">patch = <a class="code hl_class" href="../../d9/da7/classpeano4_1_1datamodel_1_1Patch_1_1Patch.html">peano4.datamodel.Patch</a>( (patch_size,patch_size,patch_size), unknowns, <span class="stringliteral">&quot;Q&quot;</span> )</div>
<div class="line">project.datamodel.add_cell(patch)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># Along the faces, we have the patch overlaps. As we use only a Rusanov flux, </span></div>
<div class="line"><span class="comment"># one cell of overlap between adjacent patches is sufficient.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line">patch_overlap = <a class="code hl_class" href="../../d9/da7/classpeano4_1_1datamodel_1_1Patch_1_1Patch.html">peano4.datamodel.Patch</a>( (2,patch_size,patch_size), unknowns, <span class="stringliteral">&quot;Q&quot;</span> )</div>
<div class="line">project.datamodel.add_face(patch_overlap)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># For each step that we wanna do, we define one solver step. In the first step that</span></div>
<div class="line"><span class="comment"># we use, we add one grid level to the mesh per step. We also initialise the blocks</span></div>
<div class="line"><span class="comment"># with the initial values.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line">create_grid = <a class="code hl_class" href="../../d1/de4/classpeano4_1_1solversteps_1_1Step_1_1Step.html">peano4.solversteps.Step</a>( <span class="stringliteral">&quot;CreateGrid&quot;</span> )</div>
<div class="line">create_grid.use_face(patch_overlap)</div>
<div class="line">create_grid.use_cell(patch)</div>
<div class="line"><span class="comment">#create_grid.add_action_set( peano4.toolbox.PlotGridInPeanoBlockFormat(&quot;grid-dump&quot;, patch) )</span></div>
<div class="line">create_grid.add_action_set( <a class="code hl_class" href="../../d5/d55/classpeano4_1_1toolbox_1_1blockstructured_1_1ProjectPatchOntoFaces_1_1ProjectPatchOntoFaces.html">peano4.toolbox.blockstructured.ProjectPatchOntoFaces</a>(patch,patch_overlap) )</div>
<div class="line">project.solversteps.add_step(create_grid)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># Next, we want to dump the final solution once. Luckily, quite a lot of </span></div>
<div class="line"><span class="comment"># support for blockstructured grid is available within Peano&#39;s toolbox. So</span></div>
<div class="line"><span class="comment"># we use features from there. In the example above, we added code to the </span></div>
<div class="line"><span class="comment"># step manually (the grid setup). This time, we don&#39;t want to add any </span></div>
<div class="line"><span class="comment"># further code manually.</span></div>
<div class="line"><span class="comment">#that I can </span></div>
<div class="line">print_solution = <a class="code hl_class" href="../../d1/de4/classpeano4_1_1solversteps_1_1Step_1_1Step.html">peano4.solversteps.Step</a>( <span class="stringliteral">&quot;PlotSolution&quot;</span> )</div>
<div class="line">print_solution.use_cell(patch)</div>
<div class="line">print_solution.use_face(patch_overlap)</div>
<div class="line">print_solution.remove_all_actions()</div>
<div class="line">plotter = <a class="code hl_class" href="../../df/d10/classpeano4_1_1toolbox_1_1blockstructured_1_1PlotPatchesInPeanoBlockFormat_1_1PlotPatchesInPeanoBlockFormat.html">peano4.toolbox.blockstructured.PlotPatchesInPeanoBlockFormat</a>(<span class="stringliteral">&quot;solution&quot;</span>,patch,<span class="stringliteral">&quot;Q&quot;</span>)</div>
<div class="line">print_solution.add_action_set( plotter )</div>
<div class="line">project.solversteps.add_step(print_solution)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># Haven&#39;t documented anything yet</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># @todo Dsa ist schon gefused, weil wir ja die Reihenfolge umgedreht haben. Eigentlich muss das action set andersrum laufen</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line">perform_time_step      = <a class="code hl_class" href="../../d1/de4/classpeano4_1_1solversteps_1_1Step_1_1Step.html">peano4.solversteps.Step</a>( <span class="stringliteral">&quot;TimeStep&quot;</span> )</div>
<div class="line">perform_time_step.use_cell(patch)</div>
<div class="line">perform_time_step.use_face(patch_overlap)</div>
<div class="line"><span class="comment"># @todo Darf ich den Face gleich wieder ueberschreiben? Nachbar bekommt ja dann GS-meassig den neuen mit u.U.</span></div>
<div class="line">functor = <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="stringliteral">  auto eigenvalues = [](double Q[5], const tarch::la::Vector&lt;Dimensions,double&gt;&amp; x, int normal, double lambda[5]) -&gt; void {</span></div>
<div class="line"><span class="stringliteral">    constexpr double gamma = 1.4;</span></div>
<div class="line"><span class="stringliteral">    const double irho = 1./Q[0];</span></div>
<div class="line"><span class="stringliteral">    #if Dimensions==3</span></div>
<div class="line"><span class="stringliteral">    const double p = (gamma-1) * (Q[4] - 0.5*irho*Q[1]*Q[1]+Q[2]*Q[2]+Q[3]*Q[3]);</span></div>
<div class="line"><span class="stringliteral">    #else</span></div>
<div class="line"><span class="stringliteral">    const double p = (gamma-1) * (Q[4] - 0.5*irho*Q[1]*Q[1]+Q[2]*Q[2]);</span></div>
<div class="line"><span class="stringliteral">    #endif</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    const double u_n = Q[normal + 1] * irho;</span></div>
<div class="line"><span class="stringliteral">    assertion10( gamma * p * irho&gt;=0.0, gamma, p, irho, x, normal, Q[0], Q[1], Q[2], Q[3], Q[4] );</span></div>
<div class="line"><span class="stringliteral">    const double c   = std::sqrt(gamma * p * irho);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    lambda[0]  = u_n;</span></div>
<div class="line"><span class="stringliteral">    lambda[1]  = u_n;</span></div>
<div class="line"><span class="stringliteral">    lambda[2]  = u_n;</span></div>
<div class="line"><span class="stringliteral">    lambda[3]  = u_n + c;</span></div>
<div class="line"><span class="stringliteral">    lambda[4]  = u_n - c;</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    assertion4( lambda[0]==lambda[0], u_n, c, x, normal );</span></div>
<div class="line"><span class="stringliteral">    assertion4( lambda[1]==lambda[1], u_n, c, x, normal );</span></div>
<div class="line"><span class="stringliteral">    assertion4( lambda[2]==lambda[2], u_n, c, x, normal );</span></div>
<div class="line"><span class="stringliteral">    assertion4( lambda[3]==lambda[3], u_n, c, x, normal );</span></div>
<div class="line"><span class="stringliteral">    assertion4( lambda[4]==lambda[4], u_n, c, x, normal );</span></div>
<div class="line"><span class="stringliteral">  };</span></div>
<div class="line"><span class="stringliteral">  </span></div>
<div class="line"><span class="stringliteral">  auto flux = [](double Q[5], const tarch::la::Vector&lt;Dimensions,double&gt;&amp; x, int normal, double F[5]) -&gt; void {</span></div>
<div class="line"><span class="stringliteral">    assertion5( Q[0]==Q[0], Q[0], Q[1], Q[2], Q[3], Q[4] );    </span></div>
<div class="line"><span class="stringliteral">    assertion5( Q[1]==Q[1], Q[0], Q[1], Q[2], Q[3], Q[4] );    </span></div>
<div class="line"><span class="stringliteral">    assertion5( Q[2]==Q[2], Q[0], Q[1], Q[2], Q[3], Q[4] );    </span></div>
<div class="line"><span class="stringliteral">    assertion5( Q[3]==Q[3], Q[0], Q[1], Q[2], Q[3], Q[4] );    </span></div>
<div class="line"><span class="stringliteral">    assertion5( Q[4]==Q[4], Q[0], Q[1], Q[2], Q[3], Q[4] );    </span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    assertion5( Q[0]&gt;1e-12, Q[0], Q[1], Q[2], Q[3], Q[4] );</span></div>
<div class="line"><span class="stringliteral">    constexpr double gamma = 1.4;</span></div>
<div class="line"><span class="stringliteral">    const double irho = 1./Q[0];</span></div>
<div class="line"><span class="stringliteral">    #if Dimensions==3</span></div>
<div class="line"><span class="stringliteral">    const double p = (gamma-1) * (Q[4] - 0.5*irho*Q[1]*Q[1]+Q[2]*Q[2]+Q[3]*Q[3]);</span></div>
<div class="line"><span class="stringliteral">    #else</span></div>
<div class="line"><span class="stringliteral">    const double p = (gamma-1) * (Q[4] - 0.5*irho*Q[1]*Q[1]+Q[2]*Q[2]);</span></div>
<div class="line"><span class="stringliteral">    #endif</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    switch (normal) {</span></div>
<div class="line"><span class="stringliteral">      case 0:</span></div>
<div class="line"><span class="stringliteral">        {</span></div>
<div class="line"><span class="stringliteral">          F[0] = Q[1];</span></div>
<div class="line"><span class="stringliteral">          F[1] = irho*Q[1]*Q[1] + p;</span></div>
<div class="line"><span class="stringliteral">          F[2] = irho*Q[2]*Q[1];</span></div>
<div class="line"><span class="stringliteral">          F[3] = (Dimensions==3) ? irho*Q[3]*Q[1] : 0.0;</span></div>
<div class="line"><span class="stringliteral">          F[4] = irho*(Q[4]+p)*Q[1];</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral">        break;</span></div>
<div class="line"><span class="stringliteral">      case 1:</span></div>
<div class="line"><span class="stringliteral">        {</span></div>
<div class="line"><span class="stringliteral">          F[0] = Q[2];</span></div>
<div class="line"><span class="stringliteral">          F[1] = irho*Q[1]*Q[2];</span></div>
<div class="line"><span class="stringliteral">          F[2] = irho*Q[2]*Q[2] + p;</span></div>
<div class="line"><span class="stringliteral">          F[3] = (Dimensions==3) ? irho*Q[3]*Q[2] : 0.0;</span></div>
<div class="line"><span class="stringliteral">          F[4] = irho*(Q[4]+p)*Q[2];</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral">        break;</span></div>
<div class="line"><span class="stringliteral">      case 2:</span></div>
<div class="line"><span class="stringliteral">        {</span></div>
<div class="line"><span class="stringliteral">          F[0] = Q[3];</span></div>
<div class="line"><span class="stringliteral">          F[1] = irho*Q[1]*Q[3];</span></div>
<div class="line"><span class="stringliteral">          F[2] = irho*Q[2]*Q[3];</span></div>
<div class="line"><span class="stringliteral">          F[3] = (Dimensions==3) ? irho*Q[3]*Q[3] + p : 0.0;</span></div>
<div class="line"><span class="stringliteral">          F[4] = irho*(Q[4]+p)*Q[3];</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral">        break;</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    assertion( F[0]==F[0] );</span></div>
<div class="line"><span class="stringliteral">    assertion( F[1]==F[1] );</span></div>
<div class="line"><span class="stringliteral">    assertion( F[2]==F[2] );</span></div>
<div class="line"><span class="stringliteral">    assertion( F[3]==F[3] );</span></div>
<div class="line"><span class="stringliteral">    assertion( F[4]==F[4] );</span></div>
<div class="line"><span class="stringliteral">  };</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">  auto splitRiemann1d = [&amp;flux, &amp;eigenvalues](double QL[5], double QR[5], const tarch::la::Vector&lt;Dimensions,double&gt;&amp; x, double dx, double dt, int normal, double F[5]) -&gt; void {{</span></div>
<div class="line"><span class="stringliteral">    double averageQ[5]; </span></div>
<div class="line"><span class="stringliteral">    for (int unknown=0; unknown&lt;5; unknown++) {{</span></div>
<div class="line"><span class="stringliteral">      averageQ[unknown] = 0.5 * (QL[unknown] + QR[unknown]);    </span></div>
<div class="line"><span class="stringliteral">      assertion4(averageQ[unknown]==averageQ[unknown], x, dx, dt, normal);</span></div>
<div class="line"><span class="stringliteral">    }}</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    double averageF[5];</span></div>
<div class="line"><span class="stringliteral">    double lambdas[5];</span></div>
<div class="line"><span class="stringliteral">    flux(averageQ,x,normal,averageF);</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    double lambdaMax = 0.0;</span></div>
<div class="line"><span class="stringliteral">    eigenvalues(averageQ,x,normal,lambdas);</span></div>
<div class="line"><span class="stringliteral">    for (int unknown=0; unknown&lt;5; unknown++) {{</span></div>
<div class="line"><span class="stringliteral">      assertion(lambdas[unknown]==lambdas[unknown]);</span></div>
<div class="line"><span class="stringliteral">      lambdaMax = std::max(lambdaMax,lambdas[unknown]);</span></div>
<div class="line"><span class="stringliteral">    }}</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    for (int unknown=0; unknown&lt;5; unknown++) {{</span></div>
<div class="line"><span class="stringliteral">      assertion( QR[unknown]==QR[unknown] );</span></div>
<div class="line"><span class="stringliteral">      assertion( QL[unknown]==QL[unknown] );</span></div>
<div class="line"><span class="stringliteral">      F[unknown] = averageF[unknown] - 0.5 * lambdaMax * (QR[unknown] - QL[unknown]);</span></div>
<div class="line"><span class="stringliteral">      assertion9( F[unknown]==F[unknown], averageF[unknown], lambdas[unknown], QR[unknown], QL[unknown], unknown, x, dx, dt, normal );</span></div>
<div class="line"><span class="stringliteral">    }}</span></div>
<div class="line"><span class="stringliteral">  }};  </span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">  constexpr int PatchSize = 13;</span></div>
<div class="line"><span class="stringliteral">  constexpr int HaloSize  = 1;    </span></div>
<div class="line"><span class="stringliteral">  double dt = 0.0001;</span></div>
<div class="line"><span class="stringliteral">  double dx = marker.h()(0) / PatchSize;</span></div>
<div class="line"><span class="stringliteral">  assertion( dx&gt;=tarch::la::NUMERICAL_ZERO_DIFFERENCE );</span></div>
<div class="line"><span class="stringliteral">  dfor(cell,PatchSize) {{ // DOFS_PER_AXIS</span></div>
<div class="line"><span class="stringliteral">    tarch::la::Vector&lt;Dimensions,double&gt; voxelCentre = marker.x()</span></div>
<div class="line"><span class="stringliteral">                                           - static_cast&lt;double&gt;((PatchSize/2+HaloSize)) * tarch::la::Vector&lt;Dimensions,double&gt;(dx)</span></div>
<div class="line"><span class="stringliteral">                                           + tarch::la::multiplyComponents(cell.convertScalar&lt;double&gt;(), tarch::la::Vector&lt;Dimensions,double&gt;(dx));</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    tarch::la::Vector&lt;Dimensions,int&gt; currentVoxel = cell + tarch::la::Vector&lt;Dimensions,int&gt;(HaloSize); // OVERLAP / Halo layer size</span></div>
<div class="line"><span class="stringliteral">    int currentVoxelSerialised = peano4::utils::dLinearised(currentVoxel,PatchSize + 2*HaloSize);</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    double accumulatedNumericalFlux[] = { 0.0, 0.0, 0.0, 0.0, 0.0 };</span></div>
<div class="line"><span class="stringliteral">    double numericalFlux[5];</span></div>
<div class="line"><span class="stringliteral">    for (int d=0; d&lt;Dimensions; d++) {</span></div>
<div class="line"><span class="stringliteral">      tarch::la::Vector&lt;Dimensions,int&gt; neighbourVoxel = currentVoxel;</span></div>
<div class="line"><span class="stringliteral">      tarch::la::Vector&lt;Dimensions,double&gt; x = voxelCentre;</span></div>
<div class="line"><span class="stringliteral">      </span></div>
<div class="line"><span class="stringliteral">      neighbourVoxel(d) -= 1;</span></div>
<div class="line"><span class="stringliteral">      int neighbourVoxelSerialised = peano4::utils::dLinearised(neighbourVoxel,PatchSize + 2*HaloSize);</span></div>
<div class="line"><span class="stringliteral">      x(d) -= 0.5 * dx;</span></div>
<div class="line"><span class="stringliteral">      assertion(neighbourVoxel(d)&gt;=0);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">      splitRiemann1d( </span></div>
<div class="line"><span class="stringliteral">        oldQWithHalo + neighbourVoxelSerialised*5,</span></div>
<div class="line"><span class="stringliteral">        oldQWithHalo + currentVoxelSerialised*5,</span></div>
<div class="line"><span class="stringliteral">        x, dx, dt, d,</span></div>
<div class="line"><span class="stringliteral">        numericalFlux</span></div>
<div class="line"><span class="stringliteral">      );</span></div>
<div class="line"><span class="stringliteral">      for (int unknown=0; unknown&lt;5; unknown++) {</span></div>
<div class="line"><span class="stringliteral">        //accumulatedNumericalFlux[unknown] -= numericalFlux[unknown];</span></div>
<div class="line"><span class="stringliteral">        accumulatedNumericalFlux[unknown] += numericalFlux[unknown];</span></div>
<div class="line"><span class="stringliteral">        assertion(  numericalFlux[unknown]==numericalFlux[unknown] );</span></div>
<div class="line"><span class="stringliteral">        assertion(  accumulatedNumericalFlux[unknown]==accumulatedNumericalFlux[unknown] );</span></div>
<div class="line"><span class="stringliteral">      }</span></div>
<div class="line"><span class="stringliteral">      </span></div>
<div class="line"><span class="stringliteral">      neighbourVoxel(d) += 2;</span></div>
<div class="line"><span class="stringliteral">      neighbourVoxelSerialised = peano4::utils::dLinearised(neighbourVoxel,PatchSize + 2*HaloSize);</span></div>
<div class="line"><span class="stringliteral">      x(d) += 1.0 * dx;</span></div>
<div class="line"><span class="stringliteral">      </span></div>
<div class="line"><span class="stringliteral">      splitRiemann1d( </span></div>
<div class="line"><span class="stringliteral">        oldQWithHalo + currentVoxelSerialised*5,</span></div>
<div class="line"><span class="stringliteral">        oldQWithHalo + neighbourVoxelSerialised*5,</span></div>
<div class="line"><span class="stringliteral">        x, dx, dt, d,</span></div>
<div class="line"><span class="stringliteral">        numericalFlux</span></div>
<div class="line"><span class="stringliteral">      );</span></div>
<div class="line"><span class="stringliteral">      for (int unknown=0; unknown&lt;5; unknown++) {</span></div>
<div class="line"><span class="stringliteral">        //accumulatedNumericalFlux[unknown] += numericalFlux[unknown];</span></div>
<div class="line"><span class="stringliteral">        accumulatedNumericalFlux[unknown] -= numericalFlux[unknown];</span></div>
<div class="line"><span class="stringliteral">        assertion(  numericalFlux[unknown]==numericalFlux[unknown] );</span></div>
<div class="line"><span class="stringliteral">        assertion(  accumulatedNumericalFlux[unknown]==accumulatedNumericalFlux[unknown] );</span></div>
<div class="line"><span class="stringliteral">      }</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    int destinationVoxelSerialised = peano4::utils::dLinearised(cell,PatchSize);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    for (int unknown=0; unknown&lt;5; unknown++) {{</span></div>
<div class="line"><span class="stringliteral">      assertion( originalPatch[ destinationVoxelSerialised*5+unknown ]==originalPatch[ destinationVoxelSerialised*5+unknown ] );</span></div>
<div class="line"><span class="stringliteral">      assertion( accumulatedNumericalFlux[unknown]==accumulatedNumericalFlux[unknown] );</span></div>
<div class="line"><span class="stringliteral">      originalPatch[ destinationVoxelSerialised*5+unknown ] += dt / dx * accumulatedNumericalFlux[unknown];</span></div>
<div class="line"><span class="stringliteral">    }}</span></div>
<div class="line"><span class="stringliteral">  }}</span></div>
<div class="line"><span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">perform_time_step.add_action_set( peano4.toolbox.blockstructured.ReconstructPatchAndApplyFunctor(patch,patch_overlap,functor,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;&quot;</span>) )</div>
<div class="line">perform_time_step.add_action_set( <a class="code hl_class" href="../../d5/d55/classpeano4_1_1toolbox_1_1blockstructured_1_1ProjectPatchOntoFaces_1_1ProjectPatchOntoFaces.html">peano4.toolbox.blockstructured.ProjectPatchOntoFaces</a>(patch,patch_overlap) )</div>
<div class="line"><span class="comment"># @todo raus</span></div>
<div class="line">perform_time_step.add_action_set( plotter )</div>
<div class="line">project.solversteps.add_step(perform_time_step)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># Peano&#39;s API does not know which settings to use on the present system. To </span></div>
<div class="line"><span class="comment"># make it copy/clone the settings identified by ./configure, we ask it to </span></div>
<div class="line"><span class="comment"># parse the generated configuration scripts. The makefile would also offer a</span></div>
<div class="line"><span class="comment"># routine to set the dimension. We take the default here.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># @todo Adopt to your particular system settings</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line">project.output.makefile.parse_configure_script_outcome( <span class="stringliteral">&quot;../../..&quot;</span> )</div>
<div class="line">project.constants.export( <span class="stringliteral">&quot;PatchSize&quot;</span>, patch_size )</div>
<div class="line">project.constants.export( <span class="stringliteral">&quot;NumberOfUnknownsPerCell&quot;</span>, unknowns )</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># Standard triad of operations. You can skip the first two steps if you want as </span></div>
<div class="line"><span class="comment"># the script then will automatically invoke the previous steps. The other way </span></div>
<div class="line"><span class="comment"># round, it is always admissible to only generate stuff, e.g., but to build and</span></div>
<div class="line"><span class="comment"># run the project through a command line</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line">project.generate(peano4.output.Overwrite.Default)</div>
<div class="line">project.build()</div>
<div class="line">success = project.run( [<span class="stringliteral">&quot;myarguments&quot;</span>] )</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># Dump grid into VTK</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#convert = peano4.visualisation.Convert( &quot;grid-dump&quot; )</span></div>
<div class="line"><span class="comment">#convert.set_visualisation_tools_path( &quot;/home/tobias/git/Peano/src/visualisation&quot; )</span></div>
<div class="line"><span class="comment">#convert.extract_fine_grid()</span></div>
<div class="line"><span class="comment">#convert.convert_to_vtk()</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> success:</div>
<div class="line">  convert = peano4.visualisation.Convert( <span class="stringliteral">&quot;solution&quot;</span> )</div>
<div class="line">  convert.set_visualisation_tools_path( <span class="stringliteral">&quot;/home/tobias/git/Peano/src/visualisation&quot;</span> )</div>
<div class="line">  convert.extract_fine_grid()</div>
<div class="line">  convert.convert_to_vtk()</div>
<div class="ttc" id="aclasspeano4_1_1Project_1_1Project_html"><div class="ttname"><a href="../../dd/de1/classpeano4_1_1Project_1_1Project.html">peano4.Project.Project</a></div><div class="ttdoc">Represents a Peano 4 project.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d62/python_2peano4_2Project_8py_source.html#l00016">Project.py:16</a></div></div>
<div class="ttc" id="aclasspeano4_1_1datamodel_1_1Patch_1_1Patch_html"><div class="ttname"><a href="../../d9/da7/classpeano4_1_1datamodel_1_1Patch_1_1Patch.html">peano4.datamodel.Patch.Patch</a></div><div class="ttdef"><b>Definition</b> <a href="../../db/d7f/datamodel_2Patch_8py_source.html#l00007">Patch.py:7</a></div></div>
<div class="ttc" id="aclasspeano4_1_1solversteps_1_1Step_1_1Step_html"><div class="ttname"><a href="../../d1/de4/classpeano4_1_1solversteps_1_1Step_1_1Step.html">peano4.solversteps.Step.Step</a></div><div class="ttdoc">One step.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d32/Step_8py_source.html#l00015">Step.py:15</a></div></div>
<div class="ttc" id="aclasspeano4_1_1toolbox_1_1blockstructured_1_1PlotPatchesInPeanoBlockFormat_1_1PlotPatchesInPeanoBlockFormat_html"><div class="ttname"><a href="../../df/d10/classpeano4_1_1toolbox_1_1blockstructured_1_1PlotPatchesInPeanoBlockFormat_1_1PlotPatchesInPeanoBlockFormat.html">peano4.toolbox.blockstructured.PlotPatchesInPeanoBlockFormat.PlotPatchesInPeanoBlockFormat</a></div><div class="ttdoc">Simple patch plotter.</div><div class="ttdef"><b>Definition</b> <a href="../../da/d90/PlotPatchesInPeanoBlockFormat_8py_source.html#l00008">PlotPatchesInPeanoBlockFormat.py:8</a></div></div>
<div class="ttc" id="aclasspeano4_1_1toolbox_1_1blockstructured_1_1ProjectPatchOntoFaces_1_1ProjectPatchOntoFaces_html"><div class="ttname"><a href="../../d5/d55/classpeano4_1_1toolbox_1_1blockstructured_1_1ProjectPatchOntoFaces_1_1ProjectPatchOntoFaces.html">peano4.toolbox.blockstructured.ProjectPatchOntoFaces.ProjectPatchOntoFaces</a></div><div class="ttdoc">This class assumes that you have NxNxN patch within your block.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d08/peano4_2toolbox_2blockstructured_2ProjectPatchOntoFaces_8py_source.html#l00007">ProjectPatchOntoFaces.py:7</a></div></div>
<div class="ttc" id="anamespacepeano4_1_1toolbox_1_1blockstructured_html"><div class="ttname"><a href="../../d7/dfc/namespacepeano4_1_1toolbox_1_1blockstructured.html">peano4.toolbox.blockstructured</a></div><div class="ttdef"><b>Definition</b> <a href="../../d3/d3e/python_2peano4_2toolbox_2blockstructured_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../dd/da2/page_peano4_home.html">Peano 4</a></li><li class="navelem"><a class="el" href="../../d3/d1a/tutorials_peano4_tutorials.html">Tutorials</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:00 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
