<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d1/d9e/tarch_logging.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Logging, tracing, statistics, profiling and assertions</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md1155">Logging, tracing and assertion architecture</a></li>
<li class="level2"><a href="#autotoc_md1156">Using the logging and tracing interface</a></li>
<li class="level2"><a href="#autotoc_md1157">Logging devices, formats, backends and profiling support</a><ul><li class="level3"><a href="#autotoc_md1158">CommandLineLogger</a></li>
<li class="level3"><a href="#autotoc_md1159">ChromeTraceFileLogger</a></li>
<li class="level3"><a href="#autotoc_md1160">NVTX logger (NVIDIA SDK)</a></li>
<li class="level3"><a href="#autotoc_md1161">ITAC logger</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md1162">Log filter</a></li>
<li class="level2"><a href="#autotoc_md1163">Assertions</a></li>
<li class="level2"><a href="#autotoc_md1164">Statistics</a></li>
</ul>
</ul>
</div>
<div class="textblock"><h2><a class="anchor" id="autotoc_md1155"></a>
Logging, tracing and assertion architecture</h2>
<p>Peano is built upon a technical architecture (<code>tarch</code>) which provides logging, tracing and assertions. This is also the layer which decides which information is pre-prepared for the supported profiling tools. The two directory of relevance here is therefore <code>tarch/logging</code> plus the file <code><a class="el" href="../../dc/d46/Assertions_8h.html">Assertions.h</a></code>. The latter file holds all the assertion macros, while the logging directory holds a file <code><a class="el" href="../../d1/d45/Log_8h.html">Log.h</a></code> which holds all of the essential logging and tracing macros.</p>
<p>When we build Peano, we do distinguish different "debug" levels:</p>
<ul>
<li>If a code is translated with <code>-DPeanoDebug=0</code>, all logging, tracing and assertion macros are disabled, i.e. replaced by empty statements. Warning, information and error messages are still displayed.</li>
<li>If a code is translated with <code>-DPeanoDebug=1</code>, all macros from <code>-DPeanoDebug=0</code> remain defined. This time however, all tracing functionality is enabled. With this mode, it is possible to do production runs plus to extract some performance data, e.g.</li>
<li>If a code is translated with <code>-DPeanoDebug=2</code>, all the tracing macros from <code>-DPeanoDebug=1</code> remain defined. On top of this, Peano's assertions now are enabled, i.e. assertion macros do not degenerate to nop but actually run tests. This might increase the runtime significantly yet the code permanently runs test.</li>
<li>If a code is translated with <code>-DPeanoDebug=4</code>, logging and assertion macros from <code>-DPeanoDebug=4</code> remain defined. Furthermore, any debug information written through Peano's log interface is now not discarded (removed at compile time) but actually shown. This is the slowest mode yielding most of the data.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1156"></a>
Using the logging and tracing interface</h2>
<p>Peano relies on a plain interface to write out user information. All constituents of this interface are collected in the package <code><a class="el" href="../../d5/d43/namespacetarch_1_1logging.html">tarch::logging</a></code>. Documentation on this package can be found in the corresponding header files, files ending with <code>.doxys</code>, or the Peano webpage (section on sources). The usage paradigm is simple:</p>
<ol type="1">
<li><p class="startli">Each class that wants to write logging information requires an instance of class <code><a class="el" href="../../da/d79/classtarch_1_1logging_1_1Log.html" title="Log Device.">tarch::logging::Log</a></code>. As such an instance is required per class, it makes sense to make this field a static one.</p>
<p class="startli">Please keep to the nomenclature of the class field to make all macros work. Please use as string argument in the constructor the fully qualified class name. See the remarks on log filters below for an explanation for this.</p>
</li>
<li><p class="startli">Whenever you want to log, trace, write an error message or a warning, you should use Log's operations to write the messages. Alternatively, you may want to use the log macros from <code><a class="el" href="../../d1/d45/Log_8h.html">Log.h</a></code>. They work with stringstreams internally, i.e. you may write things along the lines</p>
<p class="startli">logInfo( "runAsMaster(...)", "time step " &lt;&lt; i &lt;&lt; ": dt=" &lt;&lt; dt );</p>
<p class="startli">where you concatenate the stream with data.</p>
</li>
</ol>
<p>Peano offers four levels of logging through its macros:</p>
<ul>
<li><b>Info</b>. Should be used to inform your user about the application's state.</li>
<li><b>Warning</b>. Should be used to inform your user about bothering behaviour. The MPI code uses it, e.g., if many messages arrive in a different order than expected. Messages written to the warning level are piped to <code>cerr</code>.</li>
<li><b>Error</b>. Should be used for errors. Is piped to <code>cerr</code> as well.</li>
<li><b>Tracing</b>. Used to keep track of when a method is entered and then left again.</li>
<li><b>Debug</b>. Should be used to write debug data. It goes to <code>cout</code> and all debug data is removed if you do not translate with the compile flag <code>-DDebug</code>. Notably, use the <code>logDebug</code> macros when you write to the debug level, as all required log operations then are removed by the compiler once you create a release version of your code.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1157"></a>
Logging devices, formats, backends and profiling support</h2>
<p>The <code>Log</code> instance forwards the information to a logger. By default, this is the <a class="el" href="../../db/d5e/classtarch_1_1logging_1_1ChromeTraceFileLogger.html" title="Chrome Trace File Logger.">tarch::logging::ChromeTraceFileLogger</a>. You may want to write your own alternative implementation or switch to another option. Logging can be very time-consuming. I therefore decided to link the Log objects to one particular log device statically. If you want to "redirect" your outcome, you can either manually edit the logging header, or you can retranslate your code with <code>-DUseLogService=xxx</code>. <code>xxx</code> is the class to be used. I detail the variants I currently ship with Peano below.</p>
<p>Supports the instrumentation of source code for particular performance analysis tools via its loggers. Notably all output to the <code>trace</code> target are forwarded to instrumentation APIs. To make this work, you either have to pick a particular logging device, or you switch to a tool-/vendor-specific toolchain.</p>
<h3><a class="anchor" id="autotoc_md1158"></a>
CommandLineLogger</h3>
<p>To select this logger, compile with <code>-DUseLogService=CommandLineLogger</code>. This logger is the default.</p>
<p>This logger dumps all information in a human readable format. It can be tailored towards your needs. For this, the logger provides a particular setter. Please consult the header or the webpage for details on the semantics of the arguments:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="../../df/d72/classtarch_1_1logging_1_1CommandLineLogger.html#a4e70d4fc98849a93fcab39c348ea10c0">tarch::logging::CommandLineLogger::setLogFormat</a>(</div>
<div class="line"> <span class="stringliteral">&quot; &quot;</span>,</div>
<div class="line"> <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span>,</div>
<div class="line"> <span class="stringliteral">&quot;my-fancy.log-file&quot;</span></div>
<div class="line">);</div>
<div class="ttc" id="aclasstarch_1_1logging_1_1CommandLineLogger_html_a4e70d4fc98849a93fcab39c348ea10c0"><div class="ttname"><a href="../../df/d72/classtarch_1_1logging_1_1CommandLineLogger.html#a4e70d4fc98849a93fcab39c348ea10c0">tarch::logging::CommandLineLogger::setLogFormat</a></div><div class="ttdeci">void setLogFormat(const std::string &amp;columnSeparator, bool logTimeStamp, bool logTimeStampHumanReadable, bool logMachineName, bool logThreadName, bool logMessageType, bool logTrace, const std::string &amp;outputLogFileName)</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d12/CommandLineLogger_8cpp_source.html#l00370">CommandLineLogger.cpp:370</a></div></div>
</div><!-- fragment --><p>The interface also allows you to pipe the output into a file rather than to the terminal. This is particular useful for MPI applications, as each rank is assigned a file of its own and messages are not screwed up. Typically, the logger is configured in the <code>main</code> of the application.</p>
<p>If you run Peano for long simulations and, notably, if you run Peano with debug information switched on, log files soon become massive. To ease the pain, Peano's command line logger offers an operation <a class="el" href="../../df/d72/classtarch_1_1logging_1_1CommandLineLogger.html#a3427fc1ae574b402897c20bb0d807fb2" title="The command line logger can pipe debug data into an output file instead of piping everything to the t...">tarch::logging::CommandLineLogger::closeOutputStreamAndReopenNewOne()</a> that works if you have specified an output file before (see <code>setLogFormat</code> above). Per close, you close all output files and start to stream the output into a new file. Typically, developers use this operation in their iterative schemes to stream each iteration to a different file. The output files are enumerated automatically.</p>
<h3><a class="anchor" id="autotoc_md1159"></a>
ChromeTraceFileLogger</h3>
<p>To select this logger, compile with <code>-DUseLogService=ChromeTraceFileLogger</code>.</p>
<p>This logger writes the one json file per rank. The format conforms to Google Chrome's tracing format, i.e. you can open the file in Google Chrome by typing in the URL <code>chrome:///tracing</code> and loading in the file in the GUI that pops up. As the format is prescribed, there are no opportunities to configure the output. While the majority of all output data goes into these Chrome files, warnings, errors and info messages are also dumped to the terminal in a format which can be read by humans easily.</p>
<h3><a class="anchor" id="autotoc_md1160"></a>
NVTX logger (NVIDIA SDK)</h3>
<p>To select this logger, compile with <code>-DUseLogService=NVTXLogger</code>. This logger forwards all trace commands to NVIDIA's profiling/tracing library. It is automatically enabled once you configure with </p><div class="fragment"><div class="line">./configure --with-toolchain=nvidia</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1161"></a>
ITAC logger</h3>
<p>To select this logger, configure with </p><div class="fragment"><div class="line">./configure --with-toolchain=intel</div>
</div><!-- fragment --><p>This switch sets, automatically, the compile flag <code>-DUseLogService=ITACLogger</code>. You can however also set the logger via the CXXFLAGS.</p>
<p>The ITAC logger forwards all trace commands to Intel's profiling/tracing library. You can now compile 's tracing backend, and will continue to plot all <code>info</code> statements to the terminal. The trace statements however are piped directly into ITAC, i.e. if you analyse the code with Intel's <code>traceanalyzer</code> or VTune, you should see the -specific annotations and traces. You can also use 's log filter to filter which events are actually handed over to ITAC.</p>
<p>I've recognised that the Intel scripts often do not include the ITAC headers that requires in their search path. In this case, you will have to augment your configure call:</p>
<p>The class <a class="el" href="../../d4/d6d/classtarch_1_1logging_1_1ITACLogger.html" title="Command Line Logger.">tarch::logging::ITACLogger</a> provides further detail on the usage of the logging back-end. The punch line is that you have to translate in trace mode to get proper ITAC data. As the trace information of quickly becomes vast, I recommend to create a log filter, and start a run where you disable all but the top-level tracing information.</p>
<h2><a class="anchor" id="autotoc_md1162"></a>
Log filter</h2>
<p>The amount of log information often becomes hard to track; notably if you run in debug mode. Often, you are interested only in a subset of all log messages. For this, Peano offers log filters which provide a blacklist and whitelist mechanism to filter messages before they are written. A log filter entry is created by</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="../../d7/d3a/classtarch_1_1logging_1_1LogFilter.html#ae70e7bea503522c87e6cb0c3a2332949">tarch::logging::LogFilter::getInstance</a>().<a class="code hl_function" href="../../d7/d3a/classtarch_1_1logging_1_1LogFilter.html#a00f4cd70fe095444bb001605b2d88c10">addFilterListEntry</a>(</div>
<div class="line">  <a class="code hl_struct" href="../../df/d4f/structtarch_1_1logging_1_1LogFilter_1_1FilterListEntry.html">tarch::logging::LogFilter::FilterListEntry</a>(</div>
<div class="line">    <a class="code hl_variable" href="../../df/d4f/structtarch_1_1logging_1_1LogFilter_1_1FilterListEntry.html#a43132506d4684826baf85fcc1befd27e">tarch::logging::LogFilter::FilterListEntry::TargetInfo</a>,</div>
<div class="line">    <a class="code hl_variable" href="../../df/d4f/structtarch_1_1logging_1_1LogFilter_1_1FilterListEntry.html#acb69ef6e76de26dd886a6343eda2c2cb">tarch::logging::LogFilter::FilterListEntry::AnyRank</a>, \<span class="stringliteral">&quot;peano4\&quot;, false,</span></div>
<div class="line"><span class="stringliteral">    tarch::logging::LogFilter::FilterListEntry::AlwaysOn</span></div>
<div class="line"><span class="stringliteral">  )</span></div>
<div class="line"><span class="stringliteral">);</span></div>
<div class="ttc" id="aclasstarch_1_1logging_1_1LogFilter_html_a00f4cd70fe095444bb001605b2d88c10"><div class="ttname"><a href="../../d7/d3a/classtarch_1_1logging_1_1LogFilter.html#a00f4cd70fe095444bb001605b2d88c10">tarch::logging::LogFilter::addFilterListEntry</a></div><div class="ttdeci">void addFilterListEntry(const FilterListEntry &amp;entry)</div><div class="ttdoc">Add one filter list entry.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d31/LogFilter_8cpp_source.html#l00196">LogFilter.cpp:196</a></div></div>
<div class="ttc" id="aclasstarch_1_1logging_1_1LogFilter_html_ae70e7bea503522c87e6cb0c3a2332949"><div class="ttname"><a href="../../d7/d3a/classtarch_1_1logging_1_1LogFilter.html#ae70e7bea503522c87e6cb0c3a2332949">tarch::logging::LogFilter::getInstance</a></div><div class="ttdeci">static LogFilter &amp; getInstance()</div><div class="ttdef"><b>Definition</b> <a href="../../df/d31/LogFilter_8cpp_source.html#l00109">LogFilter.cpp:109</a></div></div>
<div class="ttc" id="astructtarch_1_1logging_1_1LogFilter_1_1FilterListEntry_html"><div class="ttname"><a href="../../df/d4f/structtarch_1_1logging_1_1LogFilter_1_1FilterListEntry.html">tarch::logging::LogFilter::FilterListEntry</a></div><div class="ttdoc">Represents one entry of the filter list.</div><div class="ttdef"><b>Definition</b> <a href="../../da/d31/LogFilter_8h_source.html#l00030">LogFilter.h:30</a></div></div>
<div class="ttc" id="astructtarch_1_1logging_1_1LogFilter_1_1FilterListEntry_html_a43132506d4684826baf85fcc1befd27e"><div class="ttname"><a href="../../df/d4f/structtarch_1_1logging_1_1LogFilter_1_1FilterListEntry.html#a43132506d4684826baf85fcc1befd27e">tarch::logging::LogFilter::FilterListEntry::TargetInfo</a></div><div class="ttdeci">static const std::string TargetInfo</div><div class="ttdef"><b>Definition</b> <a href="../../da/d31/LogFilter_8h_source.html#l00034">LogFilter.h:34</a></div></div>
<div class="ttc" id="astructtarch_1_1logging_1_1LogFilter_1_1FilterListEntry_html_acb69ef6e76de26dd886a6343eda2c2cb"><div class="ttname"><a href="../../df/d4f/structtarch_1_1logging_1_1LogFilter_1_1FilterListEntry.html#acb69ef6e76de26dd886a6343eda2c2cb">tarch::logging::LogFilter::FilterListEntry::AnyRank</a></div><div class="ttdeci">static const int AnyRank</div><div class="ttdef"><b>Definition</b> <a href="../../da/d31/LogFilter_8h_source.html#l00031">LogFilter.h:31</a></div></div>
</div><!-- fragment --><p>The log filter is a singleton, and log filters can be used totally independently of the log output format.</p>
<p>Configuring log filters in your source code is a convenient option when you start a new project. On the long run, it is cumbersome if you have to recompile every time you want different log information. Therefore, the <code>CommandLineLogger</code> also offers a routine that allows you to load log filter entries from a text file. This facilitates work with log filters. The usage is straightforward</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="../../de/df8/classtarch_1_1logging_1_1LogFilterFileReader.html#a4b9fa078c15d4af5eff06af53e5ee6a8">tarch::logging::LogFilterFileReader::parsePlainTextFile</a>(<span class="stringliteral">&quot;my.log-filter&quot;</span>);</div>
<div class="ttc" id="aclasstarch_1_1logging_1_1LogFilterFileReader_html_a4b9fa078c15d4af5eff06af53e5ee6a8"><div class="ttname"><a href="../../de/df8/classtarch_1_1logging_1_1LogFilterFileReader.html#a4b9fa078c15d4af5eff06af53e5ee6a8">tarch::logging::LogFilterFileReader::parsePlainTextFile</a></div><div class="ttdeci">static bool parsePlainTextFile(const std::string &amp;filename)</div><div class="ttdoc">Tries to parse a simple text file where each line contains an entry.</div><div class="ttdef"><b>Definition</b> <a href="../../d7/de3/LogFilterFileReader_8cpp_source.html#l00103">LogFilterFileReader.cpp:103</a></div></div>
</div><!-- fragment --><p>and the format is very simple: </p><pre class="fragment"># Level                 Trace                    Rank          Black/white  When on
# info/debug/trace/all  trace of class affected  -1=all ranks
  debug                 tarch                    -1            black        always-on
  debug                 peano4                   -1            black        always-on
  info                  tarch                    -1            black        always-on
  info                  peano4                   -1            black        always-on
  trace                 tarch                    -1            black        always-on
  trace                 peano4                   -1            black        always-on
  all                   tarch                    -1            black        always-on
  all                   peano4                   -1            black        always-on

# Lines starting with hash are comments

# Switch on info output from one class on one rank only
info     examples::subdirectory::myClass    15    white  my-phase
</pre><p> For performance reasons, it is important to take two facts into account:</p>
<ol type="1">
<li>Black- and whitelisting works only on the class level. While tracing, logging, and so forth all tell you which operation has logged a certain entry, you cannot filter on the method level.</li>
<li>Black- and whitelisting are not dynamic. The very first time a class wants to dump information, it queries the log filter. The result of the log filter then is hold persistently.</li>
</ol>
<p>Whether a log message is written or not results from the combination of compile flags (<code>PeanoDebug</code> flag) plus the log filters you have in place. If you translate with <code>-DPeanoDebug=0</code>, debug log filters play no role, as the underlying messages are not written anyway. In this context, you have to pay attention against which libraries you link. Peano builds the technical architecture, the core and tools in different versions with different optimisation levels and different log settings. Select the right one if you wanna see messages from the core or tarch.</p>
<p>You can have different log entries for different program phases. By default, the log filter does not keep track of the program phase, i.e. it does not know which program phase is on. You can use <a class="el" href="../../d7/d3a/classtarch_1_1logging_1_1LogFilter.html#a572ffc6edabe32f97768f80cc1005129">tarch::logging::LogFilter::switchProgramPhase()</a>:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="../../d7/d3a/classtarch_1_1logging_1_1LogFilter.html#ae70e7bea503522c87e6cb0c3a2332949">tarch::logging::LogFilter::getInstance</a>().<a class="code hl_function" href="../../d7/d3a/classtarch_1_1logging_1_1LogFilter.html#a572ffc6edabe32f97768f80cc1005129">switchProgramPhase</a>(<span class="stringliteral">&quot;my-phase&quot;</span>);</div>
<div class="ttc" id="aclasstarch_1_1logging_1_1LogFilter_html_a572ffc6edabe32f97768f80cc1005129"><div class="ttname"><a href="../../d7/d3a/classtarch_1_1logging_1_1LogFilter.html#a572ffc6edabe32f97768f80cc1005129">tarch::logging::LogFilter::switchProgramPhase</a></div><div class="ttdeci">void switchProgramPhase(const std::string &amp;activeProgramPhase)</div><div class="ttdef"><b>Definition</b> <a href="../../df/d31/LogFilter_8cpp_source.html#l00114">LogFilter.cpp:114</a></div></div>
</div><!-- fragment --><p>From hereon, only the log filter entries labelled with <code>my-phase</code> or with <code>always-on</code> will be used. You can use any string for <code>my-phase</code>. Some higher-level frameworks such as  define some program phases a priori.</p>
<h2><a class="anchor" id="autotoc_md1163"></a>
Assertions</h2>
<p>Peano provides its own assertion format which is independent of C++ assertions. Assertions are offered through macros, and if you choose a <code>PeanoDebug</code> level which does not support assertions, then they are removed at compile time from your code.</p>
<p>Peano's assertions interlink with the logging, i.e. before they shut down a rank, they ensure that all logs are flushed. Furthermore, they provide a few convenient variations that</p>
<ol type="1">
<li>support numerical "equality" checks,</li>
<li>support the logging of parameters, and</li>
<li>support vector-valued comparisons.</li>
</ol>
<p>It is best to study the macros in <a class="el" href="../../dc/d46/Assertions_8h.html">tarch/Assertions.h</a> to get an overview.</p>
<h2><a class="anchor" id="autotoc_md1164"></a>
Statistics</h2>
<p>Peano has a statistics backend, which you can activate by switching into the statistics mode. This implies that you link against the statistics builds of the libraries. The statistics tool is relatively simply to use: You identify an identifier for your metric (a simple string) and then you log values for this identifier. The values have to be scalar doubles, and you don't have to register your identifier or similar things.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="../../d7/d06/classtarch_1_1logging_1_1Statistics.html#afa797bdb0be71bbe06dbe1359c0d2969">::tarch::logging::Statistics::getInstance</a>().<a class="code hl_function" href="../../d7/d06/classtarch_1_1logging_1_1Statistics.html#a223f14499162cc3cdf4985161c7279ed">log</a>(<span class="stringliteral">&quot;mystats&quot;</span>, 24);</div>
<div class="ttc" id="aclasstarch_1_1logging_1_1Statistics_html_a223f14499162cc3cdf4985161c7279ed"><div class="ttname"><a href="../../d7/d06/classtarch_1_1logging_1_1Statistics.html#a223f14499162cc3cdf4985161c7279ed">tarch::logging::Statistics::log</a></div><div class="ttdeci">void log(const std::string &amp;identifier, double value, bool disableSampling=false)</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d95/tarch_2logging_2Statistics_8h_source.html#l00105">Statistics.h:105</a></div></div>
<div class="ttc" id="aclasstarch_1_1logging_1_1Statistics_html_afa797bdb0be71bbe06dbe1359c0d2969"><div class="ttname"><a href="../../d7/d06/classtarch_1_1logging_1_1Statistics.html#afa797bdb0be71bbe06dbe1359c0d2969">tarch::logging::Statistics::getInstance</a></div><div class="ttdeci">static Statistics &amp; getInstance()</div><div class="ttdoc">This is not the canonical realisation of singletons as I use it usually for stats in Peano.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/da8/tarch_2logging_2Statistics_8cpp_source.html#l00016">Statistics.cpp:16</a></div></div>
</div><!-- fragment --><p>The statistics backend samples over these calls and eventually writes a csv file with the logged entries over time. To trigger this write, you have to call <a class="el" href="../../d7/d06/classtarch_1_1logging_1_1Statistics.html#a75a2d3245350032d8f5e8616b3493d8e" title="Write data to csv file.">tarch::logging::Statistics::writeToCSV()</a>. I usually invoke the write at the end of the main routine.</p>
<p>If you activate the statistics, automatically writes some runtime statistics into the stats file. These statistics give you, for example, and overview how many tasks are in flight at any time, or how long 's MPI routines had to wait for incoming data. The output format is plain csv and thus straightforward to parse.</p>
<p>However, the directory <code>python/peano4/postprocessing</code> also holds some scripts to postprocess and visualise the outcome. The starting point is the inspect command, which really only tells you which column holds which data.</p>
<div class="fragment"><div class="line">python3 ~/git/Peano/python/<a class="code hl_namespace" href="../../d8/d8f/namespacepeano4.html">peano4</a>/postprocessing/inspect-statistics.py statistics-rank-0.csv </div>
<div class="line">Column  | Counter</div>
<div class="line">--------|----------------</div>
<div class="line">0   |  time (always used to <a class="code hl_namespace" href="../../de/d73/namespaceplot.html">plot</a>)</div>
<div class="line">2   |  mpi <a class="code hl_function" href="../../d9/d6d/exahype2_2solvers_2fv_2godunov_2kernels_2sycl_2Loop_8template_8h.html#a559a611b323ad3a61cfaf0ad580b6a29">wait</a> times</div>
<div class="line">3   |  tarch::multicore::bsp-concurrency-level</div>
<div class="line">4   |  tarch::multicore::spawned-tasks</div>
<div class="line">5   |  tarch::multicore::taskfusion::process-fused-tasks</div>
<div class="line">6   |  tarch::multicore::taskfusion::submit-fused-tasks</div>
<div class="line">7   |  grid-control-events</div>
<div class="ttc" id="aexahype2_2solvers_2fv_2godunov_2kernels_2sycl_2Loop_8template_8h_html_a559a611b323ad3a61cfaf0ad580b6a29"><div class="ttname"><a href="../../d9/d6d/exahype2_2solvers_2fv_2godunov_2kernels_2sycl_2Loop_8template_8h.html#a559a611b323ad3a61cfaf0ad580b6a29">wait</a></div><div class="ttdeci">event wait()</div></div>
<div class="ttc" id="anamespacepeano4_html"><div class="ttname"><a href="../../d8/d8f/namespacepeano4.html">peano4</a></div><div class="ttdef"><b>Definition</b> <a href="../../df/d17/CellMarker_8h_source.html#l00014">CellMarker.h:14</a></div></div>
<div class="ttc" id="anamespaceplot_html"><div class="ttname"><a href="../../de/d73/namespaceplot.html">plot</a></div><div class="ttdoc">-lift-drop-statistics</div></div>
</div><!-- fragment --><p>You could see this with a simple less or cat, or you could load the csv file into Excel and see exactly the same. But sometimes I find the Python script easier. From hereon, you can visualise the outcome:</p>
<div class="fragment"><div class="line">python3 ~/git/Peano/python/<a class="code hl_namespace" href="../../d8/d8f/namespacepeano4.html">peano4</a>/postprocessing/<a class="code hl_namespace" href="../../de/d73/namespaceplot.html">plot</a>-statistics.py -c 4,5,6 -o pdf statistics-rank-0.csv</div>
</div><!-- fragment --><div class="image">
<img src="../../logging-statistcs.png" alt=""/>
</div>
<p>I provide different visualisation types. The statistics file contains exclusively deltas and it samples. Hence, it might somtimes look as if almost no data were in the database. Yet, this could also be due to the fact that the code logs the same value all the time. Use &ndash;help to find out more about visualisation types. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../dd/d46/page_tarch_home.html">Technical Architecture (tarch)</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:06 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
