<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d9/de5/swift_boundary_conditions.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Boundary conditions and solver coupling</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Boundary conditions are notoriously challenging within SPH. So is solver coupling. In Swift, we recommend to realise volumetric boundary conditions, which means that we do not alter individual particles, but can modify whole particle sets close to the boundary. Periodic boundary conditions are an exception: They are natively supported through Peano.</p>
<h1><a class="anchor" id="autotoc_md1084"></a>
Periodic boundary conditions</h1>
<p>Periodic boundary conditions are enabled globally for a Swift project. Other conditions can be imposed particle species by species, but periodic BCs are global:</p>
<div class="fragment"><div class="line">project.set_global_simulation_parameters(</div>
<div class="line">  dimensions=dimensions,</div>
<div class="line">  offset=offset,</div>
<div class="line">  domain_size=domain_size,</div>
<div class="line">  min_end_time=args.end_time,</div>
<div class="line">  max_end_time=0.0,</div>
<div class="line">  first_plot_time_stamp=0.0,</div>
<div class="line">  time_in_between_plots=args.plot_delta,</div>
<div class="line">  periodic_BC=[True,True,False],                 # &lt;--- <span class="keyword">this</span> is the relevant line</div>
<div class="line">  plotter_precision=8,</div>
<div class="line">)</div>
</div><!-- fragment --><p>It is possible to switch them on/off per coordinate axis. Once enabled, the underlying Peano framework realises them through a plain domain decomposition. That is, any particle close to the right border appears in turn as halo particle on the left and vice versa.</p>
<h1><a class="anchor" id="autotoc_md1085"></a>
Other boundary conditions</h1>
<p>We distinguish two different variants how to implement boundary conditions. One is inspired by our capability to couple SPH to other solvers and the other one plugs into the drift mechanism. Both have pros and cons.</p>
<h2><a class="anchor" id="autotoc_md1086"></a>
Plug into each and every grid sweep</h2>
<p>The Swift project allows us to add our own <a class="el" href="../../da/d1b/peano_action_sets.html">set of actions</a> to each and every mesh sweep. That is, Swift's graph compiler will lower the abstract SPH steps into a series of mesh sweeps per time step, and we can then afterwards add further actions to these mesh sweeps. This is done by appending action sets to the project:</p>
<div class="fragment"><div class="line">project.additional_action_sets_per_solver_step.append(</div>
<div class="line">    <a class="code hl_namespace" href="../../de/dac/namespaceswift2.html">swift2</a>.<a class="code hl_namespace" href="../../dd/dea/namespaceswift2_1_1api.html">api</a>.<a class="code hl_namespace" href="../../da/d2d/namespaceswift2_1_1api_1_1boundaryconditions.html">boundaryconditions</a>.<a class="code hl_namespace" href="../../d3/da2/namespaceswift2_1_1api_1_1boundaryconditions_1_1Fixed.html">Fixed</a>(particle_set=particle_set,</div>
<div class="line">                                        damp_particles_as_they_approach_boundary=True</div>
<div class="line">                                        )</div>
<div class="line">)</div>
<div class="ttc" id="anamespaceswift2_1_1api_1_1boundaryconditions_1_1Fixed_html"><div class="ttname"><a href="../../d3/da2/namespaceswift2_1_1api_1_1boundaryconditions_1_1Fixed.html">swift2.api.boundaryconditions.Fixed</a></div><div class="ttdef"><b>Definition</b> <a href="../../da/dd5/Fixed_8py_source.html#l00001">Fixed.py:1</a></div></div>
<div class="ttc" id="anamespaceswift2_1_1api_1_1boundaryconditions_html"><div class="ttname"><a href="../../da/d2d/namespaceswift2_1_1api_1_1boundaryconditions.html">swift2.api.boundaryconditions</a></div><div class="ttdoc">Boundary Conditions.</div><div class="ttdef"><b>Definition</b> <a href="../../de/d98/python_2swift2_2api_2boundaryconditions_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="anamespaceswift2_1_1api_html"><div class="ttname"><a href="../../dd/dea/namespaceswift2_1_1api.html">swift2.api</a></div><div class="ttdoc">This file is part of the SWIFT 2 project.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d0d/python_2swift2_2api_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="anamespaceswift2_html"><div class="ttname"><a href="../../de/dac/namespaceswift2.html">swift2</a></div><div class="ttdoc">This file is part of the SWIFT 2 project.</div><div class="ttdef"><b>Definition</b> <a href="../../da/d65/FixedBoundary_8h_source.html#l00008">FixedBoundary.h:8</a></div></div>
</div><!-- fragment --><p>There are various pre-defined action sets to realise various SPH boundary conditions:</p>
<ul>
<li><a class="el" href="../../dd/ddb/namespaceswift2_1_1api_1_1boundaryconditions_1_1Inflow.html">swift2.api.boundaryconditions.Inflow</a></li>
<li><a class="el" href="../../d3/da2/namespaceswift2_1_1api_1_1boundaryconditions_1_1Fixed.html">swift2.api.boundaryconditions.Fixed</a></li>
<li>swift2.api.boundaryconditions.Outflow</li>
</ul>
<p>The advantage with this approach is that it provides a totally generic approach to add boundary conditions. The disadvantage here is that this action set is merged into each and every mesh sweep. However, we should not really alter the particle position "arbitrarily" (which is what a lot of boundary condition action sets do), as we then have to resort the particles. Also, it is economically not very clever to check the boundary conditions in each and every traversal. It makes sense to do these checks only after drifts.</p>
<h2><a class="anchor" id="autotoc_md1087"></a>
Plug into the particle drifts</h2>
<p>In line with the observations above, it is often more elegant to plug into the particle drift as a postprocessing step. There is no generic solution to this approach however. It depends on the type of particle you use, and each particle species variant might require you to add such a a posterior check in a different way.</p>
<p>In the leapfrog SPH solver, for example, attaching a boundary check can be realised as follows:</p>
<div class="fragment"><div class="line">particle.algorithm_steps_dict[<span class="stringliteral">&quot;Drift&quot;</span>].touch_vertex_last_time_kernel += <span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;</span></div>
<div class="line"><span class="stringliteral">::swift2::kernels::forAllParticles(</span></div>
<div class="line"><span class="stringliteral">  marker,</span></div>
<div class="line"><span class="stringliteral">  assignedParticles,</span></div>
<div class="line"><span class="stringliteral">  [&amp;](const peano4::datamanagement::VertexMarker&amp; marker, Particle&amp; assignedParticle)-&gt;void {</span></div>
<div class="line"><span class="stringliteral">    ::swift2::boundaryconditions::applyFixedBoundaryCondition(</span></div>
<div class="line"><span class="stringliteral">      assignedParticle,</span></div>
<div class="line"><span class="stringliteral">      marker,</span></div>
<div class="line"><span class="stringliteral">      DomainOffset,</span></div>
<div class="line"><span class="stringliteral">      DomainSize,</span></div>
<div class="line"><span class="stringliteral">      0.1,</span></div>
<div class="line"><span class="stringliteral">      _spacetreeId</span></div>
<div class="line"><span class="stringliteral">    );</span></div>
<div class="line"><span class="stringliteral">  }</span></div>
<div class="line"><span class="stringliteral">);</span></div>
<div class="line"><span class="stringliteral">&quot;</span><span class="stringliteral">&quot;&quot;</span></div>
</div><!-- fragment --><p>which is the preamble to a reconfiguration of the individual initialisation and solver steps. As written above, the documentation of each and every solver has to contain information how to inject such information.</p>
<p>As a boundary update might be expensive, it is reasonable to embed it into some additional checks:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="../../dc/d90/namespaceswift2_1_1boundaryconditions.html#a277d4dae2c223030de082a3f9fbb7294">::swift2::boundaryconditions::isVertexOnGlobalBoundary</a>(marker,DomainOffset,DomainSize)) {</div>
<div class="line">  <span class="comment">// your update; maybe like in the snippet above</span></div>
<div class="line">}</div>
<div class="ttc" id="anamespaceswift2_1_1boundaryconditions_html_a277d4dae2c223030de082a3f9fbb7294"><div class="ttname"><a href="../../dc/d90/namespaceswift2_1_1boundaryconditions.html#a277d4dae2c223030de082a3f9fbb7294">swift2::boundaryconditions::isVertexOnGlobalBoundary</a></div><div class="ttdeci">bool isVertexOnGlobalBoundary(const peano4::datamanagement::VertexMarker &amp;marker, const tarch::la::Vector&lt; Dimensions, double &gt; &amp;domainOffset, const tarch::la::Vector&lt; Dimensions, double &gt; &amp;domainSize)</div><div class="ttdef"><b>Definition</b> <a href="../../df/d0c/Utils_8cpp_source.html#l00003">Utils.cpp:3</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1088"></a>
Solver coupling</h1>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000079">Todo</a></b></dt><dd>Yet to be written</dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d6/dba/page_swift2_home.html">Swift 2</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:06 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
