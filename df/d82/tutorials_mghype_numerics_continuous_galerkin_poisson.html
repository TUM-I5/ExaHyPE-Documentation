<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('df/d82/tutorials_mghype_numerics_continuous_galerkin_poisson.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Continuous Galerkin for the Poisson equation</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md617">D-linear shape functions and vertex-centred discretisation</a><ul><li class="level2"><a href="#autotoc_md618">Computation of integrals</a></li>
<li class="level2"><a href="#autotoc_md619">Stencil notation</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md620">Higher-order CG solvers</a><ul><li class="level2"><a href="#autotoc_md621">Block decomposition</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>We explain all the numerics in hands-on style for the toy problem</p>
<p>\(
  -\Delta u = f.
\)</p>
<p>We don't solve this one directly (point-wisely), but we check it against a test function \( \phi \) and integrate:</p>
<p>\( \int (-\Delta u, \ \phi) dx \ = \  \int (f, \ \phi) dx  \ \ \ \forall \phi. \)</p>
<p>If this holds for all test functions \( \phi \) we can think of, then the solution also fits to the original <a class="el" href="../../da/db8/namespacePDE.html">PDE</a> exactly. Otherwise, it is a <em><b>weak</b></em> solution. As we have the integral and the product of two functions on the left-hand side, we can integrate by parts and get rid of the second derivative. The original solution to the <a class="el" href="../../da/db8/namespacePDE.html">PDE</a> somehow has to have a second derivative everywhere which matches \( f \). The new weak solution then has to have only a first derivative almost everywhere, as we roll one derivative over to the test function and integrate. Small sets (nullsets) of points where there is no first derivative then don't count anymore.</p>
<h1><a class="anchor" id="autotoc_md617"></a>
D-linear shape functions and vertex-centred discretisation</h1>
<p>We illustrate the next steps in one dimension: Let the domain split into cells. We create some shape functions over the domain. Each shape function is a hat, i.e. it is one in one vertex and then goes down linearly over the adjacent two cells to zero. So we end up with functions like the green ones below:</p>
<div class="image">
<img src="../../continuous_shape_functions.png" alt=""/>
</div>
<p><a class="el" href="../../db/d37/structAny.html">Any</a> weighted linear combination over these guys yields a global function. We want to try to construct a weak solution this way. For this, we also have to decide where the test functions come from. A natural choice leading to Ritz-Galerkin Finite Elements is to use the same test and shape functions, i.e. the global linear combination spanning the solution has to fulfill the weak formulation for every single test against one of its shape functions.</p>
<p class="formulaDsp">
\begin{eqnarray*}
  &amp;\int_\text{cell}&amp; ( \nabla u, \ \nabla \phi )dx + \int_\text{face} (\nabla u \cdot \hat{n}, \ \phi) dS(x)
   \ \ \ \forall \phi \\
  =\sum_i u_i \ &amp;\int_\text{cell}&amp; (\nabla \phi_i, \ \nabla \phi) dx 
  + \int_\text{face} (\nabla u \cdot \hat{n}, \ \phi) dS(x)
  \ \ \ \forall \phi

\end{eqnarray*}
</p>
<p>where in the second line we exchanged the definition of \( u \) for its expansion in basis functions.</p>
<p>From here onwards, we drop the surface integral term:</p>
<ul>
<li>At the boundary of the support of a shape function (e.g., points \( u_0 \) and \( u_2 \) of \( \phi _1 \) above) the value of the test function is zero and hence this face integral disappears.</li>
<li>At the centre of the test function, the face integrals stay there. In the example above, we have two: one comes from the left and one from the right adjacent cell. These two terms refer to \( \nabla u \) and have different directions of the normal. So no matter how we define \( \nabla u \) (it doesn't really exist at this point, but we might must make it the average of derivative in the left and right cell), the two terms will cancel out.</li>
</ul>
<p>So all the surface integrals drop out. They don't drop out if we have boundary conditions that prescribe a derivative. But that's a different story for a more advanced textbook.</p>
<h2><a class="anchor" id="autotoc_md618"></a>
Computation of integrals</h2>
<p>The basis of functions that we use in this example are piecewise linear functions, defined in each cell (which is an interval of width \( h \)):</p>
<p class="formulaDsp">
\begin{eqnarray*}
  \phi_i(x) \ = \
\begin{cases}
  \frac{1}{h}(x - x_{i-1}) &amp;\text{if} \ x_{i-1} \ &lt; \ x &lt; \ x_i \\
  \frac{1}{h}(x_{i+1} - x) &amp;\text{if} \ x_{i} \ &lt; \ x &lt; \ x_{i+1} \\
  0                        &amp;\text{otherwise}
\end{cases}
\end{eqnarray*}
</p>
<p>And from this we can write down \( \nabla \phi_i \):</p>
<p class="formulaDsp">
\begin{eqnarray*}
  \nabla \phi_i(x) \ = \
\begin{cases}
  \frac{1}{h} &amp;\text{if} \ x_{i-1} \ &lt; \ x &lt; \ x_i \\
  - \frac{1}{h} &amp;\text{if} \ x_{i} \ &lt; \ x &lt; \ x_{i+1} \\
  0                        &amp;\text{otherwise}
\end{cases}
\end{eqnarray*}
</p>
<p>So now we can finally compute the integrals. Here we integrate over the entire domain (every cell):</p>
<p class="formulaDsp">
\begin{eqnarray*}

\int (\nabla \phi_i, \ \nabla \phi_i) dx \ &amp;=&amp; \ \int_{c_{i}} \frac{1}{h} \cdot \frac{1}{h} dx
    + \int_{c_{i+1}} \frac{-1}{h} \cdot \frac{-1}{h} dx \ = \ \frac{2}{h} \\
\int (\nabla \phi_i, \ \nabla \phi_{i+1}) dx \ &amp;=&amp; \ \int_{c_{i+1}} \frac{-1}{h} \cdot \frac{1}{h} dx \ = \ \frac{1}{h}


\end{eqnarray*}
</p>
<p>With all other being 0, due to the lack of overlap of the support of the shape functions. We used here implicitly that the cell had a width of \( h \). One beautiful property of all of this is that we can precompute all of these integrals, as we know exactly what the shape functions look like.</p>
<p>We end up with a matrix \( Au \ = \ f \). The \( u \) values here are the weights of the shape functions.</p>
<h2><a class="anchor" id="autotoc_md619"></a>
Stencil notation</h2>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000040">Todo</a></b></dt><dd>If someone feels the need to write something here, please do so</dd></dl>
<h1><a class="anchor" id="autotoc_md620"></a>
Higher-order CG solvers</h1>
<p>Higher-order CG solvers are solvers where each cell of the domain hosts a polynomial. Along the faces, these polynomials are glued together with their neighbours such that they are continuous. That means: There's no derivative here along the face normals, but the function does not jump either.</p>
<div class="image">
<img src="../../cg-higher-order-shape-functions.png" alt=""/>
</div>
<p>In the illustration above, two adjacent cells host a polynomial each. The polynomial is continuous if we cross the connecting face along its normal (the face is marked as blue), but the solution is not differentiable along this direction. We only have a continuous function!</p>
<p>The sketch kind of suggests that continuous higher order is intrinsically tied to Gauss-Lobatto nodal points, i.e. an arrangements of the unknowns where nodes are placed on the faces. This is not true. There's no restriction on the faces, even though it is obviously easier to realise continuous Galerkin if we have Lobatto.</p>
<p>The sketch shows an example for quadratic splines, as we have three integration nodes per cell per direction. If we had only two, we'd end up with a d-dimensional shape function. That is, DG is a more general formalism, which degenerates to d-dimensional shape functions once we have $p=1$. In this special case, it it reasonable to forget about all the realisation details below and to use the description from above.</p>
<p>If we store the weights of the shape functions within the vertices and faces, we naturally get a continuous shape function: The weight of a function on a face determines the height of this function at this point both from the left cell's and the right cell's point of view.</p>
<h2><a class="anchor" id="autotoc_md621"></a>
Block decomposition</h2>
<p>The block structure yields a global equation system that resembles</p>
<p>\(
\left(
  \begin{array}{ccccc}
  A_{11} &amp; A_{12} &amp; A_{13} &amp; A_{14} &amp; \cdots \\
  A_{21} &amp; A_{22} &amp; A_{23} &amp; A_{24} &amp; \cdots \\
  A_{31} &amp; A_{32} &amp; A_{33} &amp; A_{34} &amp; \cdots \\
  A_{41} &amp; A_{42} &amp; A_{43} &amp; A_{44} &amp; \cdots \\
  \cdots
  \end{array}
\right)
\left(
  \begin{array}{c}
    u_1 \\ u_2 \\ u_3 \\ ...
  \end{array}
\right)
= 
  M
\left(
  \begin{array}{c}
    b_1 \\ b_2 \\ b_3 \\ ...
  \end{array}
\right)
\)</p>
<p>where each entry \( u_i \) is a small vector in itself that hosts all weights from its respective cell i. Once we stick to Gauss-Lobatto, only the shape functions directly on the facets span multiple cells. All other shape functions have cell-local support. Therefore, the matrix entries \( A_{ii} \) are dense, but only those \( A_{ij} \) hold entries where cell i and cell j are connected through a facet. All arguments holds for the right-hand matrix M, too.</p>
<p>We can evaluate \( Au \) matrix-freely, and for all nodal points within the cell, we can do this within touchCellFirstTime(). The points on the face are a little bit more difficult. Here, we need to accumulate the residual as well as the diagonal and issue a Jacobi solver. A direct evaluation in one rush does not work. We can, obviously, also use Jacobi everywhere.</p>
<p>Per cell, we define a matrix \( \chi \) which gives us only the interior points of a cell. That is, we have \( \chi \in \mathbb{R}^{(p-2)^d \times p^d} \). Here, p is the number of nodes per axis. d is the spatial dimension. For \( p = 3 \), we obtain</p>
<p>\(
\left(
  \begin{array}{cccccccccccccccc}
   0 &amp; 0 &amp; 0 &amp; 0 &amp;    0 &amp; 1 &amp; 0 &amp; 0 &amp;     0 &amp; 0 &amp; 0 &amp; 0 &amp;    &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 
   0 &amp; 0 &amp; 0 &amp; 0 &amp;    0 &amp; 0 &amp; 1 &amp; 0 &amp;     0 &amp; 0 &amp; 0 &amp; 0 &amp;    &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 
   0 &amp; 0 &amp; 0 &amp; 0 &amp;    0 &amp; 0 &amp; 0 &amp; 0 &amp;     0 &amp; 1 &amp; 0 &amp; 0 &amp;    &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 
   0 &amp; 0 &amp; 0 &amp; 0 &amp;    0 &amp; 0 &amp; 0 &amp; 0 &amp;     0 &amp; 0 &amp; 1 &amp; 0 &amp;    &amp; 0 &amp; 0 &amp; 0 &amp; 0 
  \end{array}
\right)
\)</p>
<div class="image">
<img src="../../chi.png" alt=""/>
</div>
<p>When we enter the cell, we evaluate</p>
<p>\(
u_i^{(n+0.5)} = u_i^{(n)} + \chi ^T \left( \chi A_i \chi^T \right) ^{-1} \chi (b - Au^{(n)})
\)</p>
<p>which updates all the interior points of a patch. After that, we can update the outer points subject to a standard Jacobi iteration to obtain a \( u_i^{(n+1)} \). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d3/da3/page_multigrid_home.html">MGHyPE</a></li><li class="navelem"><a class="el" href="../../d4/d49/page_mghype_tutorials.html">Tutorials</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:28:59 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
