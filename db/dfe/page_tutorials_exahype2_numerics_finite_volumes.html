<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('db/dfe/page_tutorials_exahype2_numerics_finite_volumes.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Finite Volumes</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md576">Storage scheme</a></li>
<li class="level1"><a href="#autotoc_md577">Finite Volumes in a nutshell</a></li>
<li class="level1"><a href="#autotoc_md578">Rusanov</a></li>
<li class="level1"><a href="#autotoc_md579">An implementation</a></li>
</ul>
</div>
<div class="textblock"><div style="background-color: #ccf ; padding: 10px; border: 1px solid green;"> This page is a crude run-through through the Finite Volumes numerical scheme as we find it in ExaHyPE. It covers the basics without most of the actual maths that you find in textbooks. In a first run through the tutorials, it might be reasonable to skip this page, to continue with some hands-on examples and then to return to this description once you have a code up and running and want to deep dive into the methodology. </div><p>ExaHyPE's Finite Volume scheme is based upon block-structured Cartesian meshes. All Finite Volume solvers work with blockstructured AMR: They embed \(p \times p\) patches into the octants (cells of the spacetree). To avoid confusion, I prefer to use the term volume for the cells within the patch, as cell would be ambigous given that we construct the Â host mesh from spacetree cells.</p>
<div class="image">
<img src="../../block-structured.png" alt=""/>
</div>
<p>With the Finite Volume methods, we only have single-shot methods at the moment. That is, Peano runs over the octants of the mesh, i.e. the patches. Per patch, it calls and ExaHyPE update kernel, which takes the patch and moves it forwards in time by a given \( \Delta t \). ExaHyPE is shipped with several update schemes. You can obviously also write your own numerical scheme manually, or you employ ExaHyPE's kernel domain-specific language (DSL).</p>
<h1><a class="anchor" id="autotoc_md576"></a>
Storage scheme</h1>
<p>Every patch has to depends upon its neighbouring, i.e. face-connected patches. To be able to do this, ExaHyPE passes a <br  />
 \( (p+2N)^d \) patch into a kernel. The p is the number of volumes per patch. The d is the dimension, i.e. two or three. The \( N \geq 1 \) is a halo around the cell. Different Finite Volume schemes have different halo sizes. You may assume that ExaHyPE befills these halo values with valid data from the neighbours, i.e. their synchronisation is none of the kernel's business. The input is called \( Q_{in} \) from hereon. The kernel returns a \( (p+2 N)^d \) with the new time step's data. It is called \( Q_{out} \).</p>
<p>Here are some details about the data used within the kernels:</p>
<ul>
<li>The halo data, i.e. the \( N \) layer around the patch is automatically befilled. However, we only maintain the face-connected data. Consequently, the diagonal (corners) do not exist. To make the whole logic easier, the \( Q_{in} \) nevertheless hold these data. They contain garbage. Example: In a \( 7 \times 7 \) patch world with \( N=2 \), we have 49 volumes in the core centre, surrounded by \( 2d \cdot (N \cdot p^{d-1}) = 4 \dot (2 \dot 7) \) face-connected values. The \( 4 \cdot (2 \cdot 2 ) \) corners of the halo do not hold any meaningful data. Nevertheless, we let \( Q_{in} \) holds a \( (7+2\cdot 2) \) volumes</li>
<li>The volumes within \( Q_{in} \) and \( Q_{out} \) are ordered lexicographically.</li>
<li>The data are stores as array of structs (AoS).</li>
<li>If a <a class="el" href="../../da/db8/namespacePDE.html">PDE</a> is described by \( K_{pde} \) real values subject to the wave equations and \( K_{aux} \) auxiliary variables (material parameters), then the \( Q_{in} \) contains \( K_{pde} + K_{aux} \) values (degrees of freedom) per volume. The \( Q_{out} \) however contains only the \( K_{pde} + K_{aux} \) values, too, but the \( K_{aux} \) material parameters do not evolve in time and therefore are the same as in \( Q_{in} \).</li>
<li>Besides \( Q_{in} \) and \( Q_{out} \) a kernel is given the current time \( t \) and the time step size \( \Delta t \).</li>
<li>We never write a kernel for only one patch. We always write kernels that can advanced multiple patches in one go. So the "update one patch" is a special case.</li>
</ul>
<h1><a class="anchor" id="autotoc_md577"></a>
Finite Volumes in a nutshell</h1>
<p>In Finite Volumes, we assume that each voxel holds exactly one value per <a class="el" href="../../da/db8/namespacePDE.html">PDE</a> quantity. We assume that the solution is constant within the volume.</p>
<div class="image">
<img src="../../finite-volumes.png" alt=""/>
</div>
<p>In the 1d illustration above, we have a patch with \( p=5 \) volumes, one quantity and a halo of one. That is, we are given a \( Q_{in} \) with 7 values and return 5 new values for the next time step. So now we do the math:</p>
<p>If the solution per volume is constant, nothing happens within the volume per time step. The solution inside is kind of "stable". If something happens with a volume, i.e. if the solution grows or goes down, then this must be due to stuff flowing in or out of the voxel. We can write this down as integral over each volume V:</p>
<p>\( 
 \int _V Q_k(t+\Delta t) dx = \int _V Q_k(t) dx + \Delta t \cdot \int _V \partial _t Q_k(t) dx 
\)</p>
<p>We have already used an explicit Euler time integrator here. Next, we make the formula a little bit simpler exploiting the fact that a volume shall have the volume length \( h \) and each volume is a square or cube, respectively. Once again, it helps that the solution is constant per volume.</p>
<p class="formulaDsp">
\begin{eqnarray*} 
 \int _V Q_k(t+\Delta t) dx &amp; = &amp; \int _V Q_k(t) dx + \Delta t \cdot \int _V \partial _t Q_k(t) dx \\
 h^d Q_k(t+\Delta t) &amp; = &amp; h^d Q_k(t) dx + \Delta t \cdot \int _V \partial _t Q_k(t) dx \\
 h^d Q_k(t+\Delta t) &amp; = &amp; h^d Q_k(t) dx + \Delta t \cdot \int _V \nabla F(Q_k(t)) + S(Q_k)  dx
\end{eqnarray*}
</p>
<p>In the last line, we now insert our <a class="el" href="../../da/db8/namespacePDE.html">PDE</a> written as</p>
<p>\( 
 \partial _t Q(t) = \nabla F(Q(t)) + S(Q) 
\)</p>
<p>and use the divergence theorem:</p>
<p class="formulaDsp">
\begin{eqnarray*} 
 h^d Q_k(t+\Delta t) &amp; = &amp; h^d Q_k(t) dx + \Delta t \cdot \int _V \nabla F(Q_k(t)) + S_k(Q)  dx \\
 Q_k(t+\Delta t) &amp; = &amp; Q_k(t) dx + \frac{\Delta t}{h^d} \cdot \left( \oint _{\partial V} (F(Q_k(t)),n) dS(x) + h^d \cdot S(Q_k) \right)
\end{eqnarray*}
</p>
<p>So in principle, we now know exactly what to do:</p>
<ul>
<li>Loop over all volumes in the patch.</li>
<li>Copy its \( Q_{in} \) in \( Q_{out} \).</li>
<li>Add the source term \( S(Q_k) \) scaled by the time step size.</li>
<li>Add this additional term of inflow or outflow. Again, we can exploit the fact that the normal n has only one entry with \( \pm 1 \) (so F returns a vector, but we pick only one entry and scale it maybe with a -1). And then we scale the whole thing with a \( h^{d-1} \) as we integrate over a surface, but the straightaway divide by \( h^d \).</li>
</ul>
<p>The problem is that we don't know the F value at the voxel. That thing doesn't really exist. The solution has no value there, as it jumps. So we have to approximate this term \( F(Q) \) at the voxel boundary with a numerical flux.</p>
<h1><a class="anchor" id="autotoc_md578"></a>
Rusanov</h1>
<p>One of the simlest flux is <a class="el" href="../../d5/d0e/namespaceRusanov.html">Rusanov</a>:</p>
<p>\(
    {F|}_{n}(Q) \approx \frac{1}{2} (F_n^+(Q) + F_n^-(Q)) - (Q^+ - Q^-) \cdot \text{max}(\lambda_{max,n}(Q^+),\lambda_{max,n}(Q^-))
\)</p>
<p>The flux on a face \( {F}_{n}(Q) \) is the average of the flux within the left adjacent cell and the right adjacent cell. This average is denoted by a red circle in the sketch above. If we only used the average, we would get a solution where shocks smear out quickly. In the sketch above, the wave/shock travels from left to right, so it makes sense to assume that actually way more flow goes left-right than right-to-left. Averaging is not a good idea. So we take the difference \( Q^+ - Q^- \), we know how to correct the numerical flux. Take into account that the "remaining" eigenvalues are all positive for a stricly hyperbolic system. Globally, there is one negative eigenvalue but that one corresponds to the time dimension and is already taken care of.</p>
<p>Yet, the speed matters: If the flow is very slow, then we only should correct the average by a tiny amount. If the wave travels very fast, we should significantly take this solution gradient into account. The wave speed it approximated/bounded by the maximum eigenvalue along the direction of interest. Again, we cannot evaluate the maximum eigenvalue on the face directly, but we only are interested in the maximum eigenvalue. Therefore, we can evaluate the directional eigenvalue in the left and right volume and again take the maximum of those guys.</p>
<h1><a class="anchor" id="autotoc_md579"></a>
An implementation</h1>
<p>Our discussion of an implementation of the scheme - which can be read as blueprint of our compute kernels in ExaHyPE - is inspired by</p>
<div class="fragment"><div class="line">@article{10.1145/3406835,</div>
<div class="line">author = {Uphoff, Carsten and Bader, Michael},</div>
<div class="line">title = {Yet Another Tensor Toolbox <span class="keywordflow">for</span> Discontinuous Galerkin Methods and Other Applications},</div>
<div class="line">year = {2020},</div>
<div class="line">issue_date = {December 2020},</div>
<div class="line">publisher = {Association <span class="keywordflow">for</span> Computing Machinery},</div>
<div class="line">address = {<a class="code hl_enumvalue" href="../../d7/d7c/namespacepeano4_1_1grid.html#af8e5a430d46e861a3f32ee7671827be6a03c2e7e41ffc181a4e84080b4710e81e">New</a> York, NY, USA},</div>
<div class="line"><a class="code hl_function" href="../../d2/d45/namespacetarch_1_1la.html#a0652bd2078150d09c0cb5eed30291804">volume</a> = {46},</div>
<div class="line">number = {4},</div>
<div class="line">issn = {0098-3500},</div>
<div class="line">url = {https:<span class="comment">//doi.org/10.1145/3406835},</span></div>
<div class="line">doi = {10.1145/3406835},</div>
<div class="line">abstract = {The numerical solution of partial differential <a class="code hl_namespace" href="../../d6/ddb/namespaceequations.html">equations</a> is at the heart of many grand challenges in supercomputing. Solvers based on high-<a class="code hl_variable" href="../../df/dd7/namespacetest__LagrangeBasis.html#a778a6f73f8e0a34dc2e308f196845894">order</a> discontinuous Galerkin (DG) discretisation have been shown to <a class="code hl_variable" href="../../d2/dc0/namespacemakeIC-multiscale.html#a81a6878b2584f011850f626cb774c827">scale</a> on large supercomputers with excellent performance and efficiency <span class="keywordflow">if</span> the implementation exploits all levels of parallelism and is tailored to the specific architecture. However, every year <span class="keyword">new</span> supercomputers emerge and the list of hardware-specific considerations grows simultaneously with the list of desired features in <a class="code hl_variable" href="../../d0/de2/hydro__iact_8h.html#a8cbb00f59bca2c48d4560b23f07a4de2">a</a> DG code. Thus, we believe that <a class="code hl_variable" href="../../d0/de2/hydro__iact_8h.html#a8cbb00f59bca2c48d4560b23f07a4de2">a</a> sustainable DG code needs an abstraction layer to implement the numerical <a class="code hl_variable" href="../../dc/d5e/namespaceModeCalc.html#a5b1758e4ec9e9220691c17e3443b57d2">scheme</a> in <a class="code hl_variable" href="../../d0/de2/hydro__iact_8h.html#a8cbb00f59bca2c48d4560b23f07a4de2">a</a> suitable language. We explore the possibility to abstract the numerical <a class="code hl_variable" href="../../dc/d5e/namespaceModeCalc.html#a5b1758e4ec9e9220691c17e3443b57d2">scheme</a> as small tensor operations, describe them in <a class="code hl_variable" href="../../d0/de2/hydro__iact_8h.html#a8cbb00f59bca2c48d4560b23f07a4de2">a</a> domain-specific language (DSL) resembling the Einstein notation, and to map them to small General Matrix-Matrix Multiplication routines. The compiler <span class="keywordflow">for</span> our DSL implements classic optimisations that are used <span class="keywordflow">for</span> large tensor contractions, and we present novel optimisation techniques such as equivalent sparsity patterns and optimal <a class="code hl_variable" href="../../d4/d97/namespacemakeIC.html#a3dce17baf760baafb8166cf9555f083b">index</a> permutations <span class="keywordflow">for</span> temporary tensors. Our application <a class="code hl_namespace" href="../../d6/de9/namespaceexamples.html">examples</a>, which include the earthquake simulation software SeisSol, show that the <a class="code hl_variable" href="../../d0/df3/namespacepeano4_1_1datamodel_1_1DaStGen2.html#a5d927b2d169cf026b24a35afe6420c50">generated</a> <a class="code hl_namespace" href="../../de/dd9/namespacekernels.html">kernels</a> achieve over 50\% peak performance of <a class="code hl_variable" href="../../d0/de2/hydro__iact_8h.html#a8cbb00f59bca2c48d4560b23f07a4de2">a</a> recent 48-core Skylake system <span class="keywordflow">while</span> the DSL considerably simplifies the implementation.},</div>
<div class="line">journal = {ACM Trans. Math. Softw.},</div>
<div class="line">month = oct,</div>
<div class="line">articleno = {34},</div>
<div class="line">numpages = {40},</div>
<div class="line">keywords = {ADER-DG, Tensor operations, <a class="code hl_namespace" href="../../da/dce/namespacefinite.html">finite</a> element method, high-performance computing}</div>
<div class="line">}</div>
<div class="ttc" id="ahydro__iact_8h_html_a8cbb00f59bca2c48d4560b23f07a4de2"><div class="ttname"><a href="../../d0/de2/hydro__iact_8h.html#a8cbb00f59bca2c48d4560b23f07a4de2">a</a></div><div class="ttdeci">const float const float const float struct part *restrict struct part *restrict const float a</div><div class="ttdef"><b>Definition</b> <a href="../../d0/de2/hydro__iact_8h_source.html#l00055">hydro_iact.h:55</a></div></div>
<div class="ttc" id="anamespaceModeCalc_html_a5b1758e4ec9e9220691c17e3443b57d2"><div class="ttname"><a href="../../dc/d5e/namespaceModeCalc.html#a5b1758e4ec9e9220691c17e3443b57d2">ModeCalc.scheme</a></div><div class="ttdeci">str scheme</div><div class="ttdoc">main code scheme=&quot;Gauss_Legendre&quot;</div><div class="ttdef"><b>Definition</b> <a href="../../d4/de9/ModeCalc_8py_source.html#l00077">ModeCalc.py:77</a></div></div>
<div class="ttc" id="anamespaceequations_html"><div class="ttname"><a href="../../d6/ddb/namespaceequations.html">equations</a></div><div class="ttdef"><b>Definition</b> <a href="../../dd/d33/tests_2exahype2_2aderdg_2equations_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="anamespaceexamples_html"><div class="ttname"><a href="../../d6/de9/namespaceexamples.html">examples</a></div><div class="ttdoc">This code is taken from the original ExaHyPE project written by colleagues from the University of Tre...</div><div class="ttdef"><b>Definition</b> <a href="../../d9/df8/grid_2MyObserver_8h_source.html#l00011">MyObserver.h:11</a></div></div>
<div class="ttc" id="anamespacefinite_html"><div class="ttname"><a href="../../da/dce/namespacefinite.html">finite</a></div><div class="ttdoc">-volumes</div></div>
<div class="ttc" id="anamespacekernels_html"><div class="ttname"><a href="../../de/dd9/namespacekernels.html">kernels</a></div><div class="ttdef"><b>Definition</b> <a href="../../d0/db5/idx_8h_source.html#l00005">idx.h:5</a></div></div>
<div class="ttc" id="anamespacemakeIC-multiscale_html_a81a6878b2584f011850f626cb774c827"><div class="ttname"><a href="../../d2/dc0/namespacemakeIC-multiscale.html#a81a6878b2584f011850f626cb774c827">makeIC-multiscale.scale</a></div><div class="ttdeci">float scale</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d06/test-smoothing-length-computation-2D_2makeIC-multiscale_8py_source.html#l00133">makeIC-multiscale.py:133</a></div></div>
<div class="ttc" id="anamespacemakeIC_html_a3dce17baf760baafb8166cf9555f083b"><div class="ttname"><a href="../../d4/d97/namespacemakeIC.html#a3dce17baf760baafb8166cf9555f083b">makeIC.index</a></div><div class="ttdeci">index</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d30/hydro-simple-sph-physics_2sedov-blast_2makeIC_8py_source.html#l00038">makeIC.py:38</a></div></div>
<div class="ttc" id="anamespacepeano4_1_1datamodel_1_1DaStGen2_html_a5d927b2d169cf026b24a35afe6420c50"><div class="ttname"><a href="../../d0/df3/namespacepeano4_1_1datamodel_1_1DaStGen2.html#a5d927b2d169cf026b24a35afe6420c50">peano4.datamodel.DaStGen2.generated</a></div><div class="ttdeci">generated</div><div class="ttdef"><b>Definition</b> <a href="../../d3/deb/DaStGen2_8py_source.html#l00189">DaStGen2.py:189</a></div></div>
<div class="ttc" id="anamespacepeano4_1_1grid_html_af8e5a430d46e861a3f32ee7671827be6a03c2e7e41ffc181a4e84080b4710e81e"><div class="ttname"><a href="../../d7/d7c/namespacepeano4_1_1grid.html#af8e5a430d46e861a3f32ee7671827be6a03c2e7e41ffc181a4e84080b4710e81e">peano4::grid::VertexType::New</a></div><div class="ttdeci">@ New</div></div>
<div class="ttc" id="anamespacetarch_1_1la_html_a0652bd2078150d09c0cb5eed30291804"><div class="ttname"><a href="../../d2/d45/namespacetarch_1_1la.html#a0652bd2078150d09c0cb5eed30291804">tarch::la::volume</a></div><div class="ttdeci">Scalar volume(const Vector&lt; Size, Scalar &gt; &amp;vector)</div><div class="ttdoc">Computes the volume of the tetrahedron spanned by the Cartesian unit vectors scaled by the correspond...</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d88/VectorOperations_8cpph_source.html#l00175">VectorOperations.cpph:175</a></div></div>
<div class="ttc" id="anamespacetest__LagrangeBasis_html_a778a6f73f8e0a34dc2e308f196845894"><div class="ttname"><a href="../../df/dd7/namespacetest__LagrangeBasis.html#a778a6f73f8e0a34dc2e308f196845894">test_LagrangeBasis.order</a></div><div class="ttdeci">int order</div><div class="ttdef"><b>Definition</b> <a href="../../db/d13/test__LagrangeBasis_8py_source.html#l00006">test_LagrangeBasis.py:6</a></div></div>
</div><!-- fragment --><p>who write down the algorithm as a sequence of tensor multiplications, i.e. generalised matrix-matrix equations. This does not work in ExaHyPE 1:1 as we support non-linear PDEs in the generic kernel formulations. However, we can use similar operator concatenation ideas.</p>
<p>We demonstate the data flow by means of the simplified numerical flux which only takes the average. This algorithm consists of a strict sequence of steps:</p>
<ul>
<li>We evaluate \( S(Q) \) per voxel. The output is stored in a \( p \times p \times p \) patch where each volume holds \( K_{pde} \) values. The output is called \( Q_{S} \).</li>
<li>We evaluate \( F(Q)_x \) per voxel. That the flux in one direction. The output is stored in a \( (p+2N) \times p \times p \) patch where each volume holds \( K_{pde} \) values. The output is called \( Q_{F_x} \). Note that this is the core patch extended by the halo in one direction!</li>
<li>We evaluate \( F(Q)_y \) per voxel. That the flux in one direction. The output is stored in a \( p \times (p+2N) \times p \) patch where each volume holds \( K_{pde} \) values. The output is called \( Q_{F_y} \). Note that this is the core patch extended by the halo in one direction!</li>
<li>We evaluate \( F(Q)_z \) per voxel. That the flux in one direction. The output is stored in a \( p \times p \times (p+2N) \) patch where each volume holds \( K_{pde} \) values. The output is called \( Q_{F_z} \). Note that this is the core patch extended by the halo in one direction!</li>
</ul>
<p>Now all temporary data are available. We prepare the output and then add the <a class="el" href="../../da/db8/namespacePDE.html">PDE</a> contributions. This part is basically a stencil variant. Or we can write it down as a tensor-vector product which is added to \( Q_{out} \):</p>
<ul>
<li>We copy over \( Q_{in} \) into \( Q_{out} \). Per voxel, we have o copy \( K_{pde} + K_{aux} \) unknowns.</li>
<li>Add to each voxel \( Q_{in}[x,y,z] \) the value \( \Delta t \cdot Q_{S}[x,y,z] \). This loop runs over \( K_{pde} \) unknowns only. The \( K_{aux} \) entries are not touched.</li>
<li>Add to each voxel \( Q_{in}[x,y,z] \) the value \( \frac{\Delta t}{2h} \cdot (Q_{F_x}[x-1,y,z]+Q_{F_x}[x,y,z]+Q_{F_x}[x,y,z]+Q_{F_x}[x+1,y,z])\). This loop runs over \( K_{pde} \) unknowns only. The \( K_{aux} \) entries are not touched.</li>
<li>Add to each voxel \( Q_{in}[x,y,z] \) the value \( \frac{\Delta t}{2h} \cdot (Q_{F_y}[x,y-1,z]+2Q_{F_y}[x,y,z]+Q_{F_y}[x,y+1,z])\). This loop runs over \( K_{pde} \) unknowns only. The \( K_{aux} \) entries are not touched.</li>
<li>Add to each voxel \( Q_{in}[x,y,z] \) the value \( \frac{\Delta t}{2h} \cdot (Q_{F_z}[x,y,z-1]+2Q_{F_z}[x,y,z]+Q_{F_z}[x,y,z+1])\). This loop runs over \( K_{pde} \) unknowns only. The \( K_{aux} \) entries are not touched.</li>
</ul>
<p>The extension to <a class="el" href="../../d5/d0e/namespaceRusanov.html">Rusanov</a> for example is straightforward, as long as we take into account that our "stencil" here has to incorporate the max function. Below is schematic illustration of the data flow:</p>
<div class="image">
<img src="../../data-flow-finite-volumes.png" alt=""/>
</div>
<p>Note that the scheme as well as the description lack an important detail: Every single step is to be done over a set of patches, as we update multiple patches in one go. In the kernels, we can write down this logic as a sequence of operators, but once you employ our xDSL kernel language, the underlying kernel generator will permute and fuse all the loops and operations. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d3/d82/page_exahype2_home.html">ExaHyPE 2</a></li><li class="navelem"><a class="el" href="../../d8/d60/page_exahype2_tutorials.html">Tutorials</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:28:58 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
