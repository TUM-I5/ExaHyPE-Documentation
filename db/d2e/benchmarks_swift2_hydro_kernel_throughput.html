<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('db/d2e/benchmarks_swift2_hydro_kernel_throughput.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Kernel throughput benchmark</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md713">Design</a><ul><li class="level2"><a href="#autotoc_md714">What the benchmark does</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md715">Build a demo</a></li>
<li class="level1"><a href="#autotoc_md716">Postprocessing</a></li>
<li class="level1"><a href="#autotoc_md717">Assessing individual kernels</a></li>
</ul>
</div>
<div class="textblock"><p>This is a short benchmark which assesses the kernel throughputs of the Swift 2 project.</p>
<h1><a class="anchor" id="autotoc_md713"></a>
Design</h1>
<p>The benchmark design is very simple. We first create a simple SPH test through the full-blown Swift 2 software stack. Before we compile, we however replace the main file with our bespoke benchmark main, which is really just a sequence of loops.</p>
<p>The benchmark is guided by few key parameters</p>
<ul>
<li>Number of particles. The benchmark driver iterates over those particles internally. You can alter the maximum particles count however (invoke the Python script with &ndash;help for details).</li>
<li>The whole test suite is repeated <code>sample</code> times. The default is 16, but you can alter it through the Python script.</li>
<li>The tutal number of particles is split up into work items, i.e. chunks of continuous particles. For a real setup, we can think of these work items as the number of particles associated typically with a vertex while we kick them, or we can read them as the average number of particles per cell which have to be compared to each other. Lacking a better name, we use the generic term work item here and make its size configurable.</li>
<li>The benchmark runs over a sequence of work items and invokes the kernels over all particles per work item. If you have a linear kernel (e.g. the drift or kick), the script runs through all particles per work item. If you have a quadratic kernel (force and density) the benchmark runs over all particles of a work item checked against all other particles of this work item. That is, the kernel benchmark works with quadratic complexity over the work item size, but linear complexity overall. We do not write these loops here ourselves, but we directly invoke the Swift 2 loop routines, i.e. everything we measure is 1:1 from the Swift 2 code base.</li>
</ul>
<h2><a class="anchor" id="autotoc_md714"></a>
What the benchmark does</h2>
<p>The benchmark takes the total number of particles and splits it up into chunks of work items. Per hydro kernel operator, we loop over the work items in parallel and issue the compute kernel per chunk. We then report on the outcome similar to</p>
<div class="fragment"><div class="line">===============================</div>
<div class="line"> Experiment: 256 particles</div>
<div class="line"> No of work items: 4</div>
<div class="line">===============================</div>
<div class="line">density kernel: 0.000752679  (avg=0.000752679,#measurements=16,max=0.0119854(value #15),min=3.257e-06(value #12),+1492.37%,-99.5673%,<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>-deviation=0.00290028)</div>
<div class="line">force kernel:   4.20344e-06  (avg=4.20344e-06,#measurements=16,max=8.392e-06(value #0),min=3.695e-06(value #11),+99.6461%,-12.0958%,<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>-deviation=1.10753e-06)</div>
<div class="line">kick1 kernel:   1.41364e-05  (avg=1.41364e-05,#measurements=16,max=5.0735e-05(value #3),min=1.0868e-05(value #14),+258.897%,-23.1203%,<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>-deviation=9.60516e-06)</div>
<div class="line">kick2 kernel:   1.25493e-05  (avg=1.25493e-05,#measurements=16,max=1.6944e-05(value #10),min=1.1706e-05(value #4),+35.0193%,-6.71999%,<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>-deviation=1.16347e-06)</div>
<div class="line">drift kernel:   2.10832e-05  (avg=2.10832e-05,#measurements=16,max=0.000168095(value #2),min=1.1007e-05(value #12),+697.294%,-47.7925%,<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>-deviation=3.79588e-05)</div>
<div class="line">===============================</div>
<div class="line"> Experiment: 512 particles</div>
<div class="line"> No of work items: 8</div>
<div class="line">===============================</div>
<div class="line">density kernel: 0.00024182  (avg=0.00024182,#measurements=16,max=0.0034722(value #0),min=3.836e-06(value #1),+1335.86%,-98.4137%,<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>-deviation=0.000835668)</div>
<div class="line">force kernel:   0.000694633  (avg=0.000694633,#measurements=16,max=0.0088532(value #15),min=4.288e-06(value #10),+1174.51%,-99.3827%,<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>-deviation=0.00217165)</div>
<div class="line">kick1 kernel:   4.28743e-05  (avg=4.28743e-05,#measurements=16,max=0.000353835(value #2),min=1.9147e-05(value #6),+725.286%,-55.3415%,<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>-deviation=8.07341e-05)</div>
<div class="line">kick2 kernel:   2.21336e-05  (avg=2.21336e-05,#measurements=16,max=4.2598e-05(value #2),min=1.9444e-05(value #10),+92.4589%,-12.1515%,<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>-deviation=5.47072e-06)</div>
<div class="line">drift kernel:   4.49467e-05  (avg=4.49467e-05,#measurements=16,max=0.000418756(value #1),min=1.956e-05(value #10),+831.673%,-56.4818%,<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>-deviation=9.65175e-05)</div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace.</div></div>
</div><!-- fragment --><p>This way, we can assess different kernel speeds against each other. Depending on the build (OpenMP on, GPU offloading on), we assess different variants of the kernel and compare them against each other.</p>
<h1><a class="anchor" id="autotoc_md715"></a>
Build a demo</h1>
<p>The build can all be triggered through the command line using the Python interface.</p>
<div class="fragment"><div class="line"><span class="keyword">export</span> PYTHONPATH=../../../../python</div>
<div class="line">python3 kernel-throughput.py --dimensions 2</div>
</div><!-- fragment --><p>This is the baseline version using some default arguments. You might want to tailor the settings. The build yields an executable which you should be able to run without further user interference.</p>
<h1><a class="anchor" id="autotoc_md716"></a>
Postprocessing</h1>
<p>There's a postprocessing script in the directory, which expects the naming convention as of above. It operates on a per-directory basis:</p>
<div class="fragment"><div class="line">python3 ./print-kernel-throughput.py file</div>
</div><!-- fragment --><div class="image">
<img src="../../trace.out.png" alt=""/>
</div>
<h1><a class="anchor" id="autotoc_md717"></a>
Assessing individual kernels</h1>
<p>It is possible to assess individual kernels. First, we can narrow down the measurement to individual particles counts:</p>
<div class="fragment"><div class="line">python3 kernel-throughput.py --dimensions 2 --min-particle-number 65536 --max-particle-number 65536</div>
</div><!-- fragment --><p>Further to that, we can pick only certain kernels. If you type in &ndash;help, you see all kernels that we offer as part of the benchmark. By default, we test all of them. If you use the &ndash;enable-kernel argument, all kernels are, by default, switched off and you pick one or multiple kernels from the list.</p>
<div class="fragment"><div class="line">python3 kernel-throughput.py --dimensions 2 --enable-kernel drift</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d6/dba/page_swift2_home.html">Swift 2</a></li><li class="navelem"><a class="el" href="../../d3/d24/swift_benchmarks.html">Benchmarks</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:01 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
