<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dd/db7/page_dastgen_home.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">DaStGen</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md833">Attributes</a></li>
<li class="level1"><a href="#autotoc_md834">Aspects</a></li>
<li class="level1"><a href="#autotoc_md835">Aggressive vectorisation</a></li>
</ul>
</div>
<div class="textblock"><p>At several points, Peano and its extensions use plain C++ classes as data storage. All the unknowns per vertex or the particles for example are modelled as individual classes. On the Python level, Peano offers the <a class="el" href="../../d6/d7b/namespacedastgen2.html">dastgen2</a> package to model these classes. You simple create an instance of a <a class="el" href="../../d2/d33/namespacedastgen2_1_1DataModel.html">dastgen2.DataModel</a> which represents your envisaged C++ class, and then you add the attributes that you want to have. A code generator then takes this data structure and dumps it into a plain C++ header plus implementation file. It also generates setters and getters for the fields.</p>
<p>There are two more features that are added through the DaStGen object interface. On the one hand, the generated C++ code will hold annotations how to store the underlying object efficiently. Most compilers will ignore such information, i.e. will be unable to compress the data or support non-IEEE floating-point format, but our group is working on an LLVM-extension which provides exactly this: It can take annotated C++ code and translate it into memory-optimised machine code. Through the DaStGen Python API, you can specify the required annotations within Python.</p>
<p>On the other hand, the translation from a Python data structure into C++ gives the API the opportunity to add aspects to the generated code, i.e. some generic utilities. For Peano, you can, for example, add support for MPI datatypes. In this case, the generated class not only holds the attributes, it also defines a user-defined MPI datatype, such that objects of this class can be sent out natively via MPI. Further to that, Peano defines further plug-ins (aspects) that you can add if an object represents face or vertex data, e.g. In this case, Peano will expect the created routines to provide merge routines which specify how to merge copies at the domain boundaries, or it needs some boolean functions which point out whether to exchange boundary data or not. This can be done in Python by adding the corresponding aspects which in turn just inject additional C++ functions into the generated code.</p>
<p>Finally, Peano defines its own falvours (specialisations) of <a class="el" href="../../d2/d33/namespacedastgen2_1_1DataModel.html">dastgen2.DataModel</a> for special extensions. The blockstructured meshes for example have a specialisation which represents a patch and also injects the right merges for boundary data exchange right from the start. The <a class="el" href="../../de/dac/namespaceswift2.html" title="This file is part of the SWIFT 2 project.">swift2</a> extension also defines its own data model for particles. Again, a particle is just a <a class="el" href="../../d2/d33/namespacedastgen2_1_1DataModel.html">dastgen2.DataModel</a>, i.e. will be mapped onto a plain C++ class, but each particle always has some pre-defined routines and attributes such as a position in space.</p>
<h1><a class="anchor" id="autotoc_md833"></a>
Attributes</h1>
<p>If you want to add further attributes to the DaStGen2 data model, use the routine dastgen2.DataModel.add_attribute(). Each C++ data type that we use has its counterpart in the namespace <a class="el" href="../../d6/ddd/namespacedastgen2_1_1attributes.html">dastgen2.attributes</a>. With</p>
<div class="fragment"><div class="line">my_model = <a class="code hl_namespace" href="../../d6/d7b/namespacedastgen2.html">dastgen2</a>.<a class="code hl_namespace" href="../../d2/d33/namespacedastgen2_1_1DataModel.html">DataModel</a>( <span class="stringliteral">&quot;mynamespace::MyClass&quot;</span> )</div>
<div class="line">my_model.add_attribute( <a class="code hl_namespace" href="../../d6/d7b/namespacedastgen2.html">dastgen2</a>.<a class="code hl_namespace" href="../../d6/ddd/namespacedastgen2_1_1attributes.html">attributes</a>.<a class="code hl_namespace" href="../../d7/d6e/namespacedastgen2_1_1attributes_1_1Double.html">Double</a>(<span class="stringliteral">&quot;myAttribute&quot;</span>) )</div>
<div class="ttc" id="anamespacedastgen2_1_1DataModel_html"><div class="ttname"><a href="../../d2/d33/namespacedastgen2_1_1DataModel.html">dastgen2.DataModel</a></div><div class="ttdef"><b>Definition</b> <a href="../../df/d66/DataModel_8py_source.html#l00001">DataModel.py:1</a></div></div>
<div class="ttc" id="anamespacedastgen2_1_1attributes_1_1Double_html"><div class="ttname"><a href="../../d7/d6e/namespacedastgen2_1_1attributes_1_1Double.html">dastgen2.attributes.Double</a></div><div class="ttdef"><b>Definition</b> <a href="../../da/df9/Double_8py_source.html#l00001">Double.py:1</a></div></div>
<div class="ttc" id="anamespacedastgen2_1_1attributes_html"><div class="ttname"><a href="../../d6/ddd/namespacedastgen2_1_1attributes.html">dastgen2.attributes</a></div><div class="ttdef"><b>Definition</b> <a href="../../d8/d78/python_2dastgen2_2attributes_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="anamespacedastgen2_html"><div class="ttname"><a href="../../d6/d7b/namespacedastgen2.html">dastgen2</a></div><div class="ttdef"><b>Definition</b> <a href="../../df/dd5/python_2dastgen2_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
</div><!-- fragment --><p>you create for example a C++ class of the name MyClass which hosts one double attribute. Study the objects available in <a class="el" href="../../d6/ddd/namespacedastgen2_1_1attributes.html">dastgen2.attributes</a>.</p>
<p>Peano has some attributes of its own. They are specialisations/replacements of the native C++/DaStGen objects which use Peano-specific features. If you add</p>
<div class="fragment"><div class="line">my_model.add_attribute( <a class="code hl_namespace" href="../../d6/d7b/namespacedastgen2.html">dastgen2</a>.<a class="code hl_namespace" href="../../d6/ddd/namespacedastgen2_1_1attributes.html">attributes</a>.<a class="code hl_namespace" href="../../d3/d01/namespacedastgen2_1_1attributes_1_1DoubleArray.html">DoubleArray</a>(<span class="stringliteral">&quot;myArray1&quot;</span>, <span class="stringliteral">&quot;14&quot;</span>) )</div>
<div class="line">my_model.add_attribute( <a class="code hl_namespace" href="../../d8/d8f/namespacepeano4.html">peano4</a>.<a class="code hl_namespace" href="../../da/d51/namespacepeano4_1_1dastgen2.html">dastgen2</a>.<a class="code hl_namespace" href="../../da/dfe/namespacepeano4_1_1dastgen2_1_1Peano4DoubleArray.html">Peano4DoubleArray</a>(<span class="stringliteral">&quot;myArray2&quot;</span>, <span class="stringliteral">&quot;14&quot;</span>))</div>
<div class="ttc" id="anamespacedastgen2_1_1attributes_1_1DoubleArray_html"><div class="ttname"><a href="../../d3/d01/namespacedastgen2_1_1attributes_1_1DoubleArray.html">dastgen2.attributes.DoubleArray</a></div><div class="ttdef"><b>Definition</b> <a href="../../df/d38/DoubleArray_8py_source.html#l00001">DoubleArray.py:1</a></div></div>
<div class="ttc" id="anamespacepeano4_1_1dastgen2_1_1Peano4DoubleArray_html"><div class="ttname"><a href="../../da/dfe/namespacepeano4_1_1dastgen2_1_1Peano4DoubleArray.html">peano4.dastgen2.Peano4DoubleArray</a></div><div class="ttdef"><b>Definition</b> <a href="../../da/dfe/Peano4DoubleArray_8py_source.html#l00001">Peano4DoubleArray.py:1</a></div></div>
<div class="ttc" id="anamespacepeano4_1_1dastgen2_html"><div class="ttname"><a href="../../da/d51/namespacepeano4_1_1dastgen2.html">peano4.dastgen2</a></div><div class="ttdef"><b>Definition</b> <a href="../../da/d59/python_2peano4_2dastgen2_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="anamespacepeano4_html"><div class="ttname"><a href="../../d8/d8f/namespacepeano4.html">peano4</a></div><div class="ttdef"><b>Definition</b> <a href="../../df/d17/CellMarker_8h_source.html#l00014">CellMarker.h:14</a></div></div>
</div><!-- fragment --><p>you get two double arrays of size 14. In the fist case, the attribute will be mapped onto a plain C++ array. The second attribute, myArray2, however will be mapped onto a <a class="el" href="../../d7/d26/structtarch_1_1la_1_1Vector.html" title="Simple vector class.">tarch::la::Vector</a> of size 14, i.e. use Peano's built-in technical architecture.</p>
<h1><a class="anchor" id="autotoc_md834"></a>
Aspects</h1>
<p>Peano usually adds the peano4.dastgen2.MPIAndStorage aspect to most of its storage classes. Most solvers, particle models, ... provide factory methods to create a DaStGen2 model. The returned object then host the right aspects already. You can nevertheless add further aspects.</p>
<h1><a class="anchor" id="autotoc_md835"></a>
Aggressive vectorisation</h1>
<p>Most compilers need aggressive inlining before they can start to vectorise. Inlining is - without IPO - only possible if the setters and getters are all in the header, i.e. if they are exposed. DaStGen by default produces clean C++ code with a clear separation of headers and implementation. If you want the tool to abandon that principle, you have to set the expose_in_header flag for your attributes.</p>
<p>If you want this to happen for all attributes, call dastgen2.DataModel.expose_all_attributes_in_header_file(). The routine runs over all attributes and sets the expose flag.</p>
<p>I do not make expose the default, as we know that all-in-the-header code typically produces vast executables and long compilation time. For a lot of routines, it is also not required, and for GPUs it seems not to play a role anyway, as you can always inline later via IPO. Finally, we hope for IPO to become, on the long term, universally supported everywhere such that we can return to a clear separation of declaration and definition. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:03 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
