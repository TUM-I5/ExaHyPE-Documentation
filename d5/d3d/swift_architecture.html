<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d5/d3d/swift_architecture.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Architecture</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Swift 2 extension consist of two ingredients: a Python-API and a set of C++ tools. The C++ tools use Peano's tarch and the particles toolbox. Overall, the Swift extension follows the <a class="el" href="../../db/d3f/page_architecture_home.html">blueprint of Peano's application architecture</a>.</p>
<h1><a class="anchor" id="autotoc_md1080"></a>
Abstraction levels</h1>
<p>At the highest point of the code, i.e. the thing that users see, there is a project which hosts particles. Each particle is an instantiation of a particular numerical schemes. Each numerical scheme defines a sequence of steps for the particle. Maybe the simples example for such a sequence of steps can be found in swift2.particle.ExplicitEulerFixedInteraction Radius. As summarise: the user models the simulation as a project (which hosts information such as "which timespan do I want to simulate") which hosts one or multiple particles, where each particle defines a strict sequence of steps.</p>
<p>Users can now inject their actual physics (interaction forces, e.g.) by injecting source code into the particle. Injecting means typically that users say "use this code snippet to compute the force between two particles".</p>
<p>Once this first step is complete, users invoke <a class="el" href="../../d6/d70/namespaceswift2_1_1Project.html">swift2.Project</a>. This is where a lot of magic happens: A so-called graph compiler runs through the project with its particles and puzzles out</p>
<ul>
<li>how often we have to run through the mesh to realise the numerical schemes;</li>
<li>which of the injected code snippets has to be called by which traversal;</li>
<li>which of the compute steps can internally run in parallel (task-based parallelism).</li>
</ul>
<p>With this information, the project creates a straight Peano project which hosts the computational steps, all data and the action sets and observers.</p>
<div class="image">
<img src="../../architecture.png" alt=""/>
</div>
<p>The cartoon above tries to illustrate the core principle behind our code: The user here has created a project with one particle which implements an explicit Euler. Explicit Euler here means that the particle runs through three logical steps.</p>
<p>The graph compiler takes this specification and finds out that we have to employ two mesh traversals to realise this scheme. It therefore builds up a Peano project, where the mesh can handle the particles and which has two observers. Each observer has all the action sets which are required to administer the particles (such as sorting them), but that also hold the C++ code snippets that the user originally has added to the explicit Euler. So these code snippets are piped through and now inserted at the right point throughout the mesh traversal. After the graph generator has terminated, the Peano project also is provided with a main function which runs through the (two) steps over and over again - in the right order each invoking the right observer - until the terminal time is reached.</p>
<p>This Peano project finally is used to generate the actual C+ code which does not contain any Python anymore.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d8/d95/namespacepeano4_1_1solversteps_1_1ActionSet.html">peano4.solversteps.ActionSet</a> <a class="el" href="../../de/df3/CustomRiemann_8template_8h.html#a10aa502896b834c0d9eaeb3e8c8ab187">for</a> <a class="el" href="../../d0/de2/hydro__iact_8h.html#a8cbb00f59bca2c48d4560b23f07a4de2">a</a> description of action sets from <a class="el" href="../../d0/de2/hydro__iact_8h.html#a8cbb00f59bca2c48d4560b23f07a4de2">a</a> user perspective</dd></dl>
<h1><a class="anchor" id="autotoc_md1081"></a>
Particle storage and sorting</h1>
<p>Particles are held within the mesh in their closest persistent aka non-hanging vertex. They can also be distributed among the different levels. We call this storage scheme also dual tree storage. That is, the compute kernels can always assume that particles are held in a consistent way, i.e. at the right mesh level at the right vertex. The details can be found in peano4.toolbox.particles.AbstractUpdateParticleGridAssociation.</p>
<p>If a computational step in a computational scheme alters the particle positions or their interaction radius, it is the graph compiler's job to ensure that a resorting is triggered in the next grid sweep. Along the same lines, any resorting should again trigger an adaptive remeshing, as the mesh structure typically follows the particle distribution. The latter is realised by adding the action set <a class="el" href="../../d3/d08/namespacepeano4_1_1toolbox_1_1particles_1_1ParticleAMR.html">peano4.toolbox.particles.ParticleAMR</a> to the relevant computational steps.</p>
<h1><a class="anchor" id="autotoc_md1082"></a>
Particle-particle interaction</h1>
<p>All particle modifications are realised through mesh traversals. That is, an observer runs through the mesh. Whenever it observes a relevant action (such as "hey, I've touched this vertex with its particles for the first time"), the observer runs through all the action sets that are associated with it and calls the respective functions. In the case above, this would be touchVertexFirstTime().</p>
<p>It is important to note that Peano's mesh traversals result from top-down tree traversals always. This allows us to realise particle-particle interactions via simple definitions of so-called active and local particle sets. Details on this can be found in <a class="el" href="../../da/db6/namespacepeano4_1_1toolbox_1_1particles_1_1UpdateParticle__MultiLevelInteraction__Sets.html">peano4.toolbox.particles.UpdateParticle_MultiLevelInteraction_Sets</a> for example.</p>
<h1><a class="anchor" id="autotoc_md1083"></a>
Relation between particle's search radius, the AMR, and the neighbour searches/interactions</h1>
<ul>
<li>In SPH, particles interact with neighbor particles.</li>
<li>Each particle has a search radius which is the area where it can search for neighbours.</li>
<li>Peano's AMR tries to adopt the mesh such that <code>CELL_SIZE</code> is as small as possible everywhere, but still larger than twice the search radius. Particles can only access particles within the cell they themselves are located and a neighbour cell. So the particle's search radius guides the AMR.</li>
<li>The interaction radius is a physical quantity. You run over all particles within your current cell and any neighbouring cell and you look if they are closer than this interaction radius.</li>
</ul>
<p>In other words:</p><ul>
<li>Particles' search radius -&gt; guides AMR</li>
<li>Particles search within their own cell and neighbouring cells. Only particles closer than the physical interaction radius interact with each other.</li>
</ul>
<p>As long as the search radius is bigger than the interaction radius, the AMR will ensure that all particles within the interaction radius reside within a neighbouring cell.</p>
<p>If you decide to make the interaction radius bigger throughout the simulation, you have to check if the search radius still remains bigger. If not, particles within the interaction radius might be two cells away and you might miss them. So once you make the interaction radius bigger than the search radius, you have to reset the search radius and tell Peano to remesh and resort.</p>
<p>So the <code>CELL_SIZE</code> is chosen by Peano to accommodate the search radius <code>H</code>. The <code>H</code> is the area where particles can search for neighbours. Therefore, any particle-particle distance <code>r</code> <code>&lt;=</code> <code>H</code> is fine. If the <code>r</code> grows over time, you have to increase <code>H</code>. In this case, you however have to tell Peano to resort. Peano then might decide to trigger AMR and effectively change <code>CELL_SIZE</code>. So <code>CELL_SIZE</code> <code>&gt;=</code> 2<code>H</code> <code>&gt;=</code> 2<code>r</code> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d6/dba/page_swift2_home.html">Swift 2</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:06 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
