<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d3/d5f/tarch_tests.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Unit tests</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Peano introduces its own lightweight test concept with picks up best practices from the JUnit world. While it is simple and has no external dependencies (all test routines are collected within the <code>tarch</code> subdirectory), it provides a few macros to handle numeric data&mdash;which might be convenient for AMR applications; so there's some added value. It also provides test routines for vectors.</p>
<h2><a class="anchor" id="autotoc_md1181"></a>
Test architecture</h2>
<p>A Peano test is a class that implements and extends <a class="el" href="../../d5/d8e/classtarch_1_1tests_1_1TestCase.html" title="Represents one test case.">tarch::tests::TestCase</a>. By convention, I place my tests always into subdirectories/subnamespaces of the respective component, but this is not a must. A test class must implement a <code>void run()</code> method. This is the only convention. The Peano toolkit by default generates one (empty) test per project that can act as a blueprint if you don't want to write your test manually. Feel free to delete the class if you don't want to write unit tests on your own (though the test itself is empty and thus does not harm the test runs).</p>
<p>A proper test class should realise a couple of <code>void</code> operations without arguments that run the individual tests. A minimalistic test thus looks as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>myproject namespace <a class="code hl_namespace" href="../../d9/df4/namespacetests.html">tests</a> class TestCase;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>myproject::tests::TestCase : <span class="keyword">public</span> <a class="code hl_class" href="../../d5/d8e/classtarch_1_1tests_1_1TestCase.html">tarch::tests::TestCase</a> {</div>
<div class="line">  <span class="keyword">private</span>: </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_namespace" href="../../d2/d0a/namespacetest1.html">test1</a>(); </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_namespace" href="../../da/d47/namespacetest2.html">test2</a>(); </div>
<div class="line">  <span class="keyword">public</span>: </div>
<div class="line">    <a class="code hl_function" href="../../d5/d8e/classtarch_1_1tests_1_1TestCase.html#a74a50f48c8d902e063c94647d5a057d9">TestCase</a>(); </div>
<div class="line">    <span class="keyword">virtual</span> <a class="code hl_function" href="../../d5/d8e/classtarch_1_1tests_1_1TestCase.html#a0491a7ab979e452aacaa8abd9ce55466">~TestCase</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d5/d8e/classtarch_1_1tests_1_1TestCase.html#a89a48cb757104625eb04adce6a782158">run</a>() <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="ttc" id="aclasstarch_1_1tests_1_1TestCase_html"><div class="ttname"><a href="../../d5/d8e/classtarch_1_1tests_1_1TestCase.html">tarch::tests::TestCase</a></div><div class="ttdoc">Represents one test case.</div><div class="ttdef"><b>Definition</b> <a href="../../d5/dc6/TestCase_8h_source.html#l00057">TestCase.h:57</a></div></div>
<div class="ttc" id="aclasstarch_1_1tests_1_1TestCase_html_a0491a7ab979e452aacaa8abd9ce55466"><div class="ttname"><a href="../../d5/d8e/classtarch_1_1tests_1_1TestCase.html#a0491a7ab979e452aacaa8abd9ce55466">tarch::tests::TestCase::~TestCase</a></div><div class="ttdeci">virtual ~TestCase()</div><div class="ttdoc">Destructor.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d57/TestCase_8cpp_source.html#l00009">TestCase.cpp:9</a></div></div>
<div class="ttc" id="aclasstarch_1_1tests_1_1TestCase_html_a74a50f48c8d902e063c94647d5a057d9"><div class="ttname"><a href="../../d5/d8e/classtarch_1_1tests_1_1TestCase.html#a74a50f48c8d902e063c94647d5a057d9">tarch::tests::TestCase::TestCase</a></div><div class="ttdeci">TestCase()=delete</div></div>
<div class="ttc" id="aclasstarch_1_1tests_1_1TestCase_html_a89a48cb757104625eb04adce6a782158"><div class="ttname"><a href="../../d5/d8e/classtarch_1_1tests_1_1TestCase.html#a89a48cb757104625eb04adce6a782158">tarch::tests::TestCase::run</a></div><div class="ttdeci">virtual void run()=0</div><div class="ttdoc">This routine is triggered by the TestCaseCollection.</div></div>
<div class="ttc" id="anamespacetest1_html"><div class="ttname"><a href="../../d2/d0a/namespacetest1.html">test1</a></div><div class="ttdoc">This test checks that the DG solver leaves the input invariant if the RHS is constructed as b = A_DG ...</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da5/test1_8py_source.html#l00001">test1.py:1</a></div></div>
<div class="ttc" id="anamespacetest2_html"><div class="ttname"><a href="../../da/d47/namespacetest2.html">test2</a></div><div class="ttdoc">This test checks that the CG solver leaves the input invariant if the RHS is constructed as b_c = A_C...</div><div class="ttdef"><b>Definition</b> <a href="../../d6/de8/test2_8py_source.html#l00001">test2.py:1</a></div></div>
<div class="ttc" id="anamespacetests_html"><div class="ttname"><a href="../../d9/df4/namespacetests.html">tests</a></div><div class="ttdef"><b>Definition</b> <a href="../../d7/d14/tests_2multigrid_2matrixfree_2poisson_2Scenario_8h_source.html#l00008">Scenario.h:8</a></div></div>
</div><!-- fragment --><p>The test's <code>run</code> operation has to register the individual void routines running the actual tests:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> exahype::tests::TestCase::run() {</div>
<div class="line">  <a class="code hl_define" href="../../dc/d61/TestMacros_8h.html#a321d2883e56477558db3f31126b28b86">testMethod</a>(<a class="code hl_namespace" href="../../d2/d0a/namespacetest1.html">test1</a>);</div>
<div class="line">  <a class="code hl_define" href="../../dc/d61/TestMacros_8h.html#a321d2883e56477558db3f31126b28b86">testMethod</a>(<a class="code hl_namespace" href="../../da/d47/namespacetest2.html">test2</a>);</div>
<div class="line">}</div>
<div class="ttc" id="aTestMacros_8h_html_a321d2883e56477558db3f31126b28b86"><div class="ttname"><a href="../../dc/d61/TestMacros_8h.html#a321d2883e56477558db3f31126b28b86">testMethod</a></div><div class="ttdeci">#define testMethod(name)</div><div class="ttdoc">Run a test method and check for errors.</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d61/TestMacros_8h_source.html#l00024">TestMacros.h:24</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1182"></a>
Running the tests</h2>
<p>Once these steps are handled, you can run the tests within your <code>main</code>. For the core and tarch routines, I provide factory methods</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="../../da/d6a/namespacetarch.html#a090c6cb8e730a266ed1a2a8b11c99702">tarch::getUnitTests</a>(); </div>
<div class="line"><a class="code hl_function" href="../../d8/d8f/namespacepeano4.html#a3280be3718a894b8eff4fb301faa76a3">peano4::getUnitTests</a>();</div>
<div class="ttc" id="anamespacepeano4_html_a3280be3718a894b8eff4fb301faa76a3"><div class="ttname"><a href="../../d8/d8f/namespacepeano4.html#a3280be3718a894b8eff4fb301faa76a3">peano4::getUnitTests</a></div><div class="ttdeci">tarch::tests::TestCase * getUnitTests()</div><div class="ttdoc">Please destroy after usage.</div><div class="ttdef"><b>Definition</b> <a href="../../da/d63/peano4_2UnitTests_8cpp_source.html#l00013">UnitTests.cpp:13</a></div></div>
<div class="ttc" id="anamespacetarch_html_a090c6cb8e730a266ed1a2a8b11c99702"><div class="ttname"><a href="../../da/d6a/namespacetarch.html#a090c6cb8e730a266ed1a2a8b11c99702">tarch::getUnitTests</a></div><div class="ttdeci">tarch::tests::TestCase * getUnitTests()</div><div class="ttdoc">Please destroy after usage.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d42/tarch_2UnitTests_8cpp_source.html#l00017">UnitTests.cpp:17</a></div></div>
</div><!-- fragment --><p>which deliver a test suite. To run them, I typically insert snippets alike</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> unitTestsErrors = 0; </div>
<div class="line"><a class="code hl_class" href="../../d5/d8e/classtarch_1_1tests_1_1TestCase.html">tarch::tests::TestCase</a>* <a class="code hl_namespace" href="../../d9/df4/namespacetests.html">tests</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_namespace" href="../../d9/df4/namespacetests.html">tests</a> = <a class="code hl_function" href="../../da/d6a/namespacetarch.html#a090c6cb8e730a266ed1a2a8b11c99702">tarch::getUnitTests</a>(); </div>
<div class="line"><a class="code hl_namespace" href="../../d9/df4/namespacetests.html">tests</a>-&gt;run(); </div>
<div class="line">unitTestsErrors += <a class="code hl_namespace" href="../../d9/df4/namespacetests.html">tests</a>-&gt;getNumberOfErrors(); </div>
<div class="line"><span class="keyword">delete</span> <a class="code hl_namespace" href="../../d9/df4/namespacetests.html">tests</a>;</div>
</div><!-- fragment --><p>into my main. It returns an output similar to</p>
<div class="fragment"><div class="line">running <a class="code hl_namespace" href="../../df/d04/namespacetest.html">test</a> <span class="keywordflow">case</span> collection <span class="stringliteral">&quot;exahype2.tests.c&quot;</span> ...... ok </div>
<div class="line">running <a class="code hl_namespace" href="../../df/d04/namespacetest.html">test</a> <span class="keywordflow">case</span> collection \<span class="stringliteral">&quot;exahype2.tests.solvers\&quot; .. ok running test case</span></div>
<div class="line"><span class="stringliteral">collection \&quot;exahype2.tests\&quot; \.... ok running test case collection</span></div>
<div class="line"><span class="stringliteral">\&quot;peano4.grid.tests\&quot; \...\...\...\...\...\..... ok running test case</span></div>
<div class="line"><span class="stringliteral">collection \&quot;peano4.grid\&quot; ok running test case collection</span></div>
<div class="line"><span class="stringliteral">\&quot;peano4.heap.tests\&quot; .. ok running test case collection \&quot;peano4.heap\&quot;</span></div>
<div class="line"><span class="stringliteral">ok running test case collection \&quot;peano4\&quot; ok running test case</span></div>
<div class="line"><span class="stringliteral">collection \&quot;tarch\&quot; ok running global test case collection ok</span></div>
<div class="ttc" id="anamespacetest_html"><div class="ttname"><a href="../../df/d04/namespacetest.html">test</a></div><div class="ttdef"><b>Definition</b> <a href="../../df/dba/test_8py_source.html#l00001">test.py:1</a></div></div>
</div><!-- fragment --><p>The output returns a hierarchical overview over all tests ran. The number of dots per package identifies the number of actual test functions in a namespace. If tests fail, the interface reports the exact location including file name and line number.</p>
<p>It is convenient to run tests only if you have translated your code with a <a class="el" href="../../d1/d9e/tarch_logging.html">sufficient debug level</a>. When you write your own tests, I often add test attributes to the classes&mdash;fields that are not required but help me to validate object states. Since I protect these attributes with ifdefs reading Peano's debug level, they are removed from the production code.</p>
<h2><a class="anchor" id="autotoc_md1183"></a>
Test routines</h2>
<p>A typical unit tests builds up some classes, befills them with data, invokes some operations and finally checks the class state via some getters or routines returning results. Peano's way to do the actual tests are <code>validate</code> macros. You find all these macros in the file <a class="el" href="../../dc/d61/TestMacros_8h.html">tarch/tests/TestMacros.h</a>. There are three classes of macros:</p>
<ul>
<li>Standard validation macros similar to assertions that test a boolean condition.</li>
<li>Comparison macros that compare two values through the <code>operator==</code> (which might be overloaded).</li>
<li>Comparison macros that compare doubles, vectors or matrices numerically, i.e. up to a prescribed precision.</li>
</ul>
<p>All of these macros come along with variants that allow you to plot additional information if a test has failed, i.e. to plot the values of further variables, e.g. All validation macros automatically set a test to failed if they fail, and they write a verbose message on the reason why some tests failed to the terminal.</p>
<p>Tests tend to become spaghetti code and some of them are very expensive to translate as the compiler's optimiser has a hard time to translate the long code fragments. I thus recommend to insert</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../da/d5d/CompilerSpecificSettings_8h.html">tarch/CompilerSpecificSettings.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef UseTestSpecificCompilerSettings </span></div>
<div class="line"><span class="preprocessor">#pragma optimize(&quot;&quot;, off)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// All the implementation</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef UseTestSpecificCompilerSettings </span></div>
<div class="line"><span class="preprocessor">#pragma optimize(&quot;&quot;, on)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="ttc" id="aCompilerSpecificSettings_8h_html"><div class="ttname"><a href="../../da/d5d/CompilerSpecificSettings_8h.html">CompilerSpecificSettings.h</a></div></div>
</div><!-- fragment --><p>into your implementation file around all your code. This switches off all optimisation explicitly for the tests. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../dd/d46/page_tarch_home.html">Technical Architecture (tarch)</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:06 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
