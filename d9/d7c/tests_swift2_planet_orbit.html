<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d9/d7c/tests_swift2_planet_orbit.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Planet orbit</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This standard test case is used to assess the adaptive mesh refinement and to illustrate the importance of a symplectic time integrator. The setup simulates the Earth rotating around the Sun. So we actually have only one (free) particle with a hard-coded force function. The realisation is subject of a <a class="el" href="../../d3/da0/tutorials_swift2_planet_orbit.html">tutorial session</a> which demonstrates how to inject user-defined force functions into the default Euler and leapfrog ODE integrators.</p>
<div class="image">
<img src="../../two-particles-00.png" alt=""/>
</div>
<h1><a class="anchor" id="autotoc_md741"></a>
Run example benchmark</h1>
<p>Usage is relatively straightforward</p>
<div class="fragment"><div class="line"><span class="keyword">export</span> PYTHONPATH=../../../python</div>
<div class="line">python3 planet-orbit.py --time-integrator <a class="code hl_namespace" href="../../d5/d60/namespaceeuler.html">euler</a> -et 5.0 -cs 0.4 -<a class="code hl_namespace" href="../../de/d73/namespaceplot.html">plot</a> 0.01</div>
<div class="ttc" id="anamespaceeuler_html"><div class="ttname"><a href="../../d5/d60/namespaceeuler.html">euler</a></div><div class="ttdef"><b>Definition</b> <a href="../../d1/de0/tutorials_2exahype2_2symhype_2euler_2euler_8py_source.html#l00001">euler.py:1</a></div></div>
<div class="ttc" id="anamespaceplot_html"><div class="ttname"><a href="../../de/d73/namespaceplot.html">plot</a></div><div class="ttdoc">-lift-drop-statistics</div></div>
</div><!-- fragment --><p>The code spills out a series of vtu files for the particles including one pvd file that serves as overview/meta file. You can load this one straight into Paraview, e.g. The grid visualisation requires a separate postprocessing step before you can visualise it as native file. Please note that the snippet above uses an explicit Euler which is not capable to reproduce a stationary orbit, as it is a non-symplectic time integrator.</p>
<p>Depending on the mesh size, you get different AMR levels. I extract them into a table below, but it actually makes more sense to study the README-orbit-xxx.md file that the Python script produces. It provides all the essential information per experiment.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Cell size   </th><th class="markdownTableHeadNone">Levels   </th><th class="markdownTableHeadNone">Remarks    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.4   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Regular 81x81 mesh. No dynamic adaptivity (default).    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.1   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Around 234 mesh cells with one level of adaptivity.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.03   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Two levels of adaptivity. The number of mesh cells starts to change almost every time step.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.01   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">More radical version with three levels of adaptive mesh refinement.   </td></tr>
</table>
<p>Swift's AMR analysis works on a per-cell basis. For each cell, it studies all four adjacent vertices, and sums up the number of particles stored there. As we set the maximum number of particles to 0, every cell that is adjacent to a vertex holding the single particle will issue a refine command</p><ul>
<li>unless the cell is already refined down to the minimum mesh size.</li>
</ul>
<p>To run the test, you can either follow the instructions below one by one (which allows you to tailor some settings), or you run the ./run.sh script from the test's directory. This script will automatically invoke the postprocessing, too. Please note that the run script builds the executables in assert mode, i.e. it ensures that there are no runtime errors.</p>
<h1><a class="anchor" id="autotoc_md742"></a>
Visualise resulting mesh</h1>
<p>I recommend to use the Python Paraview variant to convert the <a class="el" href="../../df/d47/documentation_tarch_visualisation.html">arising mesh files</a> into something you can visualise straightforwardly.</p>
<div class="fragment"><div class="line">/opt/paraview/bin/pvpython ../../../python/<a class="code hl_namespace" href="../../d8/d8f/namespacepeano4.html">peano4</a>/visualisation/render.py --filter-fine-grid grid.peano-patch-file</div>
<div class="ttc" id="anamespacepeano4_html"><div class="ttname"><a href="../../d8/d8f/namespacepeano4.html">peano4</a></div><div class="ttdef"><b>Definition</b> <a href="../../df/d17/CellMarker_8h_source.html#l00014">CellMarker.h:14</a></div></div>
</div><!-- fragment --><div class="image">
<img src="../../two-particles-01.png" alt=""/>
</div>
 <div class="image">
<img src="../../two-particles-02.png" alt=""/>
</div>
<h1><a class="anchor" id="autotoc_md743"></a>
Postprocess trajectories and produce statistics</h1>
<p>The test is supplemented with a Python script which assesses the energy conservation and yields some overview plots. The script assumes that you did dump some output data into the current directory.</p>
<p>python3 ./plots-time-integration-test.py</p>
<p>It should create some global stats as well as a plot of the energy over time:</p>
<div class="image">
<img src="../../energy_conservation_profile.png" alt=""/>
</div>
<p>Please note that the script currently works only for a serial run. The plot above stems from a parallel experiment and hence shows a lot of gaps.</p>
<h1><a class="anchor" id="autotoc_md744"></a>
Clean up</h1>
<p>The instruction snippets below clean up the majority of the file spilled out by this benchmark. All files that are essential to rerun the benchmark and are stored in the repo are kept:</p>
<div class="fragment"><div class="line">rm *patch-file *.vtu *.pvd *.o *.bak *.cmake</div>
<div class="line">rm -rf celldata globaldata observers repositories vertexdata</div>
<div class="line">rm Constants.h planetorbit-<a class="code hl_function" href="../../d4/d76/benchmarks_2other_2noh2d_2main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>* Makefile *.md</div>
<div class="ttc" id="abenchmarks_2other_2noh2d_2main_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="../../d4/d76/benchmarks_2other_2noh2d_2main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d76/benchmarks_2other_2noh2d_2main_8cpp_source.html#l00321">main.cpp:321</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md745"></a>
A sample script using the test case/tutorial code</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#!/bin/sh</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Script to run experiment</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Parameters</span></div>
<div class="line">END_TIME=0.5</div>
<div class="line">CELL_SIZE=0.4</div>
<div class="line">PLOT_DELTA=0.1</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Run python script to generate the experiment</span></div>
<div class="line">python3 planet-orbit.py -integrator leapfrog -et=$END_TIME -cs=$CELL_SIZE -<a class="code hl_namespace" href="../../de/d73/namespaceplot.html">plot</a>=$PLOT_DELTA</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># set threads number</span></div>
<div class="line"><span class="keyword">export</span> OMP_NUM_THREADS=1</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># run experiment</span></div>
<div class="line">echo <span class="stringliteral">&#39;running experiment...&#39;</span></div>
<div class="line">./orbit-$CELL_SIZE &gt; output.txt</div>
<div class="line">echo <span class="stringliteral">&#39;post-processing results...&#39;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># generate Peano grid for Paraview</span></div>
<div class="line">pvpython ../../../python/<a class="code hl_namespace" href="../../d8/d8f/namespacepeano4.html">peano4</a>/visualisation/render.py grid.peano-patch-file</div>
<div class="line"> </div>
<div class="line">DIRNAME=<span class="stringliteral">&quot;output_&quot;</span>$CELL_SIZE</div>
<div class="line"><span class="keywordflow">if</span> [ -d $DIRNAME ]</div>
<div class="line">then</div>
<div class="line">    rm -<a class="code hl_variable" href="../../d0/de2/hydro__iact_8h.html#a9275d161581a75241fbf34397c38c58e">r</a> $DIRNAME</div>
<div class="line">fi</div>
<div class="line">mkdir $DIRNAME</div>
<div class="line">mv output.txt $DIRNAME</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Save file with parameters and metadata</span></div>
<div class="line">less Constants.h &gt; Constants.txt &amp;&amp; mv Constants.txt $DIRNAME</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Save snapshots</span></div>
<div class="line">mkdir $DIRNAME<span class="stringliteral">&quot;/snapshots/&quot;</span></div>
<div class="line">mv particles* grid* $DIRNAME<span class="stringliteral">&quot;/snapshots/&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Save other data, if any</span></div>
<div class="line"><span class="keywordflow">if</span> [ -e *.cvs ]</div>
<div class="line">then</div>
<div class="line">    mv *.cvs $DIRNAME</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">echo <span class="stringliteral">&#39;Done. Bye!&#39;</span></div>
<div class="ttc" id="ahydro__iact_8h_html_a9275d161581a75241fbf34397c38c58e"><div class="ttname"><a href="../../d0/de2/hydro__iact_8h.html#a9275d161581a75241fbf34397c38c58e">r</a></div><div class="ttdeci">const float r</div><div class="ttdef"><b>Definition</b> <a href="../../d0/de2/hydro__iact_8h_source.html#l00068">hydro_iact.h:68</a></div></div>
</div><!-- fragment --><p>tests_swift2_planet-orbit_plots-time-integration-test </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d6/dba/page_swift2_home.html">Swift 2</a></li><li class="navelem"><a class="el" href="../../d9/d95/swift_tests.html">Tests</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:02 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
