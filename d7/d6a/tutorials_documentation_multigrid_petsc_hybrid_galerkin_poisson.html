<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d7/d6a/tutorials_documentation_multigrid_petsc_hybrid_galerkin_poisson.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Hybrid Galerkin for the Poisson equation with PETSc</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A brief, informal discussion of hybrid DG methods plus some examples how to solve such equations.</p>
<p>This is a brief discussion of key ideas behind the Hybrid Discontinuous Galerkin (DG) method. While we discuss some of the mathematics behind hybridised DG, the focus of this text is informal (from a maths point of view) but puts special emphasis on how numerical concepts are mapped onto Peano's data structures and mesh traversal.</p>
<p>Before we dive into details, it is important to study Discontinous Galerkin methods first, as we generalise some ideas from there. We onte that it is reasonable to skip the Poisson equation example - our all-time classic - for this particular method, as the advection problem is easier to digest.</p>
<h1><a class="anchor" id="autotoc_md643"></a>
Method</h1>
<p>Whenever we follow the the mixed Galerkin formulation or even the basic DG workflow, we end up with the integrals over faces.</p>
<p>Let</p>
<p>\(
\lambda_u := u|_\text{face} \qquad \text{and} \qquad \lambda_\phi := n \cdot \phi |_\text{face}
\)</p>
<p>denote the additional variables that "to not exist" on the face, as there is a left and a right value at every face where two different cells meet We don't know which to pick under the integral a priori. Here our \( \lambda_u \) is just our solution u, but evaluated on the face. Since we have a jump, this means that we have a different value depending on which cell we are considering. Obviously, this example fits to Poisson. If you have another <a class="el" href="../../da/db8/namespacePDE.html">PDE</a> (and another number of unknowns per cell dof \( K \)), you will get more or fewer \( \lambda \) values. To obtain each of these \( \lambda \)s, we have to solve the underlying Riemann problem, i.e. map the jump onto some quantity.</p>
<p>Previously, we took the average e.g. to come up with a meaningful value. The Riemann solver was an explicit function from \( (u^+,u^-) \mapsto \hat u \). In the hybrid mindset, we allow the function to be arbitrary complex, i.e. to follow its own rules. Still, it will depend on \( (u^+,u^-) \) (and other quantities) somehow, but we can interpret it to be free. Further to that, we can couple the individual entries on the face, i.e. make them depend upon each other. In the context of CG vs. DG in the mixed formulation, we clarified that it is not a good idea to pick the functions from spaces which are not compatible; notably to pick the derivative space in a way that it cannot represent the jumps et al in the derivatives. Hybrid DG goes one step further and ensures within the Riemann solver that the outcomes are somehow consistent.</p>
<p>A popular choice for the "free" variables is to allow the code to pick the quantities freely, as long as the jumps between the \( \phi \) along the normals disappear weakly:</p>
<p>\(
  \int _{face} \underbrace{[[ (n,\phi) ]]}_{:= \lambda _\phi} \cdot v _f dS(x) = 0 \quad \forall \quad v_f
\)</p>
<p>This \( \lambda _\phi\) is now really an additional degree of freedom which we obtain by solving a new equation system. This equation system is represented by the face-to-face matrix.</p>
<h1><a class="anchor" id="autotoc_md644"></a>
Example: the Poisson equation</h1>
<p>We assume that we know the \( \lambda _u \) (which other manuscript also call \( \hat{u} \)) somehow. If so, we can evaluate</p>
<p>\(
  \int _{\partial \text{cell}_{v _u}}  \lambda _u \cdot (n, v _u) dS(x)
\)</p>
<p>within the face-to-cell projection. Furthermore, we fix a magic constant \( \gamma &gt; 0 \) and enforce</p>
<p class="formulaDsp">
\begin{eqnarray*}
 \lambda _\phi &amp; := &amp; [[ (n,\phi) ]] + \gamma \left( [[u]] - \lambda _u \right) \\
   &amp; = &amp; \frac{1}{2} (n,\phi)^+ + \frac{1}{2} (n,\phi)^- + \frac{\gamma}{2} u^+ + \frac{\gamma}{2} u^- - \gamma \cdot \lambda _u.
\end{eqnarray*}
</p>
<p>In this equation, the normal is fixed as pointing parallel to the coordinate axis with axis-aligned cubes/squares serving as finite element cells. This means, the very moment we have computed \( \lambda _u \), we can derive \( \lambda _\phi \) and throw the face integrals back into the cells. All that is left now is a rule how to determine this \( \lambda _u \).</p>
<p>In HDG, the \( \lambda _u \) is really an additional degree of freedom, not just a mere average of the \( u \)s. The \( \lambda _\phi \) which we restrict later into the cell in contrast remains a helper variable, which results directly from other quantities. HDG's idea is that we allow the code to pick this \( \lambda _u \) quite freely, as long as the jumps between the \( \phi \) along the normals disappear weakly:</p>
<p class="formulaDsp">
\begin{eqnarray*}
  \int _{face} [[ (n,\phi) ]] \cdot \psi _f dS(x) &amp; = &amp; 0 \quad \forall \quad \psi _f
  \\
  \Rightarrow
  \int _{face} \lambda _u \cdot \psi _f dS(x) &amp; = &amp; \int _{face} \frac{1}{2} \left( \frac{1}{\gamma} (n,\phi)^+ + \frac{1}{\gamma} (n,\phi)^- + u^+ + u^- \right) \psi _f dS(x) \quad \forall \quad \psi _f.
\end{eqnarray*}
</p>
<p>Hence, the \( \lambda \) is now really an additional degree of freedom which we obtain by solving a new equation system. This equation system is represented by the face-to-face matrix.</p>
<p class="formulaDsp">
\begin{eqnarray*}
  \int _{face} [[ (n,\phi) ]] \cdot \psi _f dS(x) &amp; = &amp; 0 \quad \forall \quad \psi _f
  \\
  \Rightarrow
  \int _{face} \lambda _u \cdot \psi _f dS(x) &amp; = &amp; \int _{face} \frac{1}{2} \left( \frac{1}{\gamma} (n,\phi)^+ + \frac{1}{\gamma} (n,\phi)^- + u^+ + u^- \right) \psi _f dS(x) \quad \forall \quad \psi _f.
\end{eqnarray*}
</p>
<p>Hence, the \( \lambda \) is now really an additional degree of freedom which we obtain by solving a new equation system. This equation system is represented by the face-to-face matrix.</p>
<p>The rationale behind the construction of \( \lambda _u \) is not too difficult:</p>
<ul>
<li>We can pick it \( \lambda _u \) arbitrarily, but we want the jump in \( (n,\phi) \) to disappear weakly.</li>
<li>Note that the \( (n,\phi) \) represents the derivative of \( u \) along the normal. What we therefore really want is that this derivative does not jump around, i.e. the solution should not kink and be relatively smooth as we cross a face.</li>
<li>The \( (n,\phi) \) at the face is obviously a value somewhere in-between the gradient of \( u \) from the left and the right. By default, we just take the average of the \( (n,\phi) \).</li>
<li>However, this new \( \lambda _u \) somehow also determines how the kink behaves. If it equals the average of the solution left and right, then using the average of \( (n,\phi) \) alone yields a reasonable estimate for \( [[(n,\phi)]] \).</li>
</ul>
<p>My argument goes as follows: If we walk from the left cell to the right, then the average gradient in the sketch</p>
<div class="image">
<img src="../../average_gradient.png" alt=""/>
</div>
<p>is the average of two blue lines. However, if we do an intermediate step into some \( \lambda _u \) which is very high (higher than any blue line), then we have afterwards to step down onto the blue line again. The average derivative appears to be smaller than the average of the blue lines. How much effect the jump has compared to the change from left to right derivative is controlled via \( \gamma \).</p>
<p>Different to the Discontinous Galerkin formulation where we solve the Riemann problem manually, we have fewer degrees of freedom to be stored per face. If we solve the Riemann problem, we manually derive equations for \( \lambda _u \) and \( \lambda _\phi \), and these "outcomes" can be different left and right of the face. This time, we do not manually derive anything and therefore stick to </p><pre class="fragment">    unknowns_per_face_dof = 2
</pre><p> for the Poisson equation. The two helper qualities are used to store the projections of the solution or the normal of the gradient onto the face.</p>
<p>Once we pick a hybridised mixed solver, the solver will add an additional \( \hat K \cdot (p+1)^{d-1} \) quantities to each face, where the \( \hat K \) is also referred to as </p><pre class="fragment">    hybrid_formulation_unknowns_per_face_dof = 1
</pre><p> We set it to one here, as we always discuss the Poisson equation. The operators passed in therefore change:</p>
<ul>
<li>cell-to-cell remains exactly the same as in the mixed formulation. Nothing has changed here.</li>
<li>cell-to-face remains exactly the same as in the mixed formulation. Nothing has changed here.</li>
<li>face-to-face becomes a \( \mathbb{R}^{ \hat K \cdot (p+1)^{d-1} \times \hat K \cdot (p+1)^{d-1} } \) matrix. It describes how the additional hybrid formulation unknowns interact.</li>
<li>face-to-cell changes dimensions compared to the plain mixed formulation. It is now from \( \mathbb{R}^{ K \cdot (p+1)^d \times \hat K \cdot (p+1)^{d-1} } \), i.e. describes how the outcome of the additioanl equation system (over \( \lambda _u \) in the example above) is mapped onto the cell data.</li>
<li>There is a new operator face-to-rhs which takes the projections and maps them onto the right-hand side of the additional equation system.</li>
</ul>
<p>The distinction between an explicit cell-to-face projection of the solution and the face-to-rhs is convenient, as the construction of the right-hand side might use the projection from left and right and might, in the future, not be linear. This means, that we first have to project the solution and then use it to construct the right-hand side.</p>
<h1><a class="anchor" id="autotoc_md645"></a>
Example: the advection equation</h1>
<h1><a class="anchor" id="autotoc_md646"></a>
Realisation with PETSc</h1>
<p>If we implement the scheme above for Poisson, we end up with a code similar to</p>
<div class="fragment"><div class="line">solver = <a class="code hl_namespace" href="../../dc/d24/namespacepetsc.html">petsc</a>.solvers.DiscontinuousGalerkinDiscretisation(<span class="stringliteral">&quot;Poisson&quot;</span>,</div>
<div class="line">                                    degree = 1,</div>
<div class="line">                                    unknowns_per_cell_dof = 3, </div>
<div class="line">                                    unknowns_per_face_dof = 2, </div>
<div class="line">                                    hybrid_formulation_unknowns_per_face_dof = 1,</div>
<div class="line">                                    [...]</div>
<div class="line">                                    args.meshsize,</div>
<div class="line">                                    args.meshsize,</div>
<div class="line">                                    dimensions = 2,</div>
<div class="line">                                    [...]</div>
<div class="line">                                    )</div>
<div class="ttc" id="anamespacepetsc_html"><div class="ttname"><a href="../../dc/d24/namespacepetsc.html">petsc</a></div><div class="ttdef"><b>Definition</b> <a href="../../db/d10/LinearEquationSystem_8h_source.html#l00019">LinearEquationSystem.h:19</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md647"></a>
Data storage</h2>
<p>The setup above</p>
<ul>
<li>allocates 12 doubles per cell, which hold the solution. We need this to visualise the outcome.</li>
<li>allocates 12 doubles per cell, which hold the right hand side within the degrees of freedom. This information will later be used to construct the RHS \( b \) of the linear equation system.</li>
<li>constructs the matrix \( A \) (eventually we will work with an augmented system. For the time being, we can assume that it is square with \( 12 \mathbb{C} \)) rows.</li>
<li><p class="startli">assign each unknown a global index. Since we have 12 unknowns per cell, it is sufficient to store the first index of an unknown within the cell, as the dofs/unknowns within the cell are enumerated consecutively.</p>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000047">Todo</a></b></dt><dd>Continue to write</dd></dl>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md648"></a>
Operators</h1>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000048">Todo</a></b></dt><dd>Eike, Alex maybe you can assist here</dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d3/da3/page_multigrid_home.html">MGHyPE</a></li><li class="navelem"><a class="el" href="../../d4/d49/page_mghype_tutorials.html">Tutorials</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:29:00 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
