<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dc/dd1/MGCCZ4Kernels_8cpp_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">MGCCZ4Kernels.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="../../dc/dd1/MGCCZ4Kernels_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span> </div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="preprocessor">#include &quot;<a class="code" href="../../d5/d52/multicore_8h.html">tarch/multicore/multicore.h</a>&quot;</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#include &quot;<a class="code" href="../../d4/d57/MGCCZ4Kernels_8h.html">MGCCZ4Kernels.h</a>&quot;</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &quot;Constants.h&quot;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#if defined(GPUOffloadingOMP)</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#pragma omp declare target</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#endif</span></div>
<div class="foldopen" id="foldopen00016" data-start="{" data-end="}">
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno"><a class="line" href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a81806b17cd43f465a2530e67f8bd6f4d">   16</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a81806b17cd43f465a2530e67f8bd6f4d">examples::exahype2::mgccz4::enforceMGCCZ4constraints</a>(<span class="keywordtype">double</span> * luh)</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>{</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>    <span class="keywordtype">double</span> g_cov[3][3] = { {luh[0], luh[1], luh[2]}, {luh[1], luh[3], luh[4]}, {luh[2], luh[4], luh[5]} };</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> det = luh[0]*luh[3]*luh[5] - luh[0]*luh[4]*luh[4] - luh[1]*luh[1]*luh[5] + 2*luh[1]*luh[2]*luh[4] -luh[2]*luh[2]*luh[3];</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> phisq = 1./std::cbrt(det);</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) g_cov[i][j] *= phisq;</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> det2 = g_cov[0][0]*g_cov[1][1]*g_cov[2][2] -</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>        g_cov[0][0]*g_cov[1][2]*g_cov[2][1] - g_cov[1][0]*g_cov[0][1]*g_cov[2][2] +</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>        g_cov[1][0]*g_cov[0][2]*g_cov[2][1] + g_cov[2][0]*g_cov[0][1]*g_cov[1][2] -</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>        g_cov[2][0]*g_cov[0][2]*g_cov[1][1];</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> invdet = 1./det2;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> g_contr[3][3] = {</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>        { ( g_cov[1][1]*g_cov[2][2]-g_cov[1][2]*g_cov[2][1])*invdet, -(g_cov[0][1]*g_cov[2][2]-g_cov[0][2]*g_cov[2][1])*invdet, -(-g_cov[0][1]*g_cov[1][2]+g_cov[0][2]*g_cov[1][1])*invdet},</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>        {-( g_cov[1][0]*g_cov[2][2]-g_cov[1][2]*g_cov[2][0])*invdet,  (g_cov[0][0]*g_cov[2][2]-g_cov[0][2]*g_cov[2][0])*invdet, -( g_cov[0][0]*g_cov[1][2]-g_cov[0][2]*g_cov[1][0])*invdet},</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>        {-(-g_cov[1][0]*g_cov[2][1]+g_cov[1][1]*g_cov[2][0])*invdet, -(g_cov[0][0]*g_cov[2][1]-g_cov[0][1]*g_cov[2][0])*invdet,  ( g_cov[0][0]*g_cov[1][1]-g_cov[0][1]*g_cov[1][0])*invdet}</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    };</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    <span class="keywordtype">double</span> Aex[3][3] = { {luh[6], luh[7], luh[8]}, {luh[7], luh[9], luh[10]}, {luh[8], luh[10], luh[11]} };</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    <span class="keywordtype">double</span> traceA = 0;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) traceA += g_contr[i][j]*Aex[i][j];</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) Aex[i][j] -= 1./3. * traceA * g_cov[i][j];</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    luh[ 0] = g_cov[0][0];</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    luh[ 1] = g_cov[0][1];</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    luh[ 2] = g_cov[0][2];</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    luh[ 3] = g_cov[1][1];</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    luh[ 4] = g_cov[1][2];</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    luh[ 5] = g_cov[2][2];</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    luh[ 6] =   Aex[0][0];</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    luh[ 7] =   Aex[0][1];</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    luh[ 8] =   Aex[0][2];</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    luh[ 9] =   Aex[1][1];</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    luh[10] =   Aex[1][2];</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    luh[11] =   Aex[2][2];</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="comment">// As suggested by our PRD referee, we also enforce the algebraic constraint that results from the first spatial derivative of the constraint</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="comment">// det \tilde{\gamma}_ij = 0, which leads to</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    <span class="comment">// \tilde{\gamma}^{ij} D_kij = 0</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <span class="comment">// and is thus a condition of trace-freeness on all submatrices D_kij for k=1,2,3.</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <span class="keywordtype">double</span> DD[3][3][3] = {</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>        {{luh[35], luh[36], luh[37]}, {luh[36], luh[38], luh[39]}, {luh[37], luh[39], luh[40]}},</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>        {{luh[41], luh[42], luh[43]}, {luh[42], luh[44], luh[45]}, {luh[43], luh[45], luh[46]}},</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>        {{luh[47], luh[48], luh[49]}, {luh[48], luh[50], luh[51]}, {luh[49], luh[51], luh[52]}}</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    };</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span> </div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0;l&lt;3;l++)</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    {</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        <span class="keywordtype">double</span> traceDk = 0;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) traceDk += g_contr[i][j]*DD[l][i][j];</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span> </div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) DD[l][i][j] -= 1./3 * g_cov[i][j]*traceDk;</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    }</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    luh[35] = DD[0][0][0];</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    luh[36] = DD[0][0][1];</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    luh[37] = DD[0][0][2];</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    luh[38] = DD[0][1][1];</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    luh[39] = DD[0][1][2];</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    luh[40] = DD[0][2][2];</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span> </div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    luh[41] = DD[1][0][0];</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    luh[42] = DD[1][0][1];</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    luh[43] = DD[1][0][2];</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    luh[44] = DD[1][1][1];</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    luh[45] = DD[1][1][2];</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    luh[46] = DD[1][2][2];</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    luh[47] = DD[2][0][0];</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    luh[48] = DD[2][0][1];</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    luh[49] = DD[2][0][2];</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    luh[50] = DD[2][1][1];</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    luh[51] = DD[2][1][2];</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    luh[52] = DD[2][2][2];</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>}</div>
</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="preprocessor">#if defined(GPUOffloadingOMP)</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="preprocessor">#pragma omp end declare target</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="preprocessor">#if defined(GPUOffloadingOMP)</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="preprocessor">#pragma omp declare target</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="preprocessor">#endif</span></div>
<div class="foldopen" id="foldopen00112" data-start="{" data-end="}">
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno"><a class="line" href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a4ee993f178813cc3dee76e69ddd59c0d">  112</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a4ee993f178813cc3dee76e69ddd59c0d">examples::exahype2::mgccz4::source</a>(<span class="keywordtype">double</span>* S, <span class="keyword">const</span> <span class="keywordtype">double</span>* <span class="keyword">const</span> Q,</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> MGCCZ4LapseType,</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4ds,</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4c,</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4e,</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4f,</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4bs,</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4sk,</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4xi,</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4itau,</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4eta,</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4k1,</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4k2,</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4k3</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>      )</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>{</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> alpha = std::exp(std::fmax(-20., std::fmin(20.,Q[16])));</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <span class="comment">//printf(&quot;alpha %f\n&quot;,alpha);</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <span class="keywordtype">double</span> fa  = 1.0;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="keywordtype">double</span> faa = 0.0;</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <span class="keywordflow">if</span> (MGCCZ4LapseType==1)</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    {</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>      fa  =  2./alpha;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>      faa = -fa/alpha;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    }</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <span class="comment">// Note g_cov is symmetric</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> g_cov[3][3] = { {Q[0], Q[1], Q[2]}, {Q[1], Q[3], Q[4]}, {Q[2], Q[4], Q[5]} };</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> det = Q[0]*Q[3]*Q[5] - Q[0]*Q[4]*Q[4] - Q[1]*Q[1]*Q[5] + 2*Q[1]*Q[2]*Q[4] -Q[2]*Q[2]*Q[3];</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> invdet = 1./det;</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span> </div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> g_contr[3][3] = {</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        { ( Q[3]*Q[5]-Q[4]*Q[4])*invdet, -( Q[1]*Q[5]-Q[2]*Q[4])*invdet, -(-Q[1]*Q[4]+Q[2]*Q[3])*invdet},</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        {-( Q[1]*Q[5]-Q[4]*Q[2])*invdet,  ( Q[0]*Q[5]-Q[2]*Q[2])*invdet, -( Q[0]*Q[4]-Q[2]*Q[1])*invdet},</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        {-(-Q[1]*Q[4]+Q[3]*Q[2])*invdet, -( Q[0]*Q[4]-Q[1]*Q[2])*invdet,  ( Q[0]*Q[3]-Q[1]*Q[1])*invdet}</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    };</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <span class="comment">// NOTE Aex is symmetric</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="keywordtype">double</span> Aex[3][3] = { {Q[6], Q[7], Q[8]}, {Q[7], Q[9], Q[10]}, {Q[8], Q[10], Q[11]} };</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span> </div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="keywordtype">double</span> traceA = 0;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) traceA += g_contr[i][j]*Aex[i][j];</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span> </div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) Aex[i][j] -= 1./3. * traceA * g_cov[i][j];</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="comment">// Matrix multiplications Amix = matmul(g_contr, Aex) Aup  = matmul(g_contr, transpose(Amix))</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="keywordtype">double</span> Amix[3][3]={0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> = 0; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> &lt; 3; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>++) Amix[i][j] += g_contr[i][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>] * Aex[<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>][j];</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="keywordtype">double</span> Aup[3][3]={0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> = 0; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> &lt; 3; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>++) Aup[i][j] += g_contr[i][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>] * Amix[j][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>]; <span class="comment">// Note the transposition is in the indices</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> Theta = Q[12]; <span class="comment">// needed later</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> DD[3][3][3] = {</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>        {{Q[35], Q[36], Q[37]}, {Q[36], Q[38], Q[39]}, {Q[37], Q[39], Q[40]}},</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        {{Q[41], Q[42], Q[43]}, {Q[42], Q[44], Q[45]}, {Q[43], Q[45], Q[46]}},</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        {{Q[47], Q[48], Q[49]}, {Q[48], Q[50], Q[51]}, {Q[49], Q[51], Q[52]}}</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    };</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="keywordtype">double</span> dgup[3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++)</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dgup[k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l] -= 2.0*g_contr[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][n]*g_contr[j][l]*DD[k][n][j];</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> PP[3] = {Q[55], Q[56], Q[57]};</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <span class="keywordtype">double</span> Christoffel[3][3][3]       = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <span class="keywordtype">double</span> Christoffel_tilde[3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    {</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        Christoffel_tilde[i][j][k] += g_contr[k][l] * ( DD[i][j][l] + DD[j][i][l] - DD[l][i][j] );</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        Christoffel[i][j][k]       += g_contr[k][l] * ( DD[i][j][l] + DD[j][i][l] - DD[l][i][j] ) - g_contr[k][l] * ( g_cov[j][l] * PP[i] + g_cov[i][l] * PP[j] - g_cov[i][j] * PP[l] );</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    }</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="keywordtype">double</span> Gtilde[3] = {0,0,0};</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) Gtilde[i] += g_contr[j][l] * Christoffel_tilde[j][l][i];</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span> </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> Ghat[3] = {Q[13], Q[14], Q[15]};</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> phi = std::exp(std::fmax(-20., std::fmin(20.,Q[54])));</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> phi2 = phi*phi;</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span> </div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    <span class="keywordtype">double</span> <a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[3] = {0,0,0}; <span class="comment">// Matrix vector multiplications</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) <a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[i] += 0.5*MGCCZ4ds*( g_cov[i][j]* (Ghat[j] - Gtilde[j]));</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="keywordtype">double</span> Zup[3] = {0,0,0};</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) Zup[i] += phi2 * g_contr[i][j] * <a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[j];</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span> </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="keywordtype">double</span> dChristoffelSrc[3][3][3][3]       = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    <span class="keywordtype">double</span> dChristoffel_tildeSrc[3][3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    {</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>        dChristoffelSrc[k][i][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] +=     dgup[k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l]*(      DD[i][j][l]+      DD[j][i][l]-DD[l][i][j])</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>                                      -    dgup[k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l]*(g_cov[j][l]*PP[i]+g_cov[i][l]*PP[j]-g_cov[i][j]*PP[l])</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>                                      -2.0*g_contr[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l]*(DD[k][j][l]*PP[i]+DD[k][i][l]*PP[j]-DD[k][i][j]*PP[l]);</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>        dChristoffel_tildeSrc[k][i][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] += dgup[k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l]*(DD[i][j][l]+DD[j][i][l]-DD[l][i][j]);</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    }</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span> </div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    <span class="keywordtype">double</span> RiemannSrc[3][3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    {</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>      RiemannSrc[i][k][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] = dChristoffelSrc[k][i][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] - dChristoffelSrc[j][i][k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>];</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++) RiemannSrc[i][k][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] += Christoffel[i][j][l]*Christoffel[l][k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] - Christoffel[i][k][l]*Christoffel[l][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>];</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    }</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="keywordtype">double</span> RicciSrc[3][3] = {0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++)</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++) RicciSrc[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][n] += RiemannSrc[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l][n][l];</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    <span class="comment">// Here we directly compute the derivative of Gtilde from its original definition as contracted Christoffel symbol,</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    <span class="comment">// without assuming unit determinant of the conformal metric. Back to the roots, and as few assumptions as possible...</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    <span class="keywordtype">double</span> dGtildeSrc[3][3] = {0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) dGtildeSrc[k][i] += dgup[k][j][l]*Christoffel_tilde[j][l][i] + g_contr[j][l]*dChristoffel_tildeSrc[k][j][l][i];</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="keywordtype">double</span> dZSrc[3][3] = {0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) dZSrc[k][i] += MGCCZ4ds*(DD[k][i][j]*(Ghat[j]-Gtilde[j]) - 0.5*g_cov[i][j]*dGtildeSrc[k][j]);</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    <span class="keywordtype">double</span> nablaZSrc[3][3] = {0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    {</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>      nablaZSrc[i][j] = dZSrc[i][j];</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) nablaZSrc[i][j] -= Christoffel[i][j][k]*<a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[k];</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    }</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="keywordtype">double</span> RicciPlusNablaZSrc[3][3];</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) RicciPlusNablaZSrc[i][j] = RicciSrc[i][j] + nablaZSrc[i][j] + nablaZSrc[j][i];</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span> </div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    <span class="keywordtype">double</span> RPlusTwoNablaZSrc = 0;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) RPlusTwoNablaZSrc += g_contr[i][j]*RicciPlusNablaZSrc[i][j]; <span class="comment">// TODO fuse these steps</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    RPlusTwoNablaZSrc*=phi2;</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span> </div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> AA[3] = {Q[23], Q[24], Q[25]};</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    <span class="keywordtype">double</span> nablaijalphaSrc[3][3];</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    {</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>      nablaijalphaSrc[i][j] = alpha*AA[j]*AA[i];</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) nablaijalphaSrc[i][j] -= alpha*Christoffel[i][j][k]*AA[k];</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    }</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span> </div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    <span class="keywordtype">double</span> nablanablaalphaSrc=0;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) nablanablaalphaSrc += g_contr[i][j]*nablaijalphaSrc[i][j];</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    nablanablaalphaSrc *= phi2;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    <span class="keywordtype">double</span> SecondOrderTermsSrc[3][3];</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) SecondOrderTermsSrc[i][j] = -nablaijalphaSrc[i][j] + alpha*RicciPlusNablaZSrc[i][j];</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="keywordtype">double</span> traceSrc = 0;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) traceSrc += g_contr[i][j]*SecondOrderTermsSrc[i][j];</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) SecondOrderTermsSrc[i][j] -= 1./3 * traceSrc * g_cov[i][j];</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span> </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    <span class="keywordtype">double</span> dtgamma[3][3];</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dtgamma[i][j] = -2.0 * alpha * Aex[i][j] - MGCCZ4itau*(det -1.0)*g_cov[i][j];</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span> </div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> BB[3][3] = {</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        {Q[26], Q[27], Q[28]}, {Q[29], Q[30], Q[31]}, {Q[32], Q[33], Q[34]}</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    };</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <span class="keywordtype">double</span> traceB = BB[0][0] + BB[1][1] + BB[2][2];</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[3] = {Q[17], Q[18], Q[19]};</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) dtgamma[i][j] += g_cov[k][i]*BB[j][k] + g_cov[k][j]*BB[i][k] - 2./3. *g_cov[i][j]*BB[k][k] + 2.*<a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[k]*DD[k][i][j];</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span> </div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    <span class="comment">// MATMUL(Aex,Amix)</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    <span class="keywordtype">double</span> Atemp[3][3]={0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> = 0; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> &lt; 3; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>++) Atemp[i][j] += Aex[i][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>] * Amix[<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>][j];</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span> </div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> traceK = Q[53];</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    <span class="keywordtype">double</span> dtK[3][3];</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dtK[i][j] = phi2*SecondOrderTermsSrc[i][j] + alpha*Aex[i][j]*(traceK-2.*Theta) - 2.*alpha*Atemp[i][j] - MGCCZ4itau*g_cov[i][j]*traceA;</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span> </div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) dtK[i][j] += Aex[k][i]*BB[j][k] + Aex[k][j]*BB[i][k] - 2./3.*Aex[i][j]*BB[k][k];</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span> </div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> K0 = Q[58];</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    <span class="keywordtype">double</span> dtTraceK = -nablanablaalphaSrc + alpha*(RPlusTwoNablaZSrc + traceK*traceK - 2.0*MGCCZ4c*Theta*traceK) -3.0*alpha*MGCCZ4k1*(1.+MGCCZ4k2)*Theta;</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    <span class="keywordtype">double</span> dtphi = <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*PP[0] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*PP[1] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*PP[2] + 1./3.*(alpha*traceK-traceB);</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    <span class="keywordtype">double</span> dtalpha = -alpha*fa*(traceK-K0-2.*MGCCZ4c*Theta)+<a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*AA[0]+<a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*AA[1]+<a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*AA[2];</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span> </div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <span class="keywordtype">double</span> Aupdown = 0;</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) Aupdown += Aex[i][j]*Aup[i][j];</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    <span class="keywordtype">double</span> sumzupaa = 0.0;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) sumzupaa += Zup[i]*AA[i];</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dtTheta = 0.5*alpha*MGCCZ4e*MGCCZ4e*(RPlusTwoNablaZSrc - Aupdown + 2./3.*traceK*traceK) - alpha*(MGCCZ4c*Theta*traceK + sumzupaa + MGCCZ4k1*(2.+MGCCZ4k2)*Theta);  <span class="comment">// Baojiu</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="keywordtype">double</span> dtGhat[3] = {0,0,0};</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    {</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>        <span class="keywordtype">double</span> temp1=0, temp2=0, temp3=0, temp4=0, temp5=0, temp6=0;</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>        {</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>          temp1 += Aup[i][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]*PP[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>];</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>          temp3 += Aup[i][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]*AA[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>];</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>          temp2 += g_contr[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][i]*(-Theta*AA[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] -2./3.*traceK*<a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]);</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>          temp4 += g_contr[i][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]*<a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>];</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>          temp5 += Gtilde[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]*BB[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][i];</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++) temp6  += Christoffel_tilde[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][n][i]*Aup[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][n];</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>        }</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        dtGhat[i] += 2.*alpha*(temp6 - 3.*temp1 + temp2 - temp3 - MGCCZ4k1*temp4) - temp5 + 2./3.*Gtilde[i]*traceB;</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) dtGhat[i] += 2.*MGCCZ4k3*(2./3.*g_contr[i][l]*<a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[l]*BB[k][k] - g_contr[l][k]*<a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[l]*BB[k][i]);</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    }</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span> </div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>    <span class="keywordtype">double</span> ov[3];</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    {</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>=0;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a> += dgup[k][i][j]*Aex[i][j];</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>        ov[k] = 2*alpha*<a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>;</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    }</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span> </div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>    <span class="comment">// matrix vector multiplication in a loop and add result to existing vector</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dtGhat[i] += MGCCZ4sk*g_contr[i][j]*ov[j];</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span> </div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> myb[3] = {Q[20], Q[21], Q[22]};</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span> </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="keywordtype">double</span> dtbb[3];</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) dtbb[i] = MGCCZ4sk*(MGCCZ4xi*dtGhat[i] - MGCCZ4eta*myb[i]);</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <span class="keywordtype">double</span> dtbeta[3];</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) dtbeta[i] = MGCCZ4f*myb[i];</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) dtbeta[i] += MGCCZ4bs*(<a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*BB[0][i] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*BB[1][i] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*BB[2][i]);</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) dtbeta[i] *= MGCCZ4sk;</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span> </div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span> </div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <span class="comment">// Auxiliary variables</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    <span class="keywordtype">double</span> dtA[3] ={0,0,0};</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    {</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>      dtA[i] = -alpha*AA[i]*(fa+alpha*faa)*(traceK - K0 - 2.*MGCCZ4c*Theta);</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dtA[i] += BB[i][j]*AA[j];</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>    }</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span> </div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>      <span class="keywordtype">double</span> <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a> = 0;</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>+= dgup[k][i][j]*Aex[i][j];</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>      dtA[k] += -MGCCZ4sk*alpha*fa*<a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    }</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <span class="keywordtype">double</span> dtB[3][3] ={0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> = 0; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> &lt; 3; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>++) dtB[i][j] += MGCCZ4sk*(BB[i][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>] * BB[<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>][j]);</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span> </div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>    <span class="keywordtype">double</span> dtD[3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++) dtD[k][i][j] += 1./3*alpha*g_cov[i][j]*dgup[k][n][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]*Aex[n][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]; <span class="comment">// explicitly remove the trace of tilde A again</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span> </div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    {</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>      dtD[k][i][j] -= alpha*AA[k]*Aex[i][j];</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++) dtD[k][i][j] += BB[k][l]*DD[l][i][j] + BB[j][l]*DD[k][l][i] + BB[i][l]*DD[k][l][j] - 2./3.*BB[l][l]*DD[k][i][j];</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>    }</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span> </div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>    <span class="keywordtype">double</span> dtP[3] = {0,0,0};</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dtP[i] += BB[i][j]*PP[j];</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span> </div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    {</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>      <span class="keywordtype">double</span> <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>=0;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a> += dgup[k][i][j]*Aex[i][j];</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>      dtP[k] += 1./3.*alpha*(AA[k]*traceK + MGCCZ4sk*<a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>);</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    }</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    S[0]  = dtgamma[0][0];</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    S[1]  = dtgamma[0][1];</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>    S[2]  = dtgamma[0][2];</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    S[3]  = dtgamma[1][1];</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>    S[4]  = dtgamma[1][2];</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    S[5]  = dtgamma[2][2];</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    S[6]  = dtK[0][0];</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    S[7]  = dtK[0][1];</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    S[8]  = dtK[0][2];</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    S[9]  = dtK[1][1];</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    S[10] = dtK[1][2];</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    S[11] = dtK[2][2];</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>    S[12] = dtTheta;</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) S[13+i] = dtGhat[i];</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>    S[16] = dtalpha;</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) S[17+i] = dtbeta[i];</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) S[20+i] = dtbb[i];</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) S[23+i] = dtA[i];</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>    S[26] = dtB[0][0];</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>    S[27] = dtB[1][0];</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>    S[28] = dtB[2][0];</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>    S[29] = dtB[0][1];</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    S[30] = dtB[1][1];</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    S[31] = dtB[2][1];</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    S[32] = dtB[0][2];</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    S[33] = dtB[1][2];</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>    S[34] = dtB[2][2];</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>    S[35] = dtD[0][0][0];</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    S[36] = dtD[0][0][1];</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>    S[37] = dtD[0][0][2];</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    S[38] = dtD[0][1][1];</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>    S[39] = dtD[0][1][2];</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    S[40] = dtD[0][2][2];</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    S[41] = dtD[1][0][0];</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>    S[42] = dtD[1][0][1];</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    S[43] = dtD[1][0][2];</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    S[44] = dtD[1][1][1];</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    S[45] = dtD[1][1][2];</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    S[46] = dtD[1][2][2];</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    S[47] = dtD[2][0][0];</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    S[48] = dtD[2][0][1];</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    S[49] = dtD[2][0][2];</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    S[50] = dtD[2][1][1];</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    S[51] = dtD[2][1][2];</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    S[52] = dtD[2][2][2];</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    S[53] = dtTraceK;</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>    S[54] = dtphi;</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) S[55+i] = dtP[i];</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>    S[58] = 0;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>}</div>
</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span><span class="preprocessor">#if defined(GPUOffloadingOMP)</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span><span class="preprocessor">#pragma omp end declare target</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span> </div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span><span class="preprocessor">#if defined(GPUOffloadingOMP)</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span><span class="preprocessor">#pragma omp declare target</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span><span class="preprocessor">#endif</span></div>
<div class="foldopen" id="foldopen00504" data-start="{" data-end="}">
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno"><a class="line" href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a246515f22600697fce9e6d37a532023d">  504</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a246515f22600697fce9e6d37a532023d">examples::exahype2::mgccz4::ncp</a>(<span class="keywordtype">double</span>* BgradQ, <span class="keyword">const</span> <span class="keywordtype">double</span>* <span class="keyword">const</span> Q, <span class="keyword">const</span> <span class="keywordtype">double</span>* <span class="keyword">const</span> gradQSerialised, <span class="keyword">const</span> <span class="keywordtype">int</span> normal,</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> MGCCZ4LapseType,</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4ds,</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4c,</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4e,</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4f,</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4bs,</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4sk,</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4xi,</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> MGCCZ4mu</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>      )</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>{</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> alpha = std::exp(std::fmax(-20., std::fmin(20.,Q[16])));</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>    <span class="comment">//printf(&quot;alpha %f\n&quot;,alpha);</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> alpha2 = alpha*alpha;</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>    <span class="keywordtype">double</span> fa  = 1.0;</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>    <span class="keywordtype">double</span> faa = 0.0;</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    <span class="keywordflow">if</span> (MGCCZ4LapseType==1)</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    {</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>      fa  =  2./alpha;</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>      faa = -fa/alpha;</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    }</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span> </div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> nVar(64);</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span> </div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    <span class="keywordtype">double</span> gradQin[64][3]={0}; <span class="comment">//={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span> </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="comment">// De-serialise input data and fill static array</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="comment">// FIXME the use of 2D arrays can be avoided: all terms not in the normal are 0</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nVar; i++) gradQin[i][normal] = gradQSerialised[i+normal*nVar];</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span> </div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span> </div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>    <span class="comment">// Note g_cov is symmetric</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> g_cov[3][3] = { {Q[0], Q[1], Q[2]}, {Q[1], Q[3], Q[4]}, {Q[2], Q[4], Q[5]} };</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> invdet = 1./( Q[0]*Q[3]*Q[5] - Q[0]*Q[4]*Q[4] - Q[1]*Q[1]*Q[5] + 2*Q[1]*Q[2]*Q[4] -Q[2]*Q[2]*Q[3]);</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span> </div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> g_contr[3][3] = {</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>        { ( Q[3]*Q[5]-Q[4]*Q[4])*invdet, -( Q[1]*Q[5]-Q[2]*Q[4])*invdet, -(-Q[1]*Q[4]+Q[2]*Q[3])*invdet},</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>        {-( Q[1]*Q[5]-Q[4]*Q[2])*invdet,  ( Q[0]*Q[5]-Q[2]*Q[2])*invdet, -( Q[0]*Q[4]-Q[2]*Q[1])*invdet},</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>        {-(-Q[1]*Q[4]+Q[3]*Q[2])*invdet, -( Q[0]*Q[4]-Q[1]*Q[2])*invdet,  ( Q[0]*Q[3]-Q[1]*Q[1])*invdet}</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    };</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span> </div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span> </div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="comment">// NOTE Aex is symmetric</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>    <span class="keywordtype">double</span> Aex[3][3] = { {Q[6], Q[7], Q[8]}, {Q[7], Q[9], Q[10]}, {Q[8], Q[10], Q[11]} };</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span> </div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>    <span class="keywordtype">double</span> traceA = 0;</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) traceA+=g_contr[i][j]*Aex[i][j];</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>    traceA *= 1./3;</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span> </div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) Aex[i][j] -= traceA * g_cov[i][j];</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span> </div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="comment">// Matrix multiplications Amix = matmul(g_contr, Aex) Aup  = matmul(g_contr, mytranspose(Amix))</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>    <span class="keywordtype">double</span> Amix[3][3]={0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> = 0; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> &lt; 3; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>++) Amix[i][j] += g_contr[i][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>] * Aex[<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>][j];</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    <span class="keywordtype">double</span> Aup[3][3]={0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> = 0; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> &lt; 3; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>++) Aup[i][j] += g_contr[i][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>] * Amix[j][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>]; <span class="comment">// Note the transposition is in the indices</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span> </div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> DD[3][3][3] = {</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>        {{Q[35], Q[36], Q[37]}, {Q[36], Q[38], Q[39]}, {Q[37], Q[39], Q[40]}},</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>        {{Q[41], Q[42], Q[43]}, {Q[42], Q[44], Q[45]}, {Q[43], Q[45], Q[46]}},</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>        {{Q[47], Q[48], Q[49]}, {Q[48], Q[50], Q[51]}, {Q[49], Q[51], Q[52]}}</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    };</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>    <span class="keywordtype">double</span> dgup[3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++)</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dgup[k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l] -= g_contr[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][n]*g_contr[j][l]*2*DD[k][n][j];</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span> </div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> PP[3] = {Q[55], Q[56], Q[57]};</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span> </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="keywordtype">double</span> Christoffel[3][3][3]       = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    <span class="keywordtype">double</span> Christoffel_tilde[3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    <span class="comment">//double Christoffel_kind1[3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span> </div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    {</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>        <span class="comment">//Christoffel_kind1[i][j][k] = DD[k][i][j] + DD[j][i][k] - DD[i][j][k];</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>        {</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>            Christoffel_tilde[i][j][k] += g_contr[k][l] * ( DD[i][j][l] + DD[j][i][l] - DD[l][i][j] );</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>            Christoffel[i][j][k]       += g_contr[k][l] * ( DD[i][j][l] + DD[j][i][l] - DD[l][i][j] ) - g_contr[k][l] * ( g_cov[j][l] * PP[i] + g_cov[i][l] * PP[j] - g_cov[i][j] * PP[l] );</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>        }</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    }</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span> </div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    <span class="keywordtype">double</span> Gtilde[3] = {0,0,0};</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) Gtilde[i] += g_contr[j][l] * Christoffel_tilde[j][l][i];</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span> </div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> Ghat[3] = {Q[13], Q[14], Q[15]};</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> phi = std::exp(std::fmax(-20., std::fmin(20.,Q[54])));</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> phi2 = phi*phi;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span> </div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>    <span class="keywordtype">double</span> <a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[3] = {0,0,0};</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) <a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[i] += 0.5*( g_cov[i][j]* (Ghat[j] - Gtilde[j]));</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    <span class="keywordtype">double</span> Zup[3] = {0,0,0};</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) Zup[i] += phi2 * g_contr[i][j] * <a class="code hl_enumvalue" href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a>[j];</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span> </div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span> </div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dDD[3][3][3][3] = {</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>        {</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>            {</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>                {gradQin[35][0],gradQin[36][0],gradQin[37][0]}, {gradQin[36][0],gradQin[38][0],gradQin[39][0]}, {gradQin[37][0],gradQin[39][0],gradQin[40][0]},</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>            },</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>            {</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>                {gradQin[41][0],gradQin[42][0],gradQin[43][0]}, {gradQin[42][0],gradQin[44][0],gradQin[45][0]}, {gradQin[43][0],gradQin[45][0],gradQin[46][0]},</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>            },</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>            {</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>                {gradQin[47][0],gradQin[48][0],gradQin[49][0]}, {gradQin[48][0],gradQin[50][0],gradQin[51][0]}, {gradQin[49][0],gradQin[51][0],gradQin[52][0]}</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>            }</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        },</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>        {</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>            {</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>                {gradQin[35][1],gradQin[36][1],gradQin[37][1]}, {gradQin[36][1],gradQin[38][1],gradQin[39][1]}, {gradQin[37][1],gradQin[39][1],gradQin[40][1]},</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>            },</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>            {</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>                {gradQin[41][1],gradQin[42][1],gradQin[43][1]}, {gradQin[42][1],gradQin[44][1],gradQin[45][1]}, {gradQin[43][1],gradQin[45][1],gradQin[46][1]},</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>            },</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>            {</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>                {gradQin[47][1],gradQin[48][1],gradQin[49][1]}, {gradQin[48][1],gradQin[50][1],gradQin[51][1]}, {gradQin[49][1],gradQin[51][1],gradQin[52][1]}</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>            }</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        },</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>        {</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>            {</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>                {gradQin[35][2],gradQin[36][2],gradQin[37][2]}, {gradQin[36][2],gradQin[38][2],gradQin[39][2]}, {gradQin[37][2],gradQin[39][2],gradQin[40][2]},</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>            },</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>            {</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>                {gradQin[41][2],gradQin[42][2],gradQin[43][2]}, {gradQin[42][2],gradQin[44][2],gradQin[45][2]}, {gradQin[43][2],gradQin[45][2],gradQin[46][2]},</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>            },</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>            {</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>                {gradQin[47][2],gradQin[48][2],gradQin[49][2]}, {gradQin[48][2],gradQin[50][2],gradQin[51][2]}, {gradQin[49][2],gradQin[51][2],gradQin[52][2]}</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>            }</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>        }</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    };</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span> </div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span> </div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dPP[3][3] = {</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        {gradQin[55][0],gradQin[56][0],gradQin[57][0]},</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        {gradQin[55][1],gradQin[56][1],gradQin[57][1]},</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>        {gradQin[55][2],gradQin[56][2],gradQin[57][2]}</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    };</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span> </div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span> </div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    <span class="keywordtype">double</span> dChristoffelNCP[3][3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>    <span class="keywordtype">double</span> dChristoffel_tildeNCP[3][3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>    {</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>        dChristoffelNCP      [k][i][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] = 0;</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>        dChristoffel_tildeNCP[k][i][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] = 0;</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>        {</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>            dChristoffelNCP[k][i][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] +=  0.5*g_contr[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l] * (</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>                    dDD[k][i][j][l] + dDD[i][k][j][l] + dDD[k][j][i][l] + dDD[j][k][i][l] - dDD[k][l][i][j] - dDD[l][k][i][j]</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>                    - g_cov[j][l]*(dPP[k][i] + dPP[i][k]) - g_cov[i][l]*(dPP[k][j]+dPP[j][k]) +  g_cov[i][j]*(dPP[k][l]+dPP[l][k]) );</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span> </div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>            dChristoffel_tildeNCP[k][i][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] += 0.5*g_contr[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l]*(dDD[k][i][j][l] + dDD[i][k][j][l] + dDD[k][j][i][l] + dDD[j][k][i][l] - dDD[k][l][i][j] - dDD[l][k][i][j]);</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span> </div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>        }</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>    }</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span> </div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>    <span class="keywordtype">double</span> RiemannNCP[3][3][3][3] = {0};</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) RiemannNCP[i][k][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] = dChristoffelNCP[k][i][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] - dChristoffelNCP[j][i][k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>];</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span> </div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>    <span class="keywordtype">double</span> RicciNCP[3][3] = {0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++)</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++) RicciNCP[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][n] += RiemannNCP[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l][n][l];</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span> </div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>    <span class="keywordtype">double</span> dGtildeNCP[3][3] = {0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++) dGtildeNCP[k][i] += g_contr[j][l]*dChristoffel_tildeNCP[k][j][l][i];</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span> </div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span> </div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dGhat[3][3] = {</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>        {gradQin[13][0],gradQin[14][0],gradQin[15][0]},</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>        {gradQin[13][1],gradQin[14][1],gradQin[15][1]},</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>        {gradQin[13][2],gradQin[14][2],gradQin[15][2]}</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>    };</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span> </div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span> </div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span> </div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>    <span class="keywordtype">double</span> dZNCP[3][3] = {0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) dZNCP[k][i] += MGCCZ4ds*0.5*g_cov[i][j]*(dGhat[k][j]-dGtildeNCP[k][j]);</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span> </div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span> </div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>    <span class="keywordtype">double</span> RicciPlusNablaZNCP[3][3];</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) RicciPlusNablaZNCP[i][j] = RicciNCP[i][j] + dZNCP[i][j] + dZNCP[j][i];</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span> </div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>    <span class="keywordtype">double</span> RPlusTwoNablaZNCP = 0;</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) RPlusTwoNablaZNCP += g_contr[i][j]*RicciPlusNablaZNCP[i][j]; <span class="comment">// TODO fuse these steps</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>    RPlusTwoNablaZNCP*=phi2;</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span> </div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span> </div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> AA[3] = {Q[23], Q[24], Q[25]};</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dAA[3][3] = {</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>        {gradQin[23][0],gradQin[24][0],gradQin[25][0]},</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>        {gradQin[23][1],gradQin[24][1],gradQin[25][1]},</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>        {gradQin[23][2],gradQin[24][2],gradQin[25][2]}</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>    };</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span> </div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>    <span class="keywordtype">double</span> nablaijalphaNCP[3][3];</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) nablaijalphaNCP[i][j] = alpha*0.5*( dAA[i][j] + dAA[j][i] );</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span> </div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>    <span class="keywordtype">double</span> nablanablaalphaNCP = 0;</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) nablanablaalphaNCP += g_contr[i][j]*nablaijalphaNCP[i][j];</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>    nablanablaalphaNCP*=phi2;</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span> </div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span> </div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>    <span class="keywordtype">double</span> SecondOrderTermsNCP[3][3];</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) SecondOrderTermsNCP[i][j] = -nablaijalphaNCP[i][j] + alpha*RicciPlusNablaZNCP[i][j];</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span> </div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    <span class="keywordtype">double</span> traceNCP = 0;</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) traceNCP += g_contr[i][j]*SecondOrderTermsNCP[i][j];</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) SecondOrderTermsNCP[i][j] -= 1./3 * traceNCP * g_cov[i][j];</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span> </div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[3] = {Q[17], Q[18], Q[19]};</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span> </div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dAex[3][3][3] = {</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>        {{gradQin[6][0],gradQin[7][0],gradQin[8][0]}, {gradQin[7][0], gradQin[9][0], gradQin[10][0]},  {gradQin[8][0], gradQin[10][0], gradQin[11][0]}},</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>        {{gradQin[6][1],gradQin[7][1],gradQin[8][1]}, {gradQin[7][1], gradQin[9][1], gradQin[10][1]},  {gradQin[8][1], gradQin[10][1], gradQin[11][1]}},</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>        {{gradQin[6][2],gradQin[7][2],gradQin[8][2]}, {gradQin[7][2], gradQin[9][2], gradQin[10][2]},  {gradQin[8][2], gradQin[10][2], gradQin[11][2]}}</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>    };</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    <span class="keywordtype">double</span> dtK[3][3];</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)  dtK[i][j] = phi2*SecondOrderTermsNCP[i][j] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0] * dAex[0][i][j] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1] * dAex[1][i][j] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2] * dAex[2][i][j]; <span class="comment">// extrinsic curvature</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span> </div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dtraceK[3] = {gradQin[53][0], gradQin[53][1], gradQin[53][2]};</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span> </div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>    <span class="keywordtype">double</span> dtTraceK = -nablanablaalphaNCP + alpha*RPlusTwoNablaZNCP + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*dtraceK[0] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*dtraceK[1] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*dtraceK[2];</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span> </div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> BB[3][3] = {</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>        {Q[26], Q[27], Q[28]}, {Q[29], Q[30], Q[31]}, {Q[32], Q[33], Q[34]}</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>    };</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span> </div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>    <span class="keywordtype">double</span> traceB = BB[0][0] + BB[1][1] + BB[2][2]; <span class="comment">// TODO direct from Q!</span></div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span> </div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>    <span class="keywordtype">double</span> Aupdown = 0;</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) Aupdown += Aex[i][j]*Aup[i][j];</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span> </div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dTheta[3] = {gradQin[12][0],gradQin[12][1],gradQin[12][2]};</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dtTheta = 0.5*alpha*MGCCZ4e*MGCCZ4e*( RPlusTwoNablaZNCP ) + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*dTheta[0] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*dTheta[1] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*dTheta[2]; <span class="comment">// *** original cleaning ***</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span> </div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>    <span class="keywordtype">double</span> divAupNCP[3] = {0,0,0};</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span> </div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) divAupNCP[i] += g_contr[i][l]*g_contr[j][k]*dAex[j][l][k];</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span> </div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span> </div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dBB[3][3][3] = {</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>        {</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>            {MGCCZ4sk*gradQin[26][0],MGCCZ4sk*gradQin[27][0],MGCCZ4sk*gradQin[28][0]}, {MGCCZ4sk*gradQin[29][0],MGCCZ4sk*gradQin[30][0],MGCCZ4sk*gradQin[31][0]}, {MGCCZ4sk*gradQin[32][0],MGCCZ4sk*gradQin[33][0],MGCCZ4sk*gradQin[34][0]}</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>        },</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>        {</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>            {MGCCZ4sk*gradQin[26][1],MGCCZ4sk*gradQin[27][1],MGCCZ4sk*gradQin[28][1]}, {MGCCZ4sk*gradQin[29][1],MGCCZ4sk*gradQin[30][1],MGCCZ4sk*gradQin[31][1]}, {MGCCZ4sk*gradQin[32][1],MGCCZ4sk*gradQin[33][1],MGCCZ4sk*gradQin[34][1]}</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>        },</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>        {</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>            {MGCCZ4sk*gradQin[26][2],MGCCZ4sk*gradQin[27][2],MGCCZ4sk*gradQin[28][2]}, {MGCCZ4sk*gradQin[29][2],MGCCZ4sk*gradQin[30][2],MGCCZ4sk*gradQin[31][2]}, {MGCCZ4sk*gradQin[32][2],MGCCZ4sk*gradQin[33][2],MGCCZ4sk*gradQin[34][2]}</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>        }</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>    };</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span> </div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>    <span class="keywordtype">double</span> dtGhat[3] = {0,0,0};</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>    {</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>=0, temp2=0;</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        {</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>            <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>  +=g_contr[i][j]*dtraceK[j];</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>            temp2 +=g_contr[j][i]*dTheta[j];</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>        }</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>        dtGhat[i] = -4./3.*alpha*<a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a> + 2*alpha*temp2 + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*dGhat[0][i] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*dGhat[1][i] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*dGhat[2][i];</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) dtGhat[i] += g_contr[k][l]*0.5*(dBB[k][l][i] + dBB[l][k][i]) + 1./3.*g_contr[i][k]*0.5*(dBB[k][l][l] + dBB[l][k][l]);</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>    }</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span> </div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>    <span class="keywordtype">double</span> ov[3];</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>    {</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>=0;</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a> += g_contr[i][j]*dAex[k][i][j];</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>        ov[k] = 2*alpha*<a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>;</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>    }</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dtGhat[i] += MGCCZ4sk*g_contr[i][j]*ov[j];</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span> </div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>    <span class="keywordtype">double</span> dtbb[3];</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>    {</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>        dtbb[i] = MGCCZ4xi*dtGhat[i] + MGCCZ4bs * ( <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*gradQin[20+i][0] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*gradQin[20+i][1] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*gradQin[20+i][2] - <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*gradQin[13+i][0] - <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*gradQin[13+i][1] - <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*gradQin[13+i][2]);</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>        dtbb[i] *= MGCCZ4sk;</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>    }</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span> </div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>    <span class="comment">// Auxiliary variables</span></div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>    <span class="keywordtype">double</span> dtA[3];</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>    <span class="keywordtype">double</span> dK0[3] = {0,0,0};</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>    {</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>        dtA[i] = -alpha*fa*(dtraceK[i] - dK0[i] - MGCCZ4c*2*dTheta[i]) + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*dAA[0][i] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*dAA[1][i] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*dAA[2][i];</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    }</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>    <span class="comment">/*if ((dtA[1]+dtA[2])!=0 &amp;&amp; dtA[2]&gt;1e-9) {printf(&quot;cpp dtA[1]=%g, dtA[2]=%g\n&quot;,dtA[1],dtA[2]);</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span><span class="comment">    printf(&quot;cpp dtheta[1]=%g, dtheta[2]=%g \n&quot;,dTheta[1],dTheta[2]);</span></div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span><span class="comment">    printf(&quot;cpp dtracek[1]=%g, dtracek[2]=%g \n&quot;,dtraceK[1],dtraceK[2]);</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span><span class="comment">    }*/</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>    <span class="comment">//if ((dTheta[0]+dTheta[1]+dTheta[2])!=0) printf(&quot;cpp dtheta[0] = %g, dtheta[1] = %g, dtheta[2] = %g \n\n&quot;,dTheta[0],dTheta[1],dTheta[2]);</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>    {</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>=0;</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a> += g_contr[i][j]*dAex[k][i][j]; <span class="comment">// TODO we computed this quantity  few lines earlier alrady</span></div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>        dtA[k] -= MGCCZ4sk*alpha*fa*<a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>;</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>    }</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span> </div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    <span class="keywordtype">double</span> dtB[3][3] = {</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>        {MGCCZ4f*gradQin[20][0],MGCCZ4f*gradQin[21][0],MGCCZ4f*gradQin[22][0]},</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>        {MGCCZ4f*gradQin[20][1],MGCCZ4f*gradQin[21][1],MGCCZ4f*gradQin[22][1]},</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>        {MGCCZ4f*gradQin[20][2],MGCCZ4f*gradQin[21][2],MGCCZ4f*gradQin[22][2]}</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>    };</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span> </div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span> </div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>    {</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>        dtB[k][i] += MGCCZ4mu*alpha2 * g_contr[i][j]*( dPP[k][j] - dPP[j][k]);</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++)</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++) dtB[k][i] -= MGCCZ4mu*alpha2 * g_contr[i][j]*g_contr[n][l]*( dDD[k][l][j][n] - dDD[l][k][j][n]);</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>    }</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span> </div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dtB[i][j] += MGCCZ4bs*(<a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*dBB[0][i][j] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*dBB[1][i][j] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*dBB[2][i][j]);</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span> </div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>    <span class="comment">// NOTE 0 value param</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dtB[i][j] *= MGCCZ4sk;</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span> </div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>    <span class="keywordtype">double</span> dtD[3][3][3];</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) dtD[i][j][k] = -alpha*dAex[i][j][k];</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span> </div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>    {</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>        dtD[k][i][j] += ( 0.25*(g_cov[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][i]*(dBB[k][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] + dBB[j][k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]) + g_cov[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][j]*(dBB[k][i][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]+dBB[i][k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>])) - 1./6.*g_cov[i][j]*(dBB[k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]+dBB[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]) );</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++)</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>            dtD[k][i][j] += 1./3*alpha*g_cov[i][j]*g_contr[n][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]*dAex[k][n][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]; <span class="comment">// explicitly remove the trace of tilde A again</span></div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>    }</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span> </div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) dtD[i][j][k] += <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*dDD[0][i][j][k] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*dDD[1][i][j][k] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*dDD[2][i][j][k];</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span> </div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>    <span class="keywordtype">double</span> dtP[3];</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) dtP[i] = <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[0]*dPP[0][i] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[1]*dPP[1][i] + <a class="code hl_variable" href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a>[2]*dPP[2][i];</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>    {</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>=0;</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++) <a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a> += g_contr[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][n]*dAex[k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][n];</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>        dtP[k] += 1./3*alpha*(dtraceK[k] + MGCCZ4sk*<a class="code hl_variable" href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a>);</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) dtP[k] -= 1./6*(dBB[k][i][i] + dBB[i][k][i]);</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>    }</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span> </div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>    <span class="keywordtype">double</span> dtgamma[3][3] = {0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>    <span class="keywordtype">double</span> dtalpha = 0;</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>    <span class="keywordtype">double</span> dtbeta[3] = {0,0,0};</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>    <span class="keywordtype">double</span> dtphi = 0;</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span> </div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>    BgradQ[0]  = -dtgamma[0][0];</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>    BgradQ[1]  = -dtgamma[0][1];</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>    BgradQ[2]  = -dtgamma[0][2];</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>    BgradQ[3]  = -dtgamma[1][1];</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>    BgradQ[4]  = -dtgamma[1][2];</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>    BgradQ[5]  = -dtgamma[2][2];</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>    BgradQ[6]  = -dtK[0][0];</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>    BgradQ[7]  = -dtK[0][1];</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>    BgradQ[8]  = -dtK[0][2];</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>    BgradQ[9]  = -dtK[1][1];</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>    BgradQ[10] = -dtK[1][2];</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    BgradQ[11] = -dtK[2][2]; <span class="comment">// ok</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>    BgradQ[12] = -dtTheta;   <span class="comment">// ok</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) BgradQ[13+i] = -dtGhat[i]; <span class="comment">// buggy</span></div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>    BgradQ[16] = -dtalpha;</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) BgradQ[17+i] = -dtbeta[i];</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) BgradQ[20+i] = -dtbb[i];</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) BgradQ[23+i] = -dtA[i];</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>    BgradQ[26] = -dtB[0][0]; <span class="comment">// note: thes are all 0 for default MGCCZ4sk=0</span></div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>    BgradQ[27] = -dtB[1][0];</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>    BgradQ[28] = -dtB[2][0];</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>    BgradQ[29] = -dtB[0][1];</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>    BgradQ[30] = -dtB[1][1];</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>    BgradQ[31] = -dtB[2][1];</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>    BgradQ[32] = -dtB[0][2];</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>    BgradQ[33] = -dtB[1][2];</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>    BgradQ[34] = -dtB[2][2];</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span> </div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>    BgradQ[35] = -dtD[0][0][0];</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>    BgradQ[36] = -dtD[0][0][1];</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>    BgradQ[37] = -dtD[0][0][2];</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>    BgradQ[38] = -dtD[0][1][1];</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>    BgradQ[39] = -dtD[0][1][2];</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>    BgradQ[40] = -dtD[0][2][2];</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span> </div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    BgradQ[41] = -dtD[1][0][0];</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    BgradQ[42] = -dtD[1][0][1];</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>    BgradQ[43] = -dtD[1][0][2];</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>    BgradQ[44] = -dtD[1][1][1];</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>    BgradQ[45] = -dtD[1][1][2];</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>    BgradQ[46] = -dtD[1][2][2];</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span> </div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>    BgradQ[47] = -dtD[2][0][0];</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>    BgradQ[48] = -dtD[2][0][1];</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    BgradQ[49] = -dtD[2][0][2];</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>    BgradQ[50] = -dtD[2][1][1];</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>    BgradQ[51] = -dtD[2][1][2];</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>    BgradQ[52] = -dtD[2][2][2];</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>    BgradQ[53] = -dtTraceK;</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>    BgradQ[54] = -dtphi;</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) BgradQ[55+i] = -dtP[i];</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>    BgradQ[58] = 0;</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>    <span class="comment">//if (dtP[1]!=0) printf(&quot;dtP[1] = %g, dtP[2] = %g \n\n&quot;,dtP[1],dtP[2]);</span></div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>}</div>
</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span><span class="preprocessor">#if defined(GPUOffloadingOMP)</span></div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span><span class="preprocessor">#pragma omp end declare target</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span> </div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span><span class="preprocessor">#if defined(GPUOffloadingOMP)</span></div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span><span class="preprocessor">#pragma omp declare target</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span><span class="preprocessor">#endif</span></div>
<div class="foldopen" id="foldopen00972" data-start="{" data-end="}">
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno"><a class="line" href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a6c60c2a34221a5907be82098d0e6e313">  972</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a6c60c2a34221a5907be82098d0e6e313">examples::exahype2::mgccz4::admconstraints</a>(<span class="keywordtype">double</span>* constraints, <span class="keyword">const</span> <span class="keywordtype">double</span>* <span class="keyword">const</span> Q, <span class="keyword">const</span> <span class="keywordtype">double</span>* <span class="keyword">const</span> gradQSerialised)</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>{</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> nVar(64);</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>    <span class="keywordtype">double</span> gradQin[64][3]={0};</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span> </div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>    <span class="comment">// De-serialise input data and fill static array</span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> normal=0; normal&lt;3; normal++)</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nVar; i++) gradQin[i][normal] = gradQSerialised[i+normal*nVar];</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span> </div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>    <span class="comment">// Note g_cov is symmetric</span></div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> g_cov[3][3] = { {Q[0], Q[1], Q[2]}, {Q[1], Q[3], Q[4]}, {Q[2], Q[4], Q[5]} };</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> invdet = 1./( Q[0]*Q[3]*Q[5] - Q[0]*Q[4]*Q[4] - Q[1]*Q[1]*Q[5] + 2*Q[1]*Q[2]*Q[4] -Q[2]*Q[2]*Q[3]);</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span> </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> g_contr[3][3] = {</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>        { ( Q[3]*Q[5]-Q[4]*Q[4])*invdet, -( Q[1]*Q[5]-Q[2]*Q[4])*invdet, -(-Q[1]*Q[4]+Q[2]*Q[3])*invdet},</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>        {-( Q[1]*Q[5]-Q[4]*Q[2])*invdet,  ( Q[0]*Q[5]-Q[2]*Q[2])*invdet, -( Q[0]*Q[4]-Q[2]*Q[1])*invdet},</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>        {-(-Q[1]*Q[4]+Q[3]*Q[2])*invdet, -( Q[0]*Q[4]-Q[1]*Q[2])*invdet,  ( Q[0]*Q[3]-Q[1]*Q[1])*invdet}</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>    };</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span> </div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>    <span class="comment">// NOTE Aex is symmetric</span></div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>    <span class="keywordtype">double</span> Aex[3][3] = { {Q[6], Q[7], Q[8]}, {Q[7], Q[9], Q[10]}, {Q[8], Q[10], Q[11]} };</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span> </div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>    <span class="keywordtype">double</span> traceA = 0;</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) traceA+=g_contr[i][j]*Aex[i][j];</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>    traceA *= 1./3;</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span> </div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) Aex[i][j] -= traceA * g_cov[i][j];</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span> </div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dAex[3][3][3] = {</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>        {{gradQin[6][0],gradQin[7][0],gradQin[8][0]}, {gradQin[7][0], gradQin[9][0], gradQin[10][0]},  {gradQin[8][0], gradQin[10][0], gradQin[11][0]}},</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>        {{gradQin[6][1],gradQin[7][1],gradQin[8][1]}, {gradQin[7][1], gradQin[9][1], gradQin[10][1]},  {gradQin[8][1], gradQin[10][1], gradQin[11][1]}},</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>        {{gradQin[6][2],gradQin[7][2],gradQin[8][2]}, {gradQin[7][2], gradQin[9][2], gradQin[10][2]},  {gradQin[8][2], gradQin[10][2], gradQin[11][2]}}</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>    };</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span> </div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> traceK = Q[53];</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dtraceK[3] = {gradQin[53][0], gradQin[53][1], gradQin[53][2]};</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span> </div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> phi = std::exp(std::fmax(-20., std::fmin(20.,Q[54])));</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> phi2 = phi*phi;</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> PP[3] = {Q[55], Q[56], Q[57]};</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span> </div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dPP[3][3] = {</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>        {gradQin[55][0],gradQin[56][0],gradQin[57][0]},</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>        {gradQin[55][1],gradQin[56][1],gradQin[57][1]},</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>        {gradQin[55][2],gradQin[56][2],gradQin[57][2]}</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    };</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span> </div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> DD[3][3][3] = {</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>        {{Q[35], Q[36], Q[37]}, {Q[36], Q[38], Q[39]}, {Q[37], Q[39], Q[40]}},</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>        {{Q[41], Q[42], Q[43]}, {Q[42], Q[44], Q[45]}, {Q[43], Q[45], Q[46]}},</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>        {{Q[47], Q[48], Q[49]}, {Q[48], Q[50], Q[51]}, {Q[49], Q[51], Q[52]}}</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>    };</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dDD[3][3][3][3] = {</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>        {</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>                {</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>                        {gradQin[35][0],gradQin[36][0],gradQin[37][0]}, {gradQin[36][0],gradQin[38][0],gradQin[39][0]}, {gradQin[37][0],gradQin[39][0],gradQin[40][0]},</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>                },</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>                {</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>                        {gradQin[41][0],gradQin[42][0],gradQin[43][0]}, {gradQin[42][0],gradQin[44][0],gradQin[45][0]}, {gradQin[43][0],gradQin[45][0],gradQin[46][0]},</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>                },</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>                {</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>                        {gradQin[47][0],gradQin[48][0],gradQin[49][0]}, {gradQin[48][0],gradQin[50][0],gradQin[51][0]}, {gradQin[49][0],gradQin[51][0],gradQin[52][0]}</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>                }</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>        },</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>        {</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>                {</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>                        {gradQin[35][1],gradQin[36][1],gradQin[37][1]}, {gradQin[36][1],gradQin[38][1],gradQin[39][1]}, {gradQin[37][1],gradQin[39][1],gradQin[40][1]},</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>                },</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>                {</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>                        {gradQin[41][1],gradQin[42][1],gradQin[43][1]}, {gradQin[42][1],gradQin[44][1],gradQin[45][1]}, {gradQin[43][1],gradQin[45][1],gradQin[46][1]},</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>                },</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>                {</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>                        {gradQin[47][1],gradQin[48][1],gradQin[49][1]}, {gradQin[48][1],gradQin[50][1],gradQin[51][1]}, {gradQin[49][1],gradQin[51][1],gradQin[52][1]}</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>                }</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>        },</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>        {</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>                {</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>                        {gradQin[35][2],gradQin[36][2],gradQin[37][2]}, {gradQin[36][2],gradQin[38][2],gradQin[39][2]}, {gradQin[37][2],gradQin[39][2],gradQin[40][2]},</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>                },</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>                {</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>                        {gradQin[41][2],gradQin[42][2],gradQin[43][2]}, {gradQin[42][2],gradQin[44][2],gradQin[45][2]}, {gradQin[43][2],gradQin[45][2],gradQin[46][2]},</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>                },</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>                {</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>                        {gradQin[47][2],gradQin[48][2],gradQin[49][2]}, {gradQin[48][2],gradQin[50][2],gradQin[51][2]}, {gradQin[49][2],gradQin[51][2],gradQin[52][2]}</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>                }</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>        }</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>    };</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span> </div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>    <span class="keywordtype">double</span> dgup[3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++)</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) dgup[k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l] -= g_contr[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][n]*g_contr[j][l]*2*DD[k][n][j];</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span> </div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>    <span class="keywordtype">double</span> Kex[3][3]={ 0 };</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) Kex[i][j]=Aex[i][j]/phi2 + (1./3)*traceK*g_cov[i][j]/phi2;</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>    <span class="keywordtype">double</span> Kmix[3][3]={0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> = 0; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> &lt; 3; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>++) Kmix[i][j] += phi2*g_contr[i][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>] * Kex[<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>][j];</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>    <span class="keywordtype">double</span> Kup[3][3]={0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> = 0; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a> &lt; 3; <a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>++) Kup[i][j] += phi2*g_contr[i][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>] * Kmix[j][<a class="code hl_variable" href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a>]; <span class="comment">// Note the transposition is in the indices</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>    <span class="keywordtype">double</span> Christoffel[3][3][3]       = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++) Christoffel[i][j][k]  += g_contr[k][l] * ( DD[i][j][l] + DD[j][i][l] - DD[l][i][j] ) - g_contr[k][l] * ( g_cov[j][l] * PP[i] + g_cov[i][l] * PP[j] - g_cov[i][j] * PP[l] );</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span> </div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>    <span class="keywordtype">double</span> dChristoffel[3][3][3][3] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span> </div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++)</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++)</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>    {</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>        dChristoffel[k][i][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] += 0.5*g_contr[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l] * (</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>            dDD[k][i][j][l] + dDD[i][k][j][l] + dDD[k][j][i][l] + dDD[j][k][i][l] - dDD[k][l][i][j] - dDD[l][k][i][j]</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>            - g_cov[j][l]*(dPP[k][i] + dPP[i][k]) - g_cov[i][l]*(dPP[k][j]+dPP[j][k]) +  g_cov[i][j]*(dPP[k][l]+dPP[l][k]) )</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>            +dgup[k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l]*(DD[i][j][l]+DD[j][i][l]-DD[l][i][j])</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>            -dgup[k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l]*(g_cov[j][l]*PP[i]+g_cov[i][l]*PP[j]-g_cov[i][j]*PP[l])</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>            -2*g_contr[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l]*(DD[k][j][l]*PP[i]+DD[k][i][l]*PP[j]-DD[k][i][j]*PP[l]);</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>    }</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span> </div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>    <span class="keywordtype">double</span> Riemann[3][3][3][3] = {0};</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++){</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>        Riemann[i][k][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] = dChristoffel[k][i][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] - dChristoffel[j][i][k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>];</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++){</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>            Riemann[i][k][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>] += Christoffel[i][j][l]*Christoffel[l][k][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]-Christoffel[i][k][l]*Christoffel[l][j][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>];</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>        }</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>    }</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span> </div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>    <span class="keywordtype">double</span> Ricci[3][3] = {0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++)</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 3; n++)</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++) Ricci[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][n] += Riemann[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l][n][l];</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span> </div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>    <span class="keywordtype">double</span> R=0;</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) R += phi2*g_contr[i][j]*Ricci[i][j];</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>    <span class="keywordtype">double</span> Kupdown=0;</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) Kupdown += Kex[i][j]*Kup[i][j];</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span> </div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>    <span class="keywordtype">double</span> Ham=0;</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>    Ham = R-Kupdown+traceK*traceK;</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span> </div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>    <span class="keywordtype">double</span> dKex[3][3][3]={0};</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) dKex[k][i][j]= (1.0/phi2)*(</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>            dAex[k][i][j]-2*Aex[i][j]*PP[k]+(1.0/3)*dtraceK[k]*g_cov[i][j]</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>            +(2.0/3)*traceK*DD[k][i][j]-(2.0/3)*traceK*g_cov[i][j]*PP[k]);</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span> </div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>    <span class="keywordtype">double</span> Mom[3]={0,0,0};</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; 3; l++){</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>        Mom[i] += phi2*g_contr[j][l]*(dKex[l][i][j]-dKex[i][j][l]);</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> = 0; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a> &lt; 3; <a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>++){</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>            Mom[i] += phi2*g_contr[j][l]*(-Christoffel[j][l][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]*Kex[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][i]+Christoffel[j][i][<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>]*Kex[<a class="code hl_variable" href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a>][l]);</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>        }</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>    }</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span> </div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>    memset(constraints, 0, 6*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>    constraints[0]  =   Ham;</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>    constraints[1]  =   Mom[0];</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>    constraints[2]  =   Mom[1];</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>    constraints[3]  =   Mom[2];</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>    constraints[4]  =   1.0/invdet-1.0;</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>    constraints[5]  =   traceA;</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>}</div>
</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span><span class="preprocessor">#if defined(GPUOffloadingOMP)</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span><span class="preprocessor">#pragma omp end declare target</span></div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span><span class="preprocessor">#endif</span></div>
<div class="ttc" id="aMGCCZ4Kernels_8h_html"><div class="ttname"><a href="../../d4/d57/MGCCZ4Kernels_8h.html">MGCCZ4Kernels.h</a></div></div>
<div class="ttc" id="abenchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h_html_ab596bf6dc1a695a2a3d7cad5da0e0f17"><div class="ttname"><a href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h.html#ab596bf6dc1a695a2a3d7cad5da0e0f17">u</a></div><div class="ttdeci">float u</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc9/benchmarks_2other_2noh2d-common_2swift_2equation__of__state_8h_source.html#l00107">equation_of_state.h:107</a></div></div>
<div class="ttc" id="abenchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h_html_aa031162cbd5b31f9016011edc289d4f4"><div class="ttname"><a href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h.html#aa031162cbd5b31f9016011edc289d4f4">temp</a></div><div class="ttdeci">const int temp</div><div class="ttdef"><b>Definition</b> <a href="../../db/d37/benchmarks_2other_2noh2d-common_2swift_2kernel__hydro_8h_source.html#l00264">kernel_hydro.h:264</a></div></div>
<div class="ttc" id="acoordinate_8h_html_af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355"><div class="ttname"><a href="../../dc/dd0/coordinate_8h.html#af8f339ad433d08316f2b66477f69083faa70478ce277ffc322f8e1e3418e07355">Z</a></div><div class="ttdeci">@ Z</div><div class="ttdef"><b>Definition</b> <a href="../../dc/dd0/coordinate_8h_source.html#l00007">coordinate.h:7</a></div></div>
<div class="ttc" id="ahydro_8h_html_ac51334f57ef8b81c0629c9421798c344"><div class="ttname"><a href="../../db/dba/hydro_8h.html#ac51334f57ef8b81c0629c9421798c344">m</a></div><div class="ttdeci">float m</div><div class="ttdef"><b>Definition</b> <a href="../../db/dba/hydro_8h_source.html#l00257">hydro.h:257</a></div></div>
<div class="ttc" id="amulticore_8h_html"><div class="ttname"><a href="../../d5/d52/multicore_8h.html">multicore.h</a></div></div>
<div class="ttc" id="anamespaceexamples_1_1exahype2_1_1mgccz4_html_a246515f22600697fce9e6d37a532023d"><div class="ttname"><a href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a246515f22600697fce9e6d37a532023d">examples::exahype2::mgccz4::ncp</a></div><div class="ttdeci">void ncp(double *BgradQ, const double *const Q, const double *const gradQSerialised, const int normal, const int MGCCZ4LapseType, const double MGCCZ4ds, const double MGCCZ4c, const double MGCCZ4e, const double MGCCZ4f, const double MGCCZ4bs, const double MGCCZ4sk, const double MGCCZ4xi, const double MGCCZ4mu)</div><div class="ttdef"><b>Definition</b> <a href="#l00504">MGCCZ4Kernels.cpp:504</a></div></div>
<div class="ttc" id="anamespaceexamples_1_1exahype2_1_1mgccz4_html_a4ee993f178813cc3dee76e69ddd59c0d"><div class="ttname"><a href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a4ee993f178813cc3dee76e69ddd59c0d">examples::exahype2::mgccz4::source</a></div><div class="ttdeci">void source(double *S, const double *const Q, const int MGCCZ4LapseType, const double MGCCZ4ds, const double MGCCZ4c, const double MGCCZ4e, const double MGCCZ4f, const double MGCCZ4bs, const double MGCCZ4sk, const double MGCCZ4xi, const double MGCCZ4itau, const double MGCCZ4eta, const double MGCCZ4k1, const double MGCCZ4k2, const double MGCCZ4k3)</div><div class="ttdef"><b>Definition</b> <a href="#l00112">MGCCZ4Kernels.cpp:112</a></div></div>
<div class="ttc" id="anamespaceexamples_1_1exahype2_1_1mgccz4_html_a6c60c2a34221a5907be82098d0e6e313"><div class="ttname"><a href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a6c60c2a34221a5907be82098d0e6e313">examples::exahype2::mgccz4::admconstraints</a></div><div class="ttdeci">void admconstraints(double *constraints, const double *const Q, const double *const gradQSerialised)</div><div class="ttdef"><b>Definition</b> <a href="#l00972">MGCCZ4Kernels.cpp:972</a></div></div>
<div class="ttc" id="anamespaceexamples_1_1exahype2_1_1mgccz4_html_a81806b17cd43f465a2530e67f8bd6f4d"><div class="ttname"><a href="../../d7/db1/namespaceexamples_1_1exahype2_1_1mgccz4.html#a81806b17cd43f465a2530e67f8bd6f4d">examples::exahype2::mgccz4::enforceMGCCZ4constraints</a></div><div class="ttdeci">void enforceMGCCZ4constraints(double *luh)</div><div class="ttdef"><b>Definition</b> <a href="#l00016">MGCCZ4Kernels.cpp:16</a></div></div>
<div class="ttc" id="asignal__velocity_8h_html_a41e3d113c39f81fd2f130c9b217e0e90"><div class="ttname"><a href="../../db/d34/signal__velocity_8h.html#a41e3d113c39f81fd2f130c9b217e0e90">beta</a></div><div class="ttdeci">const struct part *restrict const struct part *restrict const float const float beta</div><div class="ttdef"><b>Definition</b> <a href="../../db/d34/signal__velocity_8h_source.html#l00045">signal_velocity.h:45</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_a6e4fee11f07c3b70486e88fe92cbbdc.html">applications</a></li><li class="navelem"><a class="el" href="../../dir_1297bcdd37ee30661574862ec1af345a.html">exahype2</a></li><li class="navelem"><a class="el" href="../../dir_975ba014b12e68478347df2397000e79.html">mgccz4</a></li><li class="navelem"><a class="el" href="../../dc/dd1/MGCCZ4Kernels_8cpp.html">MGCCZ4Kernels.cpp</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:23:35 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
