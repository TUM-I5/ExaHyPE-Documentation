<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../Peano-icon.png" type="image/x-icon" />
<title>Peano</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="../../toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- https://bryce.io/gitlab-corners/ -->
<style>.gitlab-corner-wrapper{overflow:hidden;width:100px;height:100px;position:absolute;top:0;right:0}.gitlab-corner{position:absolute;top:-16px;right:-50px;transform:rotate(45deg);background:#333;border:44px solid #333;border-bottom:none;border-top:#333 solid 16px}.gitlab-corner svg{width:60px;height:60px;margin-bottom:-4px}.cls-1{fill:#fc6d26}.cls-2{fill:#e24329}.cls-3{fill:#fca326}.gitlab-corner:hover .cls-1{animation:cycle .6s}.gitlab-corner:hover .cls-2{animation:cycleMid .6s}.gitlab-corner:hover .cls-3{animation:cycleEnd .6s}@keyframes cycle{100%,15%,60%{fill:#fc6d26}30%,75%{fill:#e24329}45%,90%{fill:#fca326}}@keyframes cycleMid{100%,15%,60%{fill:#e24329}30%,75%{fill:#fca326}45%,90%{fill:#fc6d26}}@keyframes cycleEnd{100%,15%,60%{fill:#fca326}30%,75%{fill:#fc6d26}45%,90%{fill:#e24329}}@media (max-width:500px){.gitlab-corner:hover .cls-1,.gitlab-corner:hover .cls-2,.gitlab-corner:hover .cls-3{animation:none}.gitlab-corner .cls-1{animation:cycle .6s}.gitlab-corner .cls-2{animation:cycleMid .6s}.gitlab-corner .cls-3{animation:cycleEnd .6s}}</style><div class="gitlab-corner-wrapper"><a href="https://gitlab.lrz.de/hpcsoftware/Peano" class="gitlab-corner" aria-label="View source on GitLab"><svg id="logo_art" data-name="logo art" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 586 559"><g id="g44"><path id="path46" class="cls-1" d="M461.17,301.83l-18.91-58.12L404.84,128.43a6.47,6.47,0,0,0-12.27,0L355.15,243.64H230.82L193.4,128.43a6.46,6.46,0,0,0-12.26,0L143.78,243.64l-18.91,58.19a12.88,12.88,0,0,0,4.66,14.39L293,435,456.44,316.22a12.9,12.9,0,0,0,4.73-14.39"/></g><g id="g48"><path id="path50" class="cls-2" d="M293,434.91h0l62.16-191.28H230.87L293,434.91Z"/></g><g id="g56"><path id="path58" class="cls-1" d="M293,434.91,230.82,243.63h-87L293,434.91Z"/></g><g id="g64"><path id="path66" class="cls-3" d="M143.75,243.69h0l-18.91,58.12a12.88,12.88,0,0,0,4.66,14.39L293,435,143.75,243.69Z"/></g><g id="g72"><path id="path74" class="cls-2" d="M143.78,243.69h87.11L193.4,128.49a6.47,6.47,0,0,0-12.27,0l-37.35,115.2Z"/></g><g id="g76"><path id="path78" class="cls-1" d="M293,434.91l62.16-191.28H442.3L293,434.91Z"/></g><g id="g80"><path id="path82" class="cls-3" d="M442.24,243.69h0l18.91,58.12a12.85,12.85,0,0,1-4.66,14.39L293,434.91l149.2-191.22Z"/></g><g id="g84"><path id="path86" class="cls-2" d="M442.28,243.69h-87.1l37.42-115.2a6.46,6.46,0,0,1,12.26,0l37.42,115.2Z"/></g></svg></a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Peano-icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Peano
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d3/df9/petsc_dg_solver.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Discontinuous Galerkin Solver with PETSc</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md113"></a>
The weak formulation</h2>
<p>To translate a <a class="el" href="../../da/db8/namespacePDE.html">PDE</a> into an equation system, we express the solution</p>
<p>\( u = \sum _i u_i \phi _i \)</p>
<p>as sum over shape functions \( \phi _i \). The shape functions in this class are locally continuous, but their linear combination is not. We test this setup against test functions \( v \). Each test function is actually any of the shape functions \( \phi _i \). Drawing both shapes and test functions from the same function space means that we follow a <em><b>Ritz-Galerkin</b></em> approach.</p>
<p>Let \( \mathcal{L}(u) \) be the differential operator on the left-hand side of the <a class="el" href="../../da/db8/namespacePDE.html">PDE</a>, i.e. let's assume that we solve</p>
<p>\(
  \mathcal{L}(u) = f.
\)</p>
<p>A weak formulation means that we multiple both sides with a test function and then integrate over the whole thing. As we take all these tests from the same function space as the shape functions, we know that they all have local support.Consequently, our test integral "shrinks" down to the support of the test function</p>
<p>\(
  \int _\Omega \mathcal{L}(u) \cdot v dx = \int_{\text{cell}_v} \mathcal{L}(u) \cdot v dx
\)</p>
<p>as the product disappears everywhere outside of the cell that hosts the test function of interest.</p>
<p>Once again, we can integrate by parts to get rid of the highest derivative in our partial differential operator \( \mathcal{L}(u) \), but this time, we will get an expression of the form</p>
<p class="formulaDsp">
\begin{eqnarray*}
\int _\Omega \mathcal{L}(u) \cdot v dx 
&amp;=&amp; 
- \int _\Omega \left( \tilde{\mathcal{L}}(u), \nabla v \right) dx 
+ \int _{\partial \text{cell}_v} (n,\tilde{\mathcal{M}}(u)) v dS(x)
\\
&amp;=&amp; 
- \int _{\text{cell}_v} \left( \tilde{\mathcal{L}}(u), \nabla v \right) dx 
+ \int _{\partial \text{cell}_v} (n,\tilde{\mathcal{M}}(\hat u )) v dS(x)
\\
&amp; = &amp; \int _{\text{cell}_v} f \cdot v dx.
\end{eqnarray*}
</p>
<p>We reduced the order of the deriative within \( \mathcal{L}(u) \) and got a new operator \( \tilde{\mathcal{L}} \). If \( \mathcal{L}(u) \) is dominated by a second derivative, \( \tilde{\mathcal{L}} \) hosts only first-order derivatives. But this is a Pyrrhic victory: We now get an additional <a class="el" href="../../da/db8/namespacePDE.html">PDE</a> term over the cell faces.</p>
<p>We conclude that</p>
<ol type="1">
<li>the jump terms along the faces do not disappear, i.e. they do not cancel out from left and right as they do in a Continuous Galerkin formulation.</li>
<li>Even worse, they refer to a value \( u \) which technically does not exist, as there is no (unique) solution along the face. We only have a left \( u^- \) and a right \( u^+ \) solution. Therefore, I explicitly write \( \hat u \) in the equation above. It denotes that we haven't yet decided what the function looks like along the face.</li>
<li>We now have cell integrals to evaluate, and there are additional face integrals. The latter ones couple neighbouring cells. <br  />
</li>
</ol>
<p>We end up with a linear equation system</p>
<p>\( A x = b \)</p>
<p>where x has \( |\mathbb{C}| \cdot K  \cdot (p+1)^d \) entries. \( \mathbb{C}  \) is set of cells in the mesh.</p>
<h2><a class="anchor" id="autotoc_md114"></a>
An operator language and temporary variables</h2>
<p>Before we dive into examples or discuss how to map this formalism onto code, we introduce an operator language. That is, we break down the overall computation into small tasks. These tasks will be found 1:1 in the code later on. Furthermore, we gain some freedom by breaking things down into tiny bits and pieces: We can alter individual ones or puzzle them together in various ways.</p>
<p>We introduce a few operators (functions) to break down the overall computational scheme into a sequence/set of computations:</p>
<ul>
<li>The operator \( A_{cc} \) takes the dofs within a cell and computes the term \( - \int _{\text{cell}_v} \left( \tilde{\mathcal{L}}(u), \nabla v \right) dx \). It takes the \( K (p+1)^d \) values per cell and yields \( K (p+1)^d \) equations/updates from the cell. In classes like petsc.solvers.DiscontinuousGalerkinDiscretisation this matrix is called cell_cell_lhs_matrix.</li>
<li>Let's introduce temporary variables on the face. Those are the \( u^+ \) and \( u^- \) values, i.e. we store \( 2K (p+1)^{d-1} \) degrees of freedom on the face. Those are not really degrees of freedom. They will be mere projection, i.e. simply encode what the solution along the face is.</li>
<li>The operator \( A_{cf} \) takes the solution from a cell and projects it onto a face. Let \( u^+ \) and \( u^- \) denote the solution left or right of a face (from the face's point of view). For each of the \( 2d \) faces of a cell, the operator \( P_{cf} \) yields either the \( u^+ \) or \( u^- \).</li>
<li>The operator \( A_{ff} \) operates on a face. It takes \( u^+ \) and \( u^- \) and yields something that "reconstructs" the solution and applies the flux operator on it. This is the Riemann solver and hence linear algebraises the \( \tilde{\mathcal{M}}(\hat u ) \) from above.</li>
<li>The operator \( A_{fc} \) takes the \( \hat u \) on the face and yields the updates for the cell. It evaluates \( \int _{\partial \text{cell}_v} (n,\tilde{\mathcal{M}}(\hat u )) v dS(x) \).</li>
</ul>
<div style="background-color: #cfc ; padding: 10px; border: 1px solid green;"> Within Peano, it is important to distinguish data on cell and faces carefully from each other. Furthermore (i) we can read data associated with faces within cells; (ii) we can never read data from neighbouring cells within a cell; (iii) we can never access adjacent cell data from a face. </div><p>The overall scheme in operator notation thus reads</p>
<p>\(
  A_{cc} + A_{fc} \circ A_{ff} \circ A_{cf}
\)</p>
<p>i.e. we evaluate the cell contributions and add the face contributions which in turn results from a concatenation of three operators: <a class="el" href="../../dd/d39/namespaceapi_1_1Project.html">Project</a> solution onto face, solve a Riemann problem there, and then take the result and project it back onto the cell. The projection onto the face is a purely geoemtric thing: Once we know the polynomials chosen within the cell, we can evaluate what the solution looks like depending on the weights (unknowns within the degree of freedom). With that knowledge, we can determine what the solution on the face looks like. We use the same polynomial space there (restricted to the submanifold) and therefore can express the face representation through polynomial weights (left and right of the face), too. For each pair of the polynomial weights, we can solve the Riemann problem and store the outcome in further weights. That is, we represent the outcome of the Riemann problem again in the polynomial space on the faces. Finally, we take this representation, test it against the test functions, integrate over the face and write the contributions back into the cell.</p>
<p>Effectively, our approach blows up the equation system to solve into</p>
<p>\( 
 Ax = 
 \begin{bmatrix}
 A_{cc}  &amp; A_{fc}  &amp; 0 &amp; 0 \\
  0       &amp; id      &amp; -A_{ff}|_+ &amp; -A_{ff}|_- \\
 -id      &amp; 0       &amp; A_{cf}|_+ &amp; 0      \\
 -id      &amp; 0       &amp; 0 &amp; A_{cf}|_-      
 \end{bmatrix}
 \begin{bmatrix}
 x_{c} \\ x_f \\ x^+ \\ x^-
 \end{bmatrix}
 = 
 \begin{bmatrix}
 b_{c} \\ 0 \\ 0 \\ 0 
 \end{bmatrix}
\)</p>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000012">Todo</a></b></dt><dd>We need a nice illustration here of all the function spaces </dd></dl>
<p>where we have to specify the involved matrices further. The \( x_c \) are the real degrees of freedom, i.e. the weights within the cells which effectively span the solution. The \( x_\pm \) encode the projection of these polynomials onto the faces. These are not real degrees of freedom, as they always result directly from the \( x_c \). The \( x_f \) encode the reconstructed solution on the faces and hold the average of the \( x_\pm \) values. This setup means our total matrix is no longer square. \( A_{cc} \) is square, with \( |\mathbb{C}| \cdot (p+1)^d \) rows, where \( |\mathbb{C}| \) is the number of cells in the mesh. \( A_{fc} \) has the same number of rows, but \( |\mathbb{F}| \cdot (p+1)^{d-1} \) columns, since this part has to "hit" \( x_f \). \( A_{ff} \) has \( |\mathbb{F}| \cdot (p+1)^{d-1} \) rows, and twice as many columns (note that \( | x_\pm| \ = \ 2 |x_f| \) ). Finally, \( A_{cf} \) has \( |\mathbb{C}| \cdot (p+1)^d \) rows and \( 2|\mathbb{F}| \cdot (p+1)^{d-1} \) columns, since this part "hits" \( x_\pm \).</p>
<p>Our global matrix is no longer square. We have \( 2 |\mathbb{C}| \cdot (p+1)^d + |\mathbb{F}| \cdot (p+1)^{d-1} \) rows and \( |\mathbb{C}| \cdot (p+1)^d + 3|\mathbb{F}| \cdot (p+1)^{d-1} \) columns.</p>
<div style="background-color: #cfc ; padding: 10px; border: 1px solid green;"> The write-down as one big matrix as above works if and only if the chosen Riemann solver yield a linear combination of the \( u^-/u^+ \) or \( x^-/x^+ \) values respectively. In many sophisticated solvers, it will not be linear. In this case, the system becomes a non-linear equation system. </div><h2><a class="anchor" id="autotoc_md115"></a>
Data storage</h2>
<p>The data storage within a cell is not prescribed by Peano, i.e. you can, in principle decide if you want to reorder the <a class="el" href="../../de/d44/page_multigrid_terminology.html">nodes within the cell</a> or you can decide to order the degrees of freedom overall as SoA as opposed to AoS. At the end of the day, Peano maintains an array of doubles per cell and does not really care about the semantics of those. However, we strongly recommend that you stick to the default configuration where possible:</p>
<div class="image">
<img src="../../degree_of_freedom_semantics.png" alt=""/>
</div>
<ul>
<li>Nodes are enumerated following our <a class="el" href="../../de/d44/page_multigrid_terminology.html">dimension-generic conventions</a>.</li>
<li>Data are stored as an Array of Structs (AoS), i.e. first all the unknowns of the first node, then all of the second, and so forth.</li>
</ul>
<p>If you change any ordering, you have to take this into account for all associated operators (such as projections onto the faces), but you also will have to amend the plotters which are tied to these conventions.</p>
<p>Data on the faces is</p>
<ul>
<li>stored as AoS by default;</li>
<li>per face, we first store the left projection \( x^- \), then the right projection \( x^+ \) and then the outcome of the flux or associated reconstruction. That is, all the \( x^- \) are held en bloc first before we hold \( x^+ \).</li>
<li>Per \( x^\pm \), the storage of the nodes and unknowns follows again the <a class="el" href="../../de/d44/page_multigrid_terminology.html">dimension-generic conventions</a>.</li>
</ul>
<p>It is important to recognise that we store three types of quantities per unknown: Its left projection, its right projection, and its outcome which can be either the flux or a reconstructed income. The semantics of the outcome depend upon your operators, i.e. they are not baked into the formalism. Furthermore, there is no assumption about the spacing along the faces. Naturally, you might assume that a Gauss-Lobatto layout within the cell implies a Gauss-Lobatto distribution on the faces. However, no such thing is encoded within the code, as we solely work with operators. They have to encode the correct spacing.</p>
<p>Another assumptions is baked into the realisation as a default: The polynomial degree on the facet result \( x_f \) equals the polynomial degree within the cell.</p>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000013">Todo</a></b></dt><dd>Different polynomial degrees are simple to realise. This is something to do in the future. Note that +/- are to be taken from the same space as the cell, as they are projections, but maybe we want to alter this, and even provide completely different degrees for the result of the Riemann solve.</dd></dl>
<h2><a class="anchor" id="autotoc_md116"></a>
Examples</h2>
<p>Multiple examples are shipped with Peano which demonstrate how to use the plain Discontiuous Galerking solver:</p>
<ul>
<li>benchmarks/multigrid/petsc/poisson/dg.py Hosts a simple solver for the Poisson equation. All the rationale are discussed in <a class="el" href="../../d1/ded/benchmarks_documentation_multigrid_petsc_poisson.html">Poisson equation</a>. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Peano</a></li><li class="navelem"><a class="el" href="../../d3/da3/page_multigrid_home.html">MGHyPE</a></li><li class="navelem"><a class="el" href="../../da/dc1/multigrid_architecture.html">Architecture</a></li>
    <li class="footer">Generated on Tue Jul 1 2025 11:28:57 for Peano by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
